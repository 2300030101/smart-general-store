<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smart General Store</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <style>
    /* Reset and Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      min-height: 100vh;
      color: #1e293b;
      line-height: 1.6;
      margin: 0;
      padding: 0;
      position: relative;
      overflow-x: hidden;
    }
    
    /* Remove any spacing when homepage is visible */
    body:has(#homepage[style*="display: block"]) {
      margin: 0 !important;
      padding: 0 !important;
      overflow: hidden !important;
    }
    
    html:has(#homepage[style*="display: block"]) {
      margin: 0 !important;
      padding: 0 !important;
      overflow: hidden !important;
    }
    
    /* Header Styles */
    header {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: white;
      padding: 0.5rem 2rem;
      border-radius: 0;
      margin-bottom: 0;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .logo-icon {
      position: relative;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 1rem;
    }
    
    .logo-circle {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: linear-gradient(135deg, #0d6efd 0%, #38b2ac 100%);
      box-shadow: 0 4px 15px rgba(13, 110, 253, 0.3);
      animation: logoPulse 3s ease-in-out infinite;
    }
    
    .logo-symbol {
      position: relative;
      z-index: 2;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
    }
    
    .logo-symbol img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
      border: 2px solid white;
    }
    
    @keyframes logoPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .logo-text h1 {
      font-size: 1.5rem;
      margin: 0;
      color: white;
      font-weight: 700;
    }
    
    .logo-text p {
      font-size: 0.9rem;
      margin: 0;
      color: #cbd5e0;
      opacity: 0.8;
    }
    
    nav ul {
      display: flex;
      gap: 1.5rem;
      list-style: none;
      margin: 0;
      padding: 0;
      flex-wrap: wrap;
    }
    
    nav a {
      color: white;
      text-decoration: none;
      font-weight: 500;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    nav a:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-2px);
    }
    
    /* Main Container */
    main {
      max-width: 1200px;
      margin: 0;
      padding: 0;
    }
    
    /* Card Styles */
    .login-container, .bill-section, .categories, .items-list {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 2rem;
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      margin-bottom: 2rem;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    /* Form Elements */
    input, button, select {
      width: 100%;
      padding: 1rem;
      margin-bottom: 1rem;
      font-size: 1rem;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      transition: all 0.3s ease;
      font-family: inherit;
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: #0f172a;
      box-shadow: 0 0 0 3px rgba(15, 23, 42, 0.1);
    }
    
    button {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(15, 23, 42, 0.3);
    }
    
    button:active {
      transform: translateY(0);
    }
    .category-card, .item-card {
      padding: 1em;
      text-align: center;
      border-radius: 8px;
      background: #f9f9f9;
      cursor: pointer;
      margin-bottom: 1em;
    }
    
    /* Category Grid Styles */
    .categories {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin: 0;
    }
    
    .category-card {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: white;
      padding: 2rem 1.5rem;
      border-radius: 16px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    
    .category-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0,0,0,0.2);
    }
    
    .category-card:active {
      transform: translateY(-2px);
    }
    
    .category-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    
    .category-card:hover::before {
      left: 100%;
    }
    
    .category-icon {
      font-size: 3rem;
      display: block;
      margin-bottom: 1rem;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
    }
    
    .category-name {
      font-size: 1.2rem;
      font-weight: 600;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }
    
    /* Individual Category Colors - Professional Theme */
    .category-card[data-cat="Vegetables"] {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
    }
    
    .category-card[data-cat="Groceries"] {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    }
    
    .category-card[data-cat="Pooja Items"] {
      background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
    }
    
    .category-card[data-cat="Stationery"] {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .categories {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin: 1rem 0;
      }
      
      .category-card {
        padding: 1.5rem 1rem;
      }
      
      .category-icon {
        font-size: 2.5rem;
      }
      
      .category-name {
        font-size: 1rem;
      }
    }
    
    @media (max-width: 480px) {
      .categories {
        grid-template-columns: 1fr;
        gap: 0.8rem;
      }
      
      .category-card {
        padding: 1.2rem 1rem;
      }
      
      .category-icon {
        font-size: 2rem;
      }
    }
    /* Item Card Styles */
    .item-card {
      background: white;
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      border: 1px solid #f1f5f9;
      transition: all 0.3s ease;
    }
    
    .item-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 30px rgba(0,0,0,0.12);
    }
    
    .item-card input {
      width: 80px;
      padding: 0.5rem;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      text-align: center;
      font-weight: 600;
    }
    
    .item-name {
      font-size: 1.2rem;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 0.5rem;
    }
    
    .item-price {
      font-size: 1.1rem;
      font-weight: 600;
      color: #0f172a;
      margin-bottom: 0.5rem;
    }
    
    .item-weight {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }
    
    .item-weight label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 500;
    }
    
    .item-weight button {
      width: auto;
      padding: 0.5rem 1rem;
      margin: 0;
      font-size: 0.9rem;
    }
    
    /* Bill Styles */
    .bill-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      background: #f8fafc;
      border-radius: 12px;
      margin-bottom: 0.5rem;
      border: 1px solid #e2e8f0;
    }
    
    .bill-total {
      text-align: right;
      font-weight: 700;
      font-size: 1.2rem;
      color: #1e293b;
      padding: 1rem;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: white;
      border-radius: 12px;
      margin-top: 1rem;
    }
    
    /* Stock Status Styles */
    .out-of-stock {
      opacity: 0.5;
      background: #fef2f2 !important;
      border: 1px solid #fecaca;
    }
    
    .low-stock {
      color: #dc2626;
      font-weight: 600;
    }
    
    .in-stock {
      color: #059669;
      font-weight: 600;
    }
    
    .stock-info {
      margin: 1rem 0;
      padding: 0.75rem;
      background: #f8fafc;
      border-radius: 8px;
      border-left: 4px solid #0f172a;
    }
    
    .stock-amount {
      font-weight: 600;
      font-size: 0.95rem;
    }
    
    /* Table Styles */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }
    
    th, td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
    }
    
    th {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: white;
      font-weight: 600;
    }
    
    tr:hover {
      background: #f8fafc;
    }
    
    /* Utility Classes */
    .btn-primary {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #64748b 0%, #475569 100%);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover, .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    }
    
    /* Section Headers */
    h2, h3 {
      color: #1e293b;
      margin-bottom: 1.5rem;
      font-weight: 700;
    }
    
    h2 {
      font-size: 1.8rem;
      text-align: center;
    }
    
    h3 {
      font-size: 1.4rem;
    }
    
    /* Customer List Styles */
    #customerList {
      margin-top: 2rem;
    }
    
    #customerList > div {
      background: white;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      border: 1px solid #e2e8f0;
      transition: all 0.3s ease;
    }
    
    #customerList > div:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    
    /* Responsive Improvements */
    @media (max-width: 768px) {
      main {
        padding: 1rem;
      }
      
      .login-container, .bill-section, .categories, .items-list {
        padding: 1.5rem;
        margin-bottom: 1.5rem;
      }
      
      header {
        flex-direction: column;
        text-align: center;
      }
      
      .logo {
        justify-content: center;
      }
      
      nav ul {
        justify-content: center;
        gap: 1rem;
      }
      
      nav a {
        font-size: 0.9rem;
        padding: 0.4rem 0.8rem;
      }
      
      .item-weight {
        flex-direction: column;
        align-items: stretch;
      }
      
      .item-weight button {
        width: 100%;
      }
      
      /* Customer info bar mobile */
      #storeSection > div:first-child {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
      }
      
      #storeSection > div:first-child select {
        width: 100%;
      }
      
      /* Customer selection mobile */
      #customerSection > div:first-child {
        flex-direction: column;
        gap: 1rem;
      }
      
      #customerSection > div:first-child button {
        width: 100%;
      }
    }
    
    @media (max-width: 480px) {
      header nav ul {
        flex-direction: column;
        gap: 0.5rem;
      }
      
      .categories {
        grid-template-columns: 1fr;
      }
      
      .item-card {
        padding: 1rem;
      }
    }
    
    /* Loading and Animation States */
    .loading {
      opacity: 0.7;
      pointer-events: none;
    }
    
    /* Success/Error Messages */
    .success-message {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 1rem;
      border-radius: 12px;
      margin: 1rem 0;
      text-align: center;
    }
    
    .error-message {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      padding: 1rem;
      border-radius: 12px;
      margin: 1rem 0;
      text-align: center;
    }
      .bill-section {
        background: white;
        padding: 2rem;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        margin-top: 2rem;
      }
      
      .bill-history-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
      }
      
      .stat-card {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        padding: 1.5rem;
        border-radius: 12px;
        text-align: center;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      }
      
      .stat-card h3 {
        font-size: 2rem;
        margin: 0 0 0.5rem 0;
      }
      
      .stat-card p {
        margin: 0;
        opacity: 0.9;
      }
      
      .bill-filters {
        display: flex;
        gap: 1rem;
        align-items: center;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
      }
      
      .bill-filters input,
      .bill-filters select {
        padding: 0.75rem;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
      }
      
      .bill-filters input:focus,
      .bill-filters select:focus {
        outline: none;
        border-color: var(--primary-color);
      }
      
      .bill-table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      }
      
      .bill-table th {
        background: var(--primary-color);
        color: white;
        padding: 1rem;
        text-align: left;
        font-weight: 600;
      }
      
      .bill-table td {
        padding: 1rem;
        border-bottom: 1px solid #e2e8f0;
      }
      
      .bill-table tr:hover {
        background: #f8fafc;
      }
      
      .bill-actions {
        display: flex;
        gap: 0.5rem;
      }
      
      .bill-actions button {
        padding: 0.5rem;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 1rem;
        transition: all 0.3s ease;
      }
      
      .bill-actions button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      }
      
      /* Homepage Styles */
      .landing-page {
        min-height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 2rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        padding-top: 2rem;
        position: absolute !important;
        top: 0 !important;
        left: 0 !important;
        width: 100% !important;
        height: 100vh !important;
        margin: 0 !important;
        box-sizing: border-box;
        z-index: 10 !important;
        overflow: hidden;
      }
      
      /* Override any main element conflicts */
      main:has(#homepage) {
        padding: 0 !important;
        margin: 0 !important;
        min-height: auto !important;
      }
      
      /* Hide header when homepage is visible */
      #homepage[style*="display: block"] ~ header,
      #homepage[style*="display: block"] + header {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        z-index: -1 !important;
        pointer-events: none !important;
      }
      
      .hero-section {
        text-align: center;
        max-width: 1200px;
        width: 100%;
      }
      
      .hero-content {
        margin-bottom: 3rem;
      }
      
      .hero-content h1 {
        font-size: 3.5rem;
        color: white;
        margin-bottom: 1rem;
        text-shadow: 0 2px 10px rgba(0,0,0,0.3);
      }
      
      .hero-subtitle {
        font-size: 1.5rem;
        color: #e2e8f0;
        margin-bottom: 1rem;
      }
      
      .hero-description {
        font-size: 1.1rem;
        color: #cbd5e0;
        margin-bottom: 2rem;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }
      
      .cta-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
      }
      
      .cta-buttons button {
        padding: 1rem 2rem;
        font-size: 1.1rem;
        border-radius: 12px;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
      }
      
      .cta-buttons .btn-primary {
        background: linear-gradient(135deg, #059669 0%, #047857 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(5, 150, 105, 0.3);
      }
      
      .cta-buttons .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(5, 150, 105, 0.4);
      }
      
      .cta-buttons .btn-secondary {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.3);
        backdrop-filter: blur(10px);
      }
      
      .cta-buttons .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }
      
      .feature-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 2rem;
        margin-top: 3rem;
      }
      
      .feature-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 2rem;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
      }
      
      .feature-card:hover {
        transform: translateY(-5px);
        background: rgba(255, 255, 255, 0.15);
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      }
      
      .feature-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
      }
      
      .feature-card h3 {
        color: white;
        font-size: 1.5rem;
        margin-bottom: 1rem;
      }
      
      .feature-card p {
        color: #e2e8f0;
        line-height: 1.6;
      }
      
      .store-info-section {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }
      
      .store-info-card {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      }
      
      .store-info-card h2 {
        color: #0f172a;
        margin-bottom: 1.5rem;
        text-align: center;
      }
      
      .info-grid {
        display: grid;
        gap: 1rem;
        margin-bottom: 2rem;
      }
      
      .info-item {
        padding: 1rem;
        background: #f8fafc;
        border-radius: 8px;
        border-left: 4px solid #0d6efd;
      }
      
      .info-item strong {
        color: #0f172a;
      }
      
      /* Responsive Design for Homepage */
      @media (max-width: 768px) {
        .hero-content h1 {
          font-size: 2.5rem;
        }
        
        .hero-subtitle {
          font-size: 1.2rem;
        }
        
        .feature-cards {
          grid-template-columns: 1fr;
          gap: 1.5rem;
        }
        
        .cta-buttons {
          flex-direction: column;
          align-items: center;
        }
        
        .cta-buttons button {
          width: 100%;
          max-width: 300px;
        }
      }
      
      /* Enhanced Login Styles */
      .login-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        z-index: 9999;
        backdrop-filter: blur(10px);
        animation: fadeIn 0.5s ease-out;
      }
      
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      
      .login-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 24px;
        padding: 3.5rem;
        max-width: 450px;
        width: 100%;
        box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.2);
        position: relative;
        overflow: hidden;
        animation: loginSlideIn 0.6s ease-out;
        transform: translateZ(0);
        will-change: transform;
      }
      
      .login-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
        transition: left 0.5s;
      }
      
      .login-card:hover::before {
        left: 100%;
      }
      
      @keyframes loginSlideIn {
        from {
          opacity: 0;
          transform: translateY(30px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      
      .login-header {
        margin-bottom: 2.5rem;
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      
      .login-logo {
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        animation: logoFloat 3s ease-in-out infinite;
        overflow: hidden;
      }
      
      .login-logo img {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid white;
      }
      
      @keyframes logoFloat {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-5px); }
      }
      
      .login-header h2 {
        color: #0f172a;
        margin-bottom: 0.75rem;
        font-size: 2rem;
        font-weight: 700;
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      
      .login-header p {
        color: #64748b;
        font-size: 1.1rem;
        margin: 0;
        font-weight: 500;
      }
      
      .login-form {
        margin-bottom: 2.5rem;
      }
      
      .form-group {
        margin-bottom: 2rem;
        text-align: left;
        position: relative;
        display: flex;
        flex-direction: column;
      }
      
      .form-group label {
        margin-bottom: 0.75rem;
        color: #374151;
        font-weight: 600;
        font-size: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: color 0.3s ease;
      }
      
      .form-group label i {
        color: #667eea;
        font-size: 1.1rem;
      }
      
      .form-group input {
        width: 100%;
        padding: 1.25rem 1rem;
        border: 2px solid #e5e7eb;
        border-radius: 16px;
        font-size: 1rem;
        transition: all 0.3s ease;
        box-sizing: border-box;
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(10px);
        font-weight: 500;
        position: relative;
      }
      
      .form-group input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        background: white;
        transform: translateY(-2px);
      }
      
      .form-group input:focus + label {
        color: #667eea;
      }
      
      .form-group input::placeholder {
        color: #9ca3af;
        font-weight: 400;
      }
      
      .login-btn {
        width: 100%;
        padding: 1.25rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 16px;
        font-size: 1.2rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 1rem;
        position: relative;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        min-height: 60px;
      }
      
      .login-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.5s;
      }
      
      .login-btn:hover::before {
        left: 100%;
      }
      
      .login-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 30px rgba(102, 126, 234, 0.4);
      }
      
      .login-btn:active {
        transform: translateY(-1px);
      }
      
      .btn-loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .spinner {
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top: 2px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      @keyframes slideOut {
        from {
          opacity: 1;
          transform: translateY(0);
        }
        to {
          opacity: 0;
          transform: translateY(-10px);
        }
      }
      
      .login-footer {
        padding-top: 2rem;
        border-top: 1px solid rgba(229, 231, 235, 0.5);
        color: #6b7280;
        font-size: 0.95rem;
        background: rgba(248, 250, 252, 0.5);
        margin: 0 -3.5rem -3.5rem -3.5rem;
        padding: 2rem 3.5rem 3.5rem 3.5rem;
        border-radius: 0 0 24px 24px;
      }
      
      .login-footer p {
        margin: 0.5rem 0;
      }
      
      /* Responsive Design for Login */
      @media (max-width: 768px) {
        .login-container {
          padding: 1rem;
        }
        
        .login-card {
          padding: 2.5rem 2rem;
          max-width: 100%;
          margin: 0 1rem;
        }
        
        .login-header h2 {
          font-size: 1.75rem;
        }
        
        .login-header p {
          font-size: 1rem;
        }
        
        .form-group input {
          padding: 1rem;
          font-size: 16px; /* Prevents zoom on iOS */
        }
        
        .login-btn {
          padding: 1rem;
          font-size: 1.1rem;
        }
      }
      
      @media (max-width: 480px) {
        .login-card {
          padding: 2rem 1.5rem;
        }
        
        .login-logo {
          width: 80px;
          height: 80px;
        }
        
        .login-logo img {
          width: 50px;
          height: 50px;
        }
      }
      
      .login-footer strong {
        color: #374151;
        font-weight: 700;
      }
      
      .demo-credentials {
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        padding: 1rem;
        border-radius: 12px;
        margin-top: 1rem;
        border: 1px solid rgba(59, 130, 246, 0.2);
      }
      
      .demo-credentials h4 {
        margin: 0 0 0.75rem 0;
        color: #1e40af;
        font-size: 0.9rem;
        font-weight: 600;
      }
      
      .credential-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
        padding: 0.5rem;
        background: white;
        border-radius: 8px;
        border: 1px solid rgba(59, 130, 246, 0.1);
      }
      
      .credential-item:last-child {
        margin-bottom: 0;
      }
      
      .credential-label {
        font-weight: 600;
        color: #374151;
      }
      
      .credential-value {
        font-family: 'Courier New', monospace;
        color: #059669;
        font-weight: 700;
        background: #f0fdf4;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.9rem;
      }
      
      /* Responsive Login Design */
      @media (max-width: 768px) {
        .login-container {
          padding: 1rem;
        }
        
        .login-card {
          padding: 2.5rem 2rem;
          max-width: 100%;
          margin: 0 1rem;
        }
        
        .login-logo {
          font-size: 3rem;
        }
        
        .login-header h2 {
          font-size: 1.75rem;
        }
        
        .login-header p {
          font-size: 1rem;
        }
        
        .form-group input {
          padding: 1rem;
          font-size: 1rem;
        }
        
        .login-btn {
          padding: 1rem;
          font-size: 1.1rem;
        }
        
        .login-footer {
          padding: 1.5rem 2rem 2.5rem 2rem;
          margin: 0 -2rem -2.5rem -2rem;
        }
      }
      
      @media (max-width: 480px) {
        .login-card {
          padding: 2rem 1.5rem;
          margin: 0 0.5rem;
        }
        
        .login-logo {
          font-size: 2.5rem;
        }
        
        .login-header h2 {
          font-size: 1.5rem;
        }
        
        .credential-item {
          flex-direction: column;
          align-items: flex-start;
          gap: 0.25rem;
        }
        
        .credential-value {
          align-self: flex-end;
        }
      }
      
      /* Contact Section Styles */
      .contact-section {
        min-height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem;
      }
      
      .contact-container {
        background: white;
        border-radius: 20px;
        padding: 3rem;
        max-width: 1000px;
        width: 100%;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      }
      
      .contact-container h2 {
        text-align: center;
        color: #0f172a;
        margin-bottom: 2rem;
        font-size: 2.5rem;
      }
      
      .contact-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
      }
      
      .contact-card {
        text-align: center;
        padding: 2rem;
        background: #f8fafc;
        border-radius: 16px;
        border: 1px solid #e2e8f0;
        transition: all 0.3s ease;
      }
      
      .contact-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        background: white;
      }
      
      .contact-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
      }
      
      .contact-card h3 {
        color: #0f172a;
        margin-bottom: 1rem;
        font-size: 1.3rem;
      }
      
      .contact-card p {
        color: #64748b;
        line-height: 1.6;
      }
      
      .contact-form {
        background: #f8fafc;
        padding: 2rem;
        border-radius: 16px;
        margin-bottom: 2rem;
      }
      
      .contact-form h3 {
        color: #0f172a;
        margin-bottom: 1.5rem;
        text-align: center;
        font-size: 1.5rem;
      }
      
      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 1rem;
      }
      
      .contact-form input,
      .contact-form textarea {
        width: 100%;
        padding: 1rem;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        font-size: 1rem;
        transition: all 0.3s ease;
        box-sizing: border-box;
        font-family: inherit;
      }
      
      .contact-form input:focus,
      .contact-form textarea:focus {
        outline: none;
        border-color: #0d6efd;
        box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.1);
      }
      
      .contact-form textarea {
        resize: vertical;
        min-height: 120px;
      }
      
      .contact-form button {
        width: 100%;
        padding: 1rem;
        background: linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 1rem;
      }
      
      .contact-form button:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(13, 110, 253, 0.3);
      }
      
      /* Responsive Contact */
      @media (max-width: 768px) {
        .contact-grid {
          grid-template-columns: 1fr;
          gap: 1.5rem;
        }
        
        .form-row {
          grid-template-columns: 1fr;
        }
        
        .contact-container {
          padding: 2rem;
        }
      }
      
      /* Admin Dashboard Styles */
      .admin-dashboard {
        background: white;
        border-radius: 20px;
        padding: 2rem;
        max-width: 1200px;
        width: 100%;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      }
      
      .admin-dashboard h2 {
        color: #0f172a;
        text-align: center;
        margin-bottom: 2rem;
        font-size: 2rem;
        background: linear-gradient(135deg, #0d6efd 0%, #38b2ac 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      
      .customer-selection,
      .add-customer-section,
      .admin-tools {
        background: #f8fafc;
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        border: 1px solid #e2e8f0;
      }
      
      .customer-selection h3,
      .add-customer-section h3,
      .admin-tools h3 {
        color: #0f172a;
        margin-bottom: 1rem;
        font-size: 1.3rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      
      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 1rem;
      }
      
      .form-grid input {
        padding: 0.75rem;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s ease;
      }
      
      .form-grid input:focus {
        outline: none;
        border-color: #0d6efd;
        box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.1);
      }
      
      .tools-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
      }
      
      .tool-btn {
        padding: 1rem;
        background: linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }
      
      .tool-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(13, 110, 253, 0.3);
      }
      
      /* Customer List Styles */
      .customer-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        border: 1px solid #e2e8f0;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
      }
      
      .customer-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      }
      
      .customer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }
      
      .customer-name {
        font-size: 1.2rem;
        font-weight: 600;
        color: #0f172a;
      }
      
      .customer-status {
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
      }
      
      .status-good {
        background: #dcfce7;
        color: #166534;
      }
      
      .status-warning {
        background: #fef3c7;
        color: #92400e;
      }
      
      .status-danger {
        background: #fee2e2;
        color: #991b1b;
      }
      
      .customer-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
        margin-bottom: 1rem;
      }
      
      .detail-item {
        display: flex;
        flex-direction: column;
      }
      
      .detail-label {
        font-size: 0.8rem;
        color: #64748b;
        margin-bottom: 0.25rem;
      }
      
      .detail-value {
        font-weight: 600;
        color: #0f172a;
      }
      
      .customer-actions {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
      }
      
      .action-btn {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 8px;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
      }
      
      .action-btn.edit {
        background: #0d6efd;
        color: white;
      }
      
      .action-btn.delete {
        background: #dc2626;
        color: white;
      }
      
      .action-btn.suspend {
        background: #f59e0b;
        color: white;
      }
      
      .action-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      }
      
      /* Analytics Styles */
      .analytics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }
      
      .analytics-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        text-align: center;
        border: 1px solid #e2e8f0;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
      }
      
      .analytics-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      }
      
      .analytics-icon {
        font-size: 2.5rem;
        margin-bottom: 1rem;
      }
      
      .analytics-value {
        font-size: 2rem;
        font-weight: 700;
        color: #0f172a;
        margin-bottom: 0.5rem;
      }
      
      .analytics-label {
        color: #64748b;
        font-size: 0.9rem;
      }
      
      .analytics-chart {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        border: 1px solid #e2e8f0;
      }
      
      .analytics-chart h4 {
        color: #0f172a;
        margin-bottom: 1rem;
        text-align: center;
      }
      
      .chart-bars {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }
      
      .chart-bar {
        display: flex;
        align-items: center;
        gap: 1rem;
      }
      
      .bar-label {
        min-width: 100px;
        font-weight: 600;
        color: #0f172a;
      }
      
      .bar-container {
        flex: 1;
        height: 20px;
        background: #e2e8f0;
        border-radius: 10px;
        overflow: hidden;
      }
      
      .bar-fill {
        height: 100%;
        transition: width 0.3s ease;
      }
      
      .bar-value {
        min-width: 50px;
        text-align: right;
        font-weight: 600;
        color: #0f172a;
      }
      
      /* Debt Management Styles */
      .debt-summary {
        margin-bottom: 2rem;
      }
      
      .summary-card {
        background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        color: white;
        padding: 1.5rem;
        border-radius: 12px;
        text-align: center;
      }
      
      .summary-card h4 {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
      }
      
      .debt-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      
      .debt-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        border: 1px solid #e2e8f0;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }
      
      .debt-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }
      
      .debt-header h4 {
        color: #0f172a;
        margin: 0;
      }
      
      .debt-amount {
        font-size: 1.2rem;
        font-weight: 700;
        color: #dc2626;
      }
      
      .debt-actions {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
      }
      
      /* Quick Actions Styles */
      .quick-actions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
      }
      
      /* Settings Styles */
      .settings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
      }
      
      .setting-item {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }
      
      .setting-item label {
        font-weight: 600;
        color: #0f172a;
      }
      
      .setting-item input {
        padding: 0.75rem;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
      }
      
      .setting-item input:focus {
        outline: none;
        border-color: #0d6efd;
        box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.1);
      }
      
      /* History Styles */
      .customer-summary {
        background: #f8fafc;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
      }
      
      .customer-summary p {
        margin: 0.5rem 0;
        color: #0f172a;
      }
      
      .history-list {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }
      
      .history-item {
        display: grid;
        grid-template-columns: 1fr 2fr 1fr 1fr;
        gap: 1rem;
        padding: 0.75rem;
        background: white;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
        align-items: center;
      }
      
      .history-date {
        font-size: 0.9rem;
        color: #64748b;
      }
      
      .history-item-name {
        font-weight: 600;
        color: #0f172a;
      }
      
      .history-amount {
        font-weight: 600;
        color: #059669;
        text-align: right;
      }
      
      .history-status {
        text-align: center;
        padding: 0.25rem 0.5rem;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 600;
      }
      
      .history-status.pending {
        background: #fef3c7;
        color: #92400e;
      }
      
      .history-status.paid {
        background: #dcfce7;
        color: #166534;
      }
  </style>
</head>
<body>
      <header>
              <div class="logo">
          <div class="logo-icon">
            <div class="logo-symbol">
              <img src="download.jpeg" alt="Store Logo" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
            </div>
            <div class="logo-circle"></div>
          </div>
          <div class="logo-text">
            <h1>Smart General Store</h1>
            <p>Modern Solutions for Traditional Business</p>
          </div>
        </div>
        
        <!-- Loyalty Program Display -->
        <div id="loyaltyDisplay" style="
          background: linear-gradient(45deg, #f59e0b, #fbbf24); 
          color: white; 
          padding: 0.5rem 1rem; 
          border-radius: 20px; 
          font-size: 0.9rem; 
          font-weight: 600;
          display: flex;
          align-items: center;
          gap: 0.5rem;
          box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
          cursor: pointer;
        " onclick="showLoyaltyInfo()" title="Click to view loyalty details">
          <span id="loyaltyIcon">ü•â</span>
          <span id="loyaltyTierText">Bronze</span>
          <span id="loyaltyPointsText">0 pts</span>
        </div>
    <nav>
      <ul style="list-style:none; display:flex; gap:1em; justify-content:center; padding:0;">
        <li><a href="#" id="viewCart">üõí Cart</a></li>
        <li><a href="#" id="viewKatha">üìã Katha</a></li>
        <li><a href="#" id="addCustomer">üë§ Add Customer</a></li>
        <li><a href="#" id="stockManagement">üì¶ Stock</a></li>
        <li><a href="#" id="billHistory">üìÑ Bill History</a></li>
        <li><a href="#" id="profitMargins" onclick="showProfitMargins();" style="background: linear-gradient(135deg, #059669 0%, #10b981 100%); color: white; padding: 0.5rem 1rem; border-radius: 8px;">üí∞ Profits</a></li>
        <li><a href="#" id="contactLink">üìû Contact</a></li>
        <li><a href="#" id="backToHome">üè† Home</a></li>
      </ul>
    </nav>
  </header>
  <main>
    <section id="loginSection" style="display:none;">
      <div class="login-card">
        <div class="login-header">
          <div class="login-logo">
            <img src="download.jpeg" alt="Store Logo" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin-bottom: 1rem;">
          </div>
          <h2>Smart General Store</h2>
          <p>Welcome back! Please login to continue.</p>
        </div>
        
        <form class="login-form" onsubmit="handleLogin(); return false;">
          <div class="form-group">
            <label for="username">
              <i class="fas fa-user"></i>
              Username
            </label>
            <input type="text" id="username" placeholder="Enter your username" required>
            <div class="input-focus-border"></div>
          </div>
          
          <div class="form-group">
            <label for="password">
              <i class="fas fa-lock"></i>
              Password
            </label>
            <input type="password" id="password" placeholder="Enter your password" required>
            <div class="input-focus-border"></div>
          </div>
          
          <button type="submit" class="login-btn">
            <span class="btn-icon">üöÄ</span>
            <span class="btn-text">Login to Dashboard</span>
            <div class="btn-loading" style="display: none;">
              <div class="spinner"></div>
            </div>
          </button>
        </form>
        
        <div class="login-footer">
          <div class="demo-credentials">
            <h4>üìã Demo Credentials</h4>
            <div class="credential-item">
              <span class="credential-label">Username:</span>
              <span class="credential-value">admin</span>
            </div>
            <div class="credential-item">
              <span class="credential-label">Password:</span>
              <span class="credential-value">1234</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="customerSection" style="display:none;">
      <div class="admin-dashboard">
        <h2>üëë Customer Management Dashboard</h2>
        
        <!-- Customer Selection -->
        <div class="customer-selection">
          <h3>üîç Select Customer</h3>
          <div style="margin-bottom: 20px; display: flex; gap: 1rem; align-items: end;">
            <div style="flex: 1;">
              <label for="manualCustomerId" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Customer ID:</label>
              <input type="text" id="manualCustomerId" placeholder="Enter Customer ID" style="width: 100%;">
            </div>
            <button onclick="selectCustomerById()" style="width: auto; padding: 1rem 2rem;">Select Customer</button>
          </div>
          <hr style="margin: 20px 0;">
        </div>
        
        <!-- Add New Customer -->
        <div class="add-customer-section">
          <h3>‚ûï Add New Customer</h3>
          <div class="form-grid">
            <input type="text" id="custId" placeholder="Customer ID" />
            <input type="text" id="custName" placeholder="Customer Name" />
            <input type="text" id="custPhone" placeholder="Phone Number" />
            <input type="number" id="custLimit" placeholder="Credit Limit (‚Çπ)" />
            <button onclick="addCustomerAndContinue()">Add New Customer and Continue</button>
          </div>
        </div>
        
        <!-- Customer Management Tools -->
        <div class="admin-tools">
          <h3>‚öôÔ∏è Administrative Tools</h3>
          <div class="tools-grid">
            <button onclick="showCustomerList()" class="tool-btn">üìã View All Customers</button>
            <button onclick="showCustomerAnalytics()" class="tool-btn">ÔøΩÔøΩ Customer Analytics</button>
            <button onclick="showDebtManagement()" class="tool-btn">üí∞ Debt Management</button>
            <button onclick="showCustomerActions()" class="tool-btn">‚ö° Quick Actions</button>
          </div>
          <div style="margin-top: 2rem; text-align: center;">
            <button onclick="showMainSection()" class="btn-primary" style="padding: 0.75rem 1.5rem;">üõí Back to Shopping</button>
          </div>
        </div>
        
        <!-- Customer List -->
        <div id="customerList" style="margin-top: 20px;"></div>
      </div>
    </section>

    <div id="storeSection" style="display:none; width: 100%; box-sizing: border-box;">
      <!-- Customer Info Bar -->
      <div style="background: white; padding: 1rem; border-radius: 12px; margin-bottom: 0; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <div>
          <strong>Current Customer:</strong> <span id="currentCustomerName">Not Selected</span>
        </div>
        <select id="customerDropdown" onchange="startShopping()" style="width: auto; margin: 0;">
          <option value="">-- Change Customer --</option>
        </select>
      </div>
      
      <div id="categoryGrid" class="categories"></div>
      
      <!-- Recipe Suggestions Section -->
      <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 1.5rem; border-radius: 16px; margin-bottom: 0; box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);">
        <h3 style="margin: 0 0 1rem; display: flex; align-items: center; gap: 0.5rem;">
          <span style="font-size: 1.5rem;">üë®‚Äçüç≥</span>
          <span>Today's Recipe Suggestions</span>
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem;">
          <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 12px; border: 1px solid rgba(255,255,255,0.2); cursor: pointer;" onclick="addRecipeIngredients('Pulao')">
            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
              <span style="font-size: 1.2rem;">üçö</span>
              <span style="font-weight: 600;">Vegetable Pulao</span>
            </div>
            <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">Perfect lunch recipe with fresh vegetables</p>
            <small style="opacity: 0.8;">Click to add ingredients to cart</small>
          </div>
          <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 12px; border: 1px solid rgba(255,255,255,0.2); cursor: pointer;" onclick="addRecipeIngredients('Dal')">
            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
              <span style="font-size: 1.2rem;">ü´ò</span>
              <span style="font-weight: 600;">Dal Khichdi</span>
            </div>
            <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">Comfort food with rice and lentils</p>
            <small style="opacity: 0.8;">Click to add ingredients to cart</small>
          </div>
          <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 12px; border: 1px solid rgba(255,255,255,0.2); cursor: pointer;" onclick="addRecipeIngredients('Salad')">
            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
              <span style="font-size: 1.2rem;">ü•ó</span>
              <span style="font-weight: 600;">Fresh Salad</span>
            </div>
            <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">Healthy salad with fresh vegetables</p>
            <small style="opacity: 0.8;">Click to add ingredients to cart</small>
          </div>
        </div>
      </div>
      
      <!-- Special Offers Section -->
      <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; border-radius: 16px; margin-bottom: 0; box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);">
        <h3 style="margin: 0 0 1rem; display: flex; align-items: center; gap: 0.5rem;">
          <span style="font-size: 1.5rem;">üéâ</span>
          <span>Today's Special Offers</span>
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
          <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 12px; border: 1px solid rgba(255,255,255,0.2); cursor: pointer;" onclick="addToCartFromUI('Tomato', 16)">
            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
              <span style="font-size: 1.2rem;">üçÖ</span>
              <span style="font-weight: 600;">Fresh Tomatoes</span>
            </div>
            <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">20% OFF - Now ‚Çπ16/kg (was ‚Çπ20)</p>
            <small style="opacity: 0.8;">Click to add to cart</small>
          </div>
          <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 12px; border: 1px solid rgba(255,255,255,0.2); cursor: pointer;" onclick="addToCartFromUI('Milk', 60)">
            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
              <span style="font-size: 1.2rem;">ü•õ</span>
              <span style="font-weight: 600;">Fresh Milk</span>
            </div>
            <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">Buy 2L Get 1L Free - Limited Time!</p>
            <small style="opacity: 0.8;">Click to add to cart</small>
          </div>
          <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 12px; border: 1px solid rgba(255,255,255,0.2); cursor: pointer;" onclick="addToCartFromUI('Rice', 45)">
            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
              <span style="font-size: 1.2rem;">üçö</span>
              <span style="font-weight: 600;">Basmati Rice</span>
            </div>
            <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">10% OFF on 5kg+ orders</p>
            <small style="opacity: 0.8;">Click to add to cart</small>
          </div>
        </div>
      </div>
      
      <!-- Search and Filter Section -->
      <div style="background: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
          <input type="text" id="searchItems" placeholder="üîç Search items..." style="flex: 1; min-width: 200px;">
          <select id="categoryFilter" style="width: 150px;">
            <option value="">All Categories</option>
            <option value="Vegetables">ü•¨ Vegetables</option>
            <option value="Groceries">üõí Groceries</option>
            <option value="Pooja Items">üïâÔ∏è Pooja Items</option>
            <option value="Stationery">‚úèÔ∏è Stationery</option>
          </select>
          <select id="stockFilter" style="width: 120px;">
            <option value="">All Stock</option>
            <option value="in-stock">In Stock</option>
            <option value="low-stock">Low Stock</option>
            <option value="out-of-stock">Out of Stock</option>
          </select>
          <button onclick="filterItems()" class="btn-primary">Filter</button>
          <button onclick="clearFilters()" class="btn-secondary">Clear</button>
        </div>
      </div>
      
      <section id="itemsSection" class="items-list"></section>
      <section id="billSection" class="bill-section" style="display:none;"></section>
      <section id="cartSection" class="bill-section" style="display:none;"></section>
      <section id="kathaSection" class="bill-section" style="display:none;"></section>
      <section id="billHistorySection" class="bill-section" style="display:none;"></section>
    </div>
  </main>

  <!-- Main Homepage Section -->
  <section id="homepage" class="landing-page" style="position: absolute; top: 0; left: 0; width: 100%; height: 100vh; z-index: 10;">
    <div class="hero-section">
      <div class="hero-content">
        <h1>üõçÔ∏è Smart General Store</h1>
        <p class="hero-subtitle">Modern solutions for traditional business</p>
        <p class="hero-description">Transform your local store with smart billing, credit management, and professional tools.</p>
        
        <div class="cta-buttons">
          <button onclick="startShopping()" class="btn-primary">üöÄ Start Shopping</button>
          <button onclick="showStoreInfo()" class="btn-secondary">‚ÑπÔ∏è Store Info</button>
          <button onclick="showContact()" class="btn-secondary">üìû Contact Us</button>
        </div>
      </div>
      
      <div class="feature-cards">
        <div class="feature-card">
          <div class="feature-icon">üìã</div>
          <h3>Smart Billing</h3>
          <p>Professional bills with tax calculation and multiple payment options</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">üí≥</div>
          <h3>Credit Management</h3>
          <p>Track customer debts and payments with our unique Katha system</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">üìä</div>
          <h3>Analytics</h3>
          <p>Sales reports, inventory tracking, and business insights</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">üì±</div>
          <h3>Mobile Ready</h3>
          <p>Works perfectly on all devices - desktop, tablet, and mobile</p>
        </div>
      </div>
    </div>
    
    <div class="store-info-section" id="storeInfoSection" style="display: none;">
      <div class="store-info-card">
        <h2>üè™ Store Information</h2>
        <div class="info-grid">
          <div class="info-item">
            <strong>Store Name:</strong> Smart General Store
          </div>
          <div class="info-item">
            <strong>Address:</strong> Main Street, City Center
          </div>
          <div class="info-item">
            <strong>Phone:</strong> +91 98765 43210
          </div>
          <div class="info-item">
            <strong>Hours:</strong> 8:00 AM - 9:00 PM (Daily)
          </div>
          <div class="info-item">
            <strong>Services:</strong> Groceries, Vegetables, Pooja Items, Stationery
          </div>
          <div class="info-item">
            <strong>Payment:</strong> Cash, Card, UPI, Credit (Katha)
          </div>
        </div>
        <button onclick="hideStoreInfo()" class="btn-primary">Close</button>
      </div>
    </div>
  </section>

  <!-- Contact Section -->
  <section id="contactSection" class="contact-section" style="display: none;">
    <div class="contact-container">
      <h2>üìû Contact Us</h2>
      <div class="contact-grid">
        <div class="contact-card">
          <div class="contact-icon">üìç</div>
          <h3>Address</h3>
          <p>Main Street, City Center<br>Near Central Market<br>Pin Code: 123456</p>
        </div>
        
        <div class="contact-card">
          <div class="contact-icon">üìû</div>
          <h3>Phone</h3>
          <p>+91 98765 43210<br>+91 98765 43211<br>Landline: 0123-456789</p>
        </div>
        
        <div class="contact-card">
          <div class="contact-icon">‚úâÔ∏è</div>
          <h3>Email</h3>
          <p>info@smartgeneralstore.com<br>support@smartgeneralstore.com<br>orders@smartgeneralstore.com</p>
        </div>
        
        <div class="contact-card">
          <div class="contact-icon">üïí</div>
          <h3>Business Hours</h3>
          <p>Monday - Sunday<br>8:00 AM - 9:00 PM<br>Open 365 days a year</p>
        </div>
      </div>
      
      <div class="contact-form">
        <h3>Send us a Message</h3>
        <form onsubmit="sendMessage(); return false;">
          <div class="form-row">
            <input type="text" id="contactName" placeholder="Your Name" required>
            <input type="email" id="contactEmail" placeholder="Your Email" required>
          </div>
          <input type="text" id="contactSubject" placeholder="Subject" required>
          <textarea id="contactMessage" placeholder="Your Message" rows="4" required></textarea>
          <button type="submit" class="btn-primary">üì§ Send Message</button>
        </form>
      </div>
      
      <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
        <button onclick="hideContact()" class="btn-secondary">Close</button>
        <button onclick="showMainSection()" class="btn-primary">üõí Back to Shopping</button>
      </div>
    </div>
  </section>

  <script>
    const validUsername = "admin";
    const validPassword = "1234";
    let currentCustomerId = null;
    let bill = [];

    function handleLogin() {
      const u = document.getElementById("username").value.trim();
      const p = document.getElementById("password").value;
      if (u === validUsername && p === validPassword) {
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("customerSection").style.display = "block";
        loadCustomerDropdown();
        renderCustomerList();
      } else {
        alert("Invalid login");
      }
    }

    function addCustomerAndContinue() {
      if (!validateCustomerForm()) {
        ErrorHandler.showError('Please fix the validation errors!', 'error');
        return;
      }
      
      const id = document.getElementById("custId").value.trim();
      const name = document.getElementById("custName").value.trim();
      const phone = document.getElementById("custPhone").value.trim();
      const limit = parseFloat(document.getElementById("custLimit").value);
      
      const customers = JSON.parse(localStorage.getItem("customers") || "[]");
      if (customers.find(c => c.id === id)) {
        ErrorHandler.showError("Customer ID already exists!", 'error');
        return;
      }
      
      try {
        const newCustomer = {
          id, name, phone, limit, dueDate: new Date(Date.now() + 30*24*60*60*1000).toISOString(),
          currentDebt: 0,
          loyaltyPoints: 0,
          totalSpent: 0,
          joinDate: new Date().toISOString()
        };
        customers.push(newCustomer);
        localStorage.setItem("customers", JSON.stringify(customers));
        currentCustomerId = id;
        currentCustomer = newCustomer;
        
        // Update customer name display
        document.getElementById("currentCustomerName").textContent = name;
        
        loadCustomerDropdown();
        renderCustomerList();
        document.getElementById("customerSection").style.display = "none";
        document.getElementById("storeSection").style.display = "block";
        
        // Set the selected customer in store dropdown
        const storeDropdown = document.getElementById("customerDropdown");
        if (storeDropdown) {
          storeDropdown.value = id;
        }
        renderCategories();
        showMonthlySpinStatus();
        
        ErrorHandler.showError(`Customer ${name} added successfully!`, 'success');
      } catch (error) {
        ErrorHandler.showError('Failed to add customer. Please try again.', 'error');
        console.error('Error adding customer:', error);
      }
    }

    function loadCustomerDropdown() {
      const customers = JSON.parse(localStorage.getItem("customers") || "[]");
      const dropdown = document.getElementById("customerDropdown");
      dropdown.innerHTML = '<option value="">-- Select Customer --</option>';
      customers.forEach(c => {
        dropdown.innerHTML += `<option value="${c.id}">${c.name} (${c.id})</option>`;
      });
    }

    function loadExistingCustomers() {
      // This function is now simplified since we use manual input
      console.log("Manual customer selection enabled");
    }

    function selectCustomerById() {
      const customerId = document.getElementById("manualCustomerId").value.trim();
      if (!customerId) {
        alert("Please enter a customer ID!");
        return;
      }
      
      const customers = JSON.parse(localStorage.getItem("customers") || "[]");
      const selectedCustomer = customers.find(c => c.id === customerId);
      
      if (selectedCustomer) {
        currentCustomerId = customerId;
        currentCustomer = selectedCustomer;
        
        // Update customer name display
        document.getElementById("currentCustomerName").textContent = selectedCustomer.name;
        
        alert(`Selected: ${selectedCustomer.name} (ID: ${selectedCustomer.id})`);
        
        // Hide customer section and show store
        document.getElementById("customerSection").style.display = "none";
        document.getElementById("storeSection").style.display = "block";
        
        // Update the store dropdown and set the selected customer
        loadCustomerDropdown();
        const storeDropdown = document.getElementById("customerDropdown");
        if (storeDropdown) {
          storeDropdown.value = customerId; // Set the selected customer in store dropdown
        }
        renderCategories();
        showMonthlySpinStatus(); // Show spin status after customer selection
      } else {
        alert("Customer not found! Please check the ID.");
      }
    }

    function renderCustomerList() {
      const customers = JSON.parse(localStorage.getItem("customers") || "[]");
      const list = document.getElementById("customerList");
      
      if (customers.length === 0) {
        list.innerHTML = "<p style='color: #666;'>No customers registered yet.</p>";
        return;
      }
      
      list.innerHTML = `
        <h4>Registered Customers:</h4>
        ${customers.map(c => {
          const overdue = new Date() > new Date(c.dueDate || Date.now());
          return `
            <div style="padding: 10px; border: 1px solid #eee; margin-bottom: 8px; border-radius: 5px; background: ${overdue ? '#fff5f5' : '#f8f9fa'};">
              <strong>${c.name}</strong> (ID: ${c.id})<br>
              Phone: ${c.phone}<br>
              Current Debt: ‚Çπ${c.currentDebt} / ‚Çπ${c.limit}
              ${overdue ? '<span style="color:red;">(Overdue)</span>' : ''}
            </div>
          `;
        }).join("")}
      `;
    }

    function startShopping() {
      const id = document.getElementById("customerDropdown").value;
      if (!id) return;
      
      const customers = JSON.parse(localStorage.getItem("customers") || "[]");
      const selectedCustomer = customers.find(c => c.id === id);
      
      if (selectedCustomer) {
        currentCustomerId = id;
        currentCustomer = selectedCustomer;
        document.getElementById("currentCustomerName").textContent = selectedCustomer.name;
      }
      
      renderCategories();
    }

    const categories = [
      { name: "Vegetables", icon: "ü•¶", items: [
        { name: "Tomato", price: 20, stock: 50, image: "üçÖ", unit: "kg", description: "Fresh red tomatoes", rating: 4.5, reviews: 12 },
        { name: "Potato", price: 15, stock: 100, image: "ü•î", unit: "kg", description: "Fresh potatoes", rating: 4.2, reviews: 8 },
        { name: "Onion", price: 25, stock: 75, image: "üßÖ", unit: "kg", description: "White onions", rating: 4.0, reviews: 15 },
        { name: "Carrot", price: 18, stock: 30, image: "ü•ï", unit: "kg", description: "Orange carrots", rating: 4.3, reviews: 6 },
        { name: "Cabbage", price: 22, stock: 20, image: "ü•¨", unit: "kg", description: "Fresh cabbage", rating: 4.1, reviews: 4 },
        { name: "Beans", price: 28, stock: 15, image: "ü´ò", unit: "kg", description: "Green beans", rating: 4.4, reviews: 9 },
        { name: "Cauliflower", price: 30, stock: 10, image: "ü•¶", unit: "kg", description: "Fresh cauliflower", rating: 4.6, reviews: 7 },
        { name: "Capsicum", price: 35, stock: 25, image: "üå∂Ô∏è", unit: "kg", description: "Fresh green capsicum", rating: 4.4, reviews: 10 },
        { name: "Brinjal", price: 25, stock: 30, image: "üçÜ", unit: "kg", description: "Fresh purple brinjal", rating: 4.3, reviews: 8 },
        { name: "Sweet Corn", price: 40, stock: 20, image: "üåΩ", unit: "kg", description: "Sweet yellow corn", rating: 4.6, reviews: 12 },
        { name: "Cucumber", price: 15, stock: 40, image: "ü•í", unit: "kg", description: "Fresh green cucumber", rating: 4.2, reviews: 15 },
        { name: "Sweet Potato", price: 20, stock: 35, image: "üç†", unit: "kg", description: "Orange sweet potato", rating: 4.5, reviews: 9 },
        { name: "Mushroom", price: 45, stock: 15, image: "üçÑ", unit: "kg", description: "Fresh white mushrooms", rating: 4.7, reviews: 6 },
        { name: "Red Bell Pepper", price: 40, stock: 20, image: "ü´ë", unit: "kg", description: "Red bell peppers", rating: 4.6, reviews: 8 },
        { name: "Green Chili", price: 12, stock: 50, image: "üå∂Ô∏è", unit: "kg", description: "Spicy green chilies", rating: 4.3, reviews: 20 },
        { name: "Bottle Gourd", price: 18, stock: 25, image: "ü•í", unit: "kg", description: "Fresh bottle gourd", rating: 4.2, reviews: 7 },
        { name: "Ridge Gourd", price: 20, stock: 20, image: "ü•í", unit: "kg", description: "Fresh ridge gourd", rating: 4.1, reviews: 5 },
        { name: "Spinach", price: 15, stock: 30, image: "üåø", unit: "kg", description: "Fresh green spinach", rating: 4.4, reviews: 12 },
        { name: "Fenugreek Leaves", price: 12, stock: 25, image: "üåø", unit: "kg", description: "Fresh methi leaves", rating: 4.3, reviews: 8 },
        { name: "Coriander Leaves", price: 8, stock: 40, image: "üåø", unit: "kg", description: "Fresh dhaniya leaves", rating: 4.5, reviews: 25 },
        { name: "Drumstick", price: 30, stock: 15, image: "ü•¨", unit: "kg", description: "Fresh moringa pods", rating: 4.6, reviews: 6 },
        { name: "Tinda", price: 16, stock: 20, image: "ü•í", unit: "kg", description: "Indian round gourd", rating: 4.2, reviews: 4 },
        { name: "Pumpkin", price: 22, stock: 18, image: "üéÉ", unit: "kg", description: "Fresh orange pumpkin", rating: 4.4, reviews: 7 },
        { name: "Turnip", price: 14, stock: 25, image: "ü•¨", unit: "kg", description: "Fresh white turnip", rating: 4.1, reviews: 6 },
        { name: "Radish", price: 12, stock: 30, image: "ü•¨", unit: "kg", description: "Fresh white radish", rating: 4.3, reviews: 10 },
        { name: "Bitter Gourd", price: 18, stock: 20, image: "ü•í", unit: "kg", description: "Fresh bitter gourd", rating: 4.0, reviews: 5 },
        { name: "Snake Gourd", price: 20, stock: 15, image: "ü•í", unit: "kg", description: "Fresh snake gourd", rating: 4.2, reviews: 4 },
        { name: "Spring Onion", price: 10, stock: 35, image: "üßÖ", unit: "kg", description: "Fresh spring onions", rating: 4.4, reviews: 12 },
        { name: "Cluster Beans", price: 25, stock: 20, image: "ü´ò", unit: "kg", description: "Fresh guar beans", rating: 4.3, reviews: 6 },
        { name: "Ivy Gourd", price: 22, stock: 18, image: "ü•í", unit: "kg", description: "Fresh tindora", rating: 4.2, reviews: 5 }
      ]},
      { name: "Groceries", icon: "üõí", items: [
        { name: "Rice", price: 50, stock: 200, image: "üçö", unit: "kg", description: "Basmati rice", rating: 4.7, reviews: 25 },
        { name: "Wheat Flour", price: 40, stock: 150, image: "üåæ", unit: "kg", description: "Whole wheat flour", rating: 4.5, reviews: 18 },
        { name: "Sugar", price: 30, stock: 80, image: "üçØ", unit: "kg", description: "White sugar", rating: 4.3, reviews: 12 },
        { name: "Salt", price: 10, stock: 100, image: "üßÇ", unit: "kg", description: "Iodized salt", rating: 4.1, reviews: 8 },
        { name: "Oil", price: 90, stock: 60, image: "ü´ó", unit: "liter", description: "Sunflower oil", rating: 4.4, reviews: 15 },
        { name: "Dal", price: 60, stock: 45, image: "ü´ò", unit: "kg", description: "Toor dal", rating: 4.6, reviews: 20 }
      ]},
      { name: "Dairy & Eggs", icon: "ü•õ", items: [
        { name: "Milk", price: 60, stock: 100, image: "ü•õ", unit: "liter", description: "Fresh cow milk", rating: 4.8, reviews: 30 },
        { name: "Eggs", price: 80, stock: 50, image: "ü•ö", unit: "dozen", description: "Farm fresh eggs", rating: 4.6, reviews: 22 },
        { name: "Butter", price: 120, stock: 30, image: "üßà", unit: "pack", description: "Amul butter", rating: 4.5, reviews: 16 },
        { name: "Cheese", price: 200, stock: 25, image: "üßÄ", unit: "pack", description: "Processed cheese", rating: 4.3, reviews: 12 },
        { name: "Yogurt", price: 40, stock: 40, image: "ü•õ", unit: "cup", description: "Fresh curd", rating: 4.4, reviews: 18 },
        { name: "Paneer", price: 300, stock: 15, image: "üßÄ", unit: "kg", description: "Fresh homemade paneer", rating: 4.7, reviews: 14 }
      ]},
      { name: "Snacks & Beverages", icon: "ü•®", items: [
        // Chips & Namkeen
        { name: "Lay's Classic Salted", price: 20, stock: 50, image: "ü•î", unit: "pack", description: "Classic salted potato chips", rating: 4.6, reviews: 120 },
        { name: "Lay's Magic Masala", price: 20, stock: 50, image: "ü•î", unit: "pack", description: "Spicy masala potato chips", rating: 4.7, reviews: 110 },
        { name: "Bingo Mad Angles", price: 25, stock: 40, image: "üî∫", unit: "pack", description: "Tangy triangle chips", rating: 4.5, reviews: 90 },
        { name: "Uncle Chipps", price: 20, stock: 30, image: "üßë‚Äçüåæ", unit: "pack", description: "Classic potato chips", rating: 4.4, reviews: 70 },
        { name: "Kurkure Masala Munch", price: 15, stock: 60, image: "üå∂Ô∏è", unit: "pack", description: "Crunchy spicy sticks", rating: 4.6, reviews: 100 },
        { name: "Haldiram's Aloo Bhujia", price: 30, stock: 50, image: "üçú", unit: "pack", description: "Spicy potato sev", rating: 4.8, reviews: 130 },
        { name: "Haldiram's Moong Dal", price: 30, stock: 50, image: "üå±", unit: "pack", description: "Crispy moong dal", rating: 4.7, reviews: 95 },
        { name: "Balaji Wafers", price: 18, stock: 40, image: "üçü", unit: "pack", description: "Popular potato wafers", rating: 4.3, reviews: 60 },
        { name: "Pringles (Various Flavours)", price: 80, stock: 25, image: "ü•´", unit: "can", description: "Stacked potato crisps", rating: 4.8, reviews: 150 },
        // Biscuits & Cookies
        { name: "Parle-G", price: 10, stock: 100, image: "üç™", unit: "pack", description: "Classic glucose biscuits", rating: 4.9, reviews: 200 },
        { name: "Bourbon", price: 20, stock: 80, image: "üç´", unit: "pack", description: "Chocolate cream biscuits", rating: 4.7, reviews: 110 },
        { name: "Hide & Seek Fab", price: 25, stock: 60, image: "üç´", unit: "pack", description: "Choco chip cookies", rating: 4.8, reviews: 120 },
        { name: "Good Day Cashew Cookies", price: 30, stock: 70, image: "ü•ú", unit: "pack", description: "Cashew nut cookies", rating: 4.6, reviews: 90 },
        { name: "Oreo", price: 25, stock: 90, image: "‚ö´‚ö™", unit: "pack", description: "Chocolate sandwich cookies", rating: 4.8, reviews: 140 },
        { name: "Jim Jam", price: 20, stock: 60, image: "üçì", unit: "pack", description: "Jam-filled biscuits", rating: 4.5, reviews: 80 },
        { name: "Treat (Strawberry/Chocolate)", price: 20, stock: 60, image: "üçìüç´", unit: "pack", description: "Cream biscuits", rating: 4.4, reviews: 70 },
        { name: "Marie Gold", price: 15, stock: 80, image: "üçØ", unit: "pack", description: "Light tea biscuits", rating: 4.7, reviews: 100 },
        { name: "Sunfeast Dark Fantasy Choco Fills", price: 40, stock: 40, image: "üåë", unit: "pack", description: "Choco filled cookies", rating: 4.9, reviews: 160 },
        // Chocolates & Candies
        { name: "Dairy Milk", price: 40, stock: 100, image: "üç´", unit: "bar", description: "Classic milk chocolate", rating: 4.9, reviews: 200 },
        { name: "5 Star", price: 20, stock: 80, image: "‚≠ê", unit: "bar", description: "Caramel chocolate bar", rating: 4.7, reviews: 110 },
        { name: "Perk", price: 15, stock: 90, image: "üç´", unit: "bar", description: "Wafer chocolate bar", rating: 4.6, reviews: 100 },
        { name: "KitKat", price: 20, stock: 90, image: "üç´", unit: "bar", description: "Crispy wafer fingers", rating: 4.8, reviews: 130 },
        { name: "Munch", price: 10, stock: 100, image: "üç´", unit: "bar", description: "Crunchy chocolate bar", rating: 4.5, reviews: 90 },
        { name: "Gems", price: 10, stock: 120, image: "üîµ", unit: "pack", description: "Colorful chocolate buttons", rating: 4.7, reviews: 110 },
        { name: "Eclairs", price: 2, stock: 200, image: "üç¨", unit: "piece", description: "Chocolate caramel candy", rating: 4.6, reviews: 150 },
        { name: "Pulse Candy", price: 1, stock: 250, image: "üü¢", unit: "piece", description: "Tangy candy", rating: 4.8, reviews: 180 },
        { name: "Alpenliebe", price: 2, stock: 200, image: "üç¨", unit: "piece", description: "Sweet caramel candy", rating: 4.5, reviews: 120 },
        // Ready-to-Eat Packets
        { name: "Maggi Instant Noodles", price: 15, stock: 100, image: "üçú", unit: "pack", description: "2-minute noodles", rating: 4.9, reviews: 210 },
        { name: "Yippee Noodles", price: 15, stock: 80, image: "üçù", unit: "pack", description: "Long, non-sticky noodles", rating: 4.7, reviews: 100 },
        { name: "Top Ramen", price: 15, stock: 70, image: "üçú", unit: "pack", description: "Masala noodles", rating: 4.6, reviews: 90 },
        { name: "Knorr Soup Packets", price: 20, stock: 60, image: "ü•£", unit: "pack", description: "Instant soup mix", rating: 4.5, reviews: 80 },
        { name: "Cup Noodles (Veg/Chicken)", price: 35, stock: 50, image: "ü•°", unit: "cup", description: "Ready-to-eat noodles", rating: 4.8, reviews: 120 },
        { name: "MTR Poha/Uttapam Instant Mix", price: 40, stock: 40, image: "ü•û", unit: "pack", description: "Instant Indian breakfast mix", rating: 4.7, reviews: 90 },
        // Other Snacks
        { name: "Roasted Foxnuts (Makhana)", price: 60, stock: 30, image: "üå∞", unit: "pack", description: "Healthy roasted makhana", rating: 4.8, reviews: 70 },
        { name: "Popcorn (Act II)", price: 30, stock: 50, image: "üçø", unit: "pack", description: "Microwave popcorn", rating: 4.7, reviews: 60 },
        { name: "Samosa (Frozen)", price: 50, stock: 20, image: "ü•ü", unit: "pack", description: "Frozen samosas", rating: 4.6, reviews: 40 },
        { name: "Spring Rolls (Frozen)", price: 60, stock: 20, image: "ü•†", unit: "pack", description: "Frozen spring rolls", rating: 4.5, reviews: 35 },
        { name: "Nachos & Salsa", price: 70, stock: 25, image: "üßÄ", unit: "pack", description: "Corn nachos with salsa dip", rating: 4.7, reviews: 50 },
        { name: "Khakhra", price: 30, stock: 30, image: "ü´ì", unit: "pack", description: "Gujarati wheat snack", rating: 4.6, reviews: 30 },
        // Cold Drinks & Sodas
        { name: "Coca-Cola", price: 40, stock: 60, image: "ü•§", unit: "bottle", description: "Classic cola drink", rating: 4.8, reviews: 120 },
        { name: "Pepsi", price: 40, stock: 60, image: "ü•§", unit: "bottle", description: "Popular cola drink", rating: 4.7, reviews: 110 },
        { name: "Sprite", price: 40, stock: 60, image: "ü•§", unit: "bottle", description: "Lemon-lime soda", rating: 4.6, reviews: 100 },
        { name: "Thums Up", price: 40, stock: 60, image: "ü•§", unit: "bottle", description: "Strong cola drink", rating: 4.7, reviews: 90 },
        { name: "Fanta", price: 40, stock: 60, image: "üü†", unit: "bottle", description: "Orange flavored soda", rating: 4.6, reviews: 80 },
        { name: "Mountain Dew", price: 40, stock: 60, image: "üü¢", unit: "bottle", description: "Citrus flavored soda", rating: 4.5, reviews: 70 },
        { name: "Limca", price: 40, stock: 60, image: "üü°", unit: "bottle", description: "Lime-lemon soda", rating: 4.4, reviews: 60 },
        { name: "Maaza", price: 40, stock: 60, image: "ü•≠", unit: "bottle", description: "Mango drink", rating: 4.8, reviews: 100 },
        { name: "Appy Fizz", price: 40, stock: 60, image: "üçè", unit: "bottle", description: "Apple flavored drink", rating: 4.7, reviews: 80 },
        // Juices
        { name: "Real Fruit Juice (Mixed Fruit, Mango, Apple, Orange)", price: 60, stock: 40, image: "üçπ", unit: "pack", description: "Assorted fruit juices", rating: 4.8, reviews: 90 },
        { name: "Tropicana (Pomegranate, Guava, Litchi, etc.)", price: 70, stock: 35, image: "üßÉ", unit: "pack", description: "Premium fruit juices", rating: 4.7, reviews: 80 },
        { name: "Paper Boat Drinks", price: 40, stock: 30, image: "üõ∂", unit: "pack", description: "Traditional Indian drinks", rating: 4.6, reviews: 60 },
        { name: "Slice Mango Drink", price: 40, stock: 30, image: "ü•≠", unit: "bottle", description: "Mango drink", rating: 4.7, reviews: 70 },
        // Energy & Health Drinks
        { name: "Red Bull", price: 110, stock: 20, image: "üêÇ", unit: "can", description: "Energy drink", rating: 4.8, reviews: 60 },
        { name: "Gatorade", price: 60, stock: 25, image: "üèÉ", unit: "bottle", description: "Sports drink", rating: 4.7, reviews: 50 },
        { name: "Glucon-D", price: 30, stock: 40, image: "üíß", unit: "pack", description: "Glucose energy drink", rating: 4.6, reviews: 40 },
        { name: "ORS", price: 25, stock: 30, image: "üíß", unit: "pack", description: "Oral rehydration salts", rating: 4.5, reviews: 30 },
        { name: "Bournvita", price: 120, stock: 35, image: "üç´", unit: "jar", description: "Health drink", rating: 4.8, reviews: 80 },
        { name: "Horlicks", price: 130, stock: 30, image: "ü•õ", unit: "jar", description: "Malted milk drink", rating: 4.7, reviews: 70 },
        { name: "Boost", price: 120, stock: 25, image: "üèãÔ∏è", unit: "jar", description: "Energy drink", rating: 4.6, reviews: 60 },
        { name: "Complan", price: 140, stock: 20, image: "üßí", unit: "jar", description: "Health drink for kids", rating: 4.7, reviews: 50 },
        // Tea & Coffee
        { name: "Taj Mahal Tea", price: 60, stock: 40, image: "üçµ", unit: "box", description: "Premium tea leaves", rating: 4.8, reviews: 90 },
        { name: "Red Label Tea", price: 55, stock: 35, image: "üçµ", unit: "box", description: "Strong tea leaves", rating: 4.7, reviews: 80 },
        { name: "Green Tea (Lipton/Tetley)", price: 70, stock: 30, image: "üçÉ", unit: "box", description: "Green tea bags", rating: 4.6, reviews: 70 },
        { name: "Nescafe Instant Coffee", price: 90, stock: 30, image: "‚òï", unit: "jar", description: "Instant coffee powder", rating: 4.8, reviews: 100 },
        { name: "Bru Coffee", price: 85, stock: 25, image: "‚òï", unit: "jar", description: "Instant coffee powder", rating: 4.7, reviews: 80 },
        { name: "Cold Coffee (Ready to Drink ‚Äì Nescafe/Amul)", price: 40, stock: 20, image: "üßä", unit: "bottle", description: "Ready to drink cold coffee", rating: 4.6, reviews: 60 },
        // Packaged Water & Milk
        { name: "Bisleri", price: 20, stock: 100, image: "üíß", unit: "bottle", description: "Packaged drinking water", rating: 4.9, reviews: 200 },
        { name: "Kinley", price: 20, stock: 80, image: "üíß", unit: "bottle", description: "Packaged drinking water", rating: 4.8, reviews: 150 },
        { name: "Aquafina", price: 20, stock: 70, image: "üíß", unit: "bottle", description: "Packaged drinking water", rating: 4.7, reviews: 120 },
        { name: "Amul Milk (Tetra Pack)", price: 30, stock: 60, image: "ü•õ", unit: "pack", description: "Tetra pack milk", rating: 4.8, reviews: 100 },
        { name: "Mother Dairy Milk", price: 30, stock: 50, image: "ü•õ", unit: "pack", description: "Fresh milk", rating: 4.7, reviews: 90 },
        { name: "Soy Milk (Sofit)", price: 40, stock: 30, image: "üå±", unit: "pack", description: "Plant-based milk", rating: 4.6, reviews: 60 }
      ]},
      { name: "Household", icon: "üß¥", items: [
        { name: "Soap", price: 25, stock: 120, image: "üßº", unit: "piece", description: "Lifebuoy soap", rating: 4.2, reviews: 55 },
        { name: "Detergent", price: 80, stock: 50, image: "üß¥", unit: "pack", description: "Surf excel", rating: 4.4, reviews: 32 },
        { name: "Toothpaste", price: 60, stock: 80, image: "ü™•", unit: "tube", description: "Colgate paste", rating: 4.3, reviews: 48 },
        { name: "Shampoo", price: 120, stock: 40, image: "üß¥", unit: "bottle", description: "Head & Shoulders", rating: 4.5, reviews: 26 },
        { name: "Tissue", price: 40, stock: 60, image: "üßª", unit: "pack", description: "Soft tissue paper", rating: 4.1, reviews: 18 },
        { name: "Cleaning", price: 50, stock: 45, image: "üßΩ", unit: "bottle", description: "Harpic cleaner", rating: 4.0, reviews: 22 }
      ]},
      { name: "Pooja Items", icon: "üõï", items: [
        { name: "Agarbatti", price: 10, stock: 200, image: "üïâÔ∏è", unit: "pack", description: "Sandalwood agarbatti", rating: 4.6, reviews: 15 },
        { name: "Camphor", price: 15, stock: 150, image: "üïØÔ∏è", unit: "pack", description: "Pure camphor", rating: 4.4, reviews: 12 },
        { name: "Kumkum", price: 5, stock: 300, image: "üî¥", unit: "pack", description: "Sacred kumkum", rating: 4.3, reviews: 8 },
        { name: "Oil Lamp", price: 25, stock: 50, image: "ü™î", unit: "piece", description: "Brass oil lamp", rating: 4.5, reviews: 6 },
        { name: "Flowers", price: 20, stock: 100, image: "üå∏", unit: "bunch", description: "Fresh flowers", rating: 4.7, reviews: 20 }
      ]},
      { name: "Stationery", icon: "‚úèÔ∏è", items: [
        { name: "Notebook", price: 25, stock: 100, image: "üìì", unit: "piece", description: "A4 notebook", rating: 4.2, reviews: 35 },
        { name: "Pen", price: 10, stock: 200, image: "üñäÔ∏è", unit: "piece", description: "Blue ball pen", rating: 4.0, reviews: 45 },
        { name: "Pencil", price: 5, stock: 300, image: "‚úèÔ∏è", unit: "piece", description: "HB pencil", rating: 4.1, reviews: 52 },
        { name: "Eraser", price: 3, stock: 150, image: "üßΩ", unit: "piece", description: "White eraser", rating: 4.3, reviews: 28 },
        { name: "Scale", price: 8, stock: 80, image: "üìè", unit: "piece", description: "15cm scale", rating: 4.4, reviews: 15 }
      ]},
      { name: "Smoke & Tobacco", icon: "üö¨", items: [
        { name: "Organic Gold Leaf", price: 450, stock: 25, image: "ü•á", unit: "pack", description: "Premium organic cigarettes - 20 sticks", rating: 4.8, reviews: 45 },
        { name: "Natural Blend", price: 380, stock: 30, image: "üåø", unit: "pack", description: "Natural tobacco blend - 20 sticks", rating: 4.6, reviews: 38 },
        { name: "Herbal Mix", price: 420, stock: 20, image: "üå±", unit: "pack", description: "Herbal organic cigarettes - 20 sticks", rating: 4.7, reviews: 42 },
        { name: "Pure Leaf", price: 500, stock: 15, image: "üíé", unit: "pack", description: "Ultra premium organic - 20 sticks", rating: 4.9, reviews: 50 },
        { name: "Green Blend", price: 350, stock: 35, image: "üå≤", unit: "pack", description: "Eco-friendly organic - 20 sticks", rating: 4.5, reviews: 35 },
        { name: "Classic Organic", price: 400, stock: 28, image: "üçÉ", unit: "pack", description: "Traditional organic blend - 20 sticks", rating: 4.6, reviews: 40 },
        { name: "Premium Filter", price: 480, stock: 18, image: "‚≠ê", unit: "pack", description: "Filtered organic cigarettes - 20 sticks", rating: 4.8, reviews: 48 },
        { name: "Natural Light", price: 320, stock: 40, image: "‚òÅÔ∏è", unit: "pack", description: "Light organic blend - 20 sticks", rating: 4.4, reviews: 32 }
      ]},
      { name: "Personal Care & Hygiene", icon: "üß¥", items: [
        { name: "Pampers Baby Dry", price: 850, stock: 40, image: "üë∂", unit: "pack", description: "Size 4 - 40 pieces, overnight protection", rating: 4.7, reviews: 120 },
        { name: "Pampers Active Baby", price: 750, stock: 35, image: "üë∂", unit: "pack", description: "Size 3 - 44 pieces, comfortable fit", rating: 4.6, reviews: 95 },
        { name: "Pampers Newborn", price: 650, stock: 50, image: "üë∂", unit: "pack", description: "Size 1 - 36 pieces, gentle on skin", rating: 4.8, reviews: 85 },
        { name: "Stayfree Sanitary Pads", price: 180, stock: 60, image: "üå∏", unit: "pack", description: "Regular - 20 pieces, cotton comfort", rating: 4.5, reviews: 75 },
        { name: "Whisper Ultra", price: 220, stock: 45, image: "üå∏", unit: "pack", description: "Ultra thin - 15 pieces, wings protection", rating: 4.6, reviews: 68 },
        { name: "Carefree Panty Liners", price: 120, stock: 80, image: "üå∏", unit: "pack", description: "Daily freshness - 30 pieces", rating: 4.4, reviews: 52 },
        { name: "Philips Trimmer", price: 1200, stock: 15, image: "‚úÇÔ∏è", unit: "piece", description: "Beard trimmer, rechargeable", rating: 4.7, reviews: 45 },
        { name: "Braun Razor", price: 350, stock: 25, image: "ü™í", unit: "piece", description: "3-blade disposable razor", rating: 4.3, reviews: 38 },
        { name: "Gillette Fusion", price: 450, stock: 20, image: "ü™í", unit: "piece", description: "5-blade razor with gel strip", rating: 4.5, reviews: 42 },
        { name: "Veet Hair Removal", price: 280, stock: 30, image: "üß¥", unit: "tube", description: "Cream hair remover, sensitive skin", rating: 4.2, reviews: 35 },
        { name: "Nivea Deodorant", price: 180, stock: 40, image: "üß¥", unit: "piece", description: "Men's roll-on, 48hr protection", rating: 4.4, reviews: 58 },
        { name: "Dove Soap", price: 45, stock: 100, image: "üßº", unit: "piece", description: "Moisturizing beauty soap", rating: 4.6, reviews: 85 },
        { name: "Colgate Toothpaste", price: 85, stock: 80, image: "ü™•", unit: "tube", description: "Strong teeth, fresh breath", rating: 4.5, reviews: 92 },
        { name: "Oral-B Toothbrush", price: 120, stock: 60, image: "ü™•", unit: "piece", description: "Soft bristles, comfortable grip", rating: 4.3, reviews: 48 },
        { name: "Head & Shoulders", price: 220, stock: 35, image: "üß¥", unit: "bottle", description: "Anti-dandruff shampoo, 400ml", rating: 4.4, reviews: 65 },
        { name: "Dove Shampoo", price: 180, stock: 45, image: "üß¥", unit: "bottle", description: "Nourishing hair care, 400ml", rating: 4.5, reviews: 72 },
        { name: "Vaseline Petroleum", price: 95, stock: 70, image: "üß¥", unit: "jar", description: "Pure petroleum jelly, 100g", rating: 4.6, reviews: 88 },
        { name: "Johnson's Baby Oil", price: 120, stock: 55, image: "üß¥", unit: "bottle", description: "Gentle baby massage oil, 200ml", rating: 4.7, reviews: 95 },
        { name: "Fair & Lovely", price: 150, stock: 40, image: "üß¥", unit: "tube", description: "Fairness cream, 25g", rating: 4.3, reviews: 62 },
        { name: "Ponds Cold Cream", price: 85, stock: 65, image: "üß¥", unit: "jar", description: "Moisturizing cold cream, 50g", rating: 4.4, reviews: 78 }
      ]}
    ];

    // --- Persistent Cart ---
    let cart = [];
    
    // --- Loyalty Program ---
    let loyaltyPoints = JSON.parse(localStorage.getItem('loyaltyPoints') || '0');
    let loyaltyTier = JSON.parse(localStorage.getItem('loyaltyTier') || '"Bronze"');
    
    function calculateLoyaltyPoints(amount) {
      return Math.floor(amount / 10); // 1 point per ‚Çπ10 spent
    }
    
    function updateLoyaltyTier() {
      const totalPoints = loyaltyPoints;
      if (totalPoints >= 1000) {
        loyaltyTier = "Diamond";
      } else if (totalPoints >= 500) {
        loyaltyTier = "Gold";
      } else if (totalPoints >= 200) {
        loyaltyTier = "Silver";
      } else {
        loyaltyTier = "Bronze";
      }
      localStorage.setItem('loyaltyTier', JSON.stringify(loyaltyTier));
    }
    
    function getLoyaltyDiscount() {
      switch(loyaltyTier) {
        case "Diamond": return 0.15; // 15% discount
        case "Gold": return 0.10;     // 10% discount
        case "Silver": return 0.05;   // 5% discount
        default: return 0.02;         // 2% discount
      }
    }
    
    function updateLoyaltyDisplay() {
      const loyaltyIcon = document.getElementById('loyaltyIcon');
      const loyaltyTierText = document.getElementById('loyaltyTierText');
      const loyaltyPointsText = document.getElementById('loyaltyPointsText');
      
      if (loyaltyIcon && loyaltyTierText && loyaltyPointsText) {
        // Update icon based on tier
        switch(loyaltyTier) {
          case "Diamond": loyaltyIcon.textContent = "üíé"; break;
          case "Gold": loyaltyIcon.textContent = "ü•á"; break;
          case "Silver": loyaltyIcon.textContent = "ü•à"; break;
          default: loyaltyIcon.textContent = "ü•â"; break;
        }
        
        loyaltyTierText.textContent = loyaltyTier;
        loyaltyPointsText.textContent = `${loyaltyPoints} pts`;
      }
    }
    
    function showLoyaltyInfo() {
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.id = 'loyaltyModal';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 500px;">
          <div class="modal-header">
            <h3>üéØ Loyalty Program</h3>
            <span class="close" onclick="closeModal('loyaltyModal')">&times;</span>
          </div>
          <div class="modal-body">
            <div style="text-align: center; margin-bottom: 2rem;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">${loyaltyTier === "Diamond" ? "üíé" : loyaltyTier === "Gold" ? "ü•á" : loyaltyTier === "Silver" ? "ü•à" : "ü•â"}</div>
              <h2 style="margin: 0 0 0.5rem; color: #2d3748;">${loyaltyTier} Member</h2>
              <p style="margin: 0; color: #718096;">${loyaltyPoints} Total Points</p>
            </div>
            
            <div style="background: linear-gradient(45deg, #f7fafc, #edf2f7); padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem;">
              <h4 style="margin: 0 0 1rem; color: #2d3748;">Current Benefits</h4>
              <ul style="margin: 0; padding-left: 1.5rem; color: #4a5568;">
                <li>${Math.round(getLoyaltyDiscount() * 100)}% discount on all purchases</li>
                <li>Priority customer service</li>
                <li>Exclusive offers and deals</li>
                <li>Birthday special discounts</li>
              </ul>
            </div>
            
            <div style="background: linear-gradient(45deg, #fef5e7, #fed7aa); padding: 1.5rem; border-radius: 12px;">
              <h4 style="margin: 0 0 1rem; color: #92400e;">Next Tier Progress</h4>
              <div style="margin-bottom: 1rem;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                  <span style="color: #92400e; font-weight: 600;">Progress to ${loyaltyTier === "Bronze" ? "Silver" : loyaltyTier === "Silver" ? "Gold" : loyaltyTier === "Gold" ? "Diamond" : "Max"}</span>
                  <span style="color: #92400e; font-weight: 600;">${loyaltyPoints}/${loyaltyTier === "Bronze" ? "200" : loyaltyTier === "Silver" ? "500" : loyaltyTier === "Gold" ? "1000" : "1000"} pts</span>
                </div>
                <div style="background: #e2e8f0; height: 8px; border-radius: 4px; overflow: hidden;">
                  <div style="background: linear-gradient(45deg, #f59e0b, #fbbf24); height: 100%; width: ${Math.min(100, (loyaltyPoints / (loyaltyTier === "Bronze" ? 200 : loyaltyTier === "Silver" ? 500 : loyaltyTier === "Gold" ? 1000 : 1000)) * 100)}%;"></div>
                </div>
              </div>
              <p style="margin: 0; color: #92400e; font-size: 0.9rem;">
                üí° Earn 1 point for every ‚Çπ10 spent. Higher tiers get better discounts!
              </p>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }
    
    // Recipe Ingredients Function
    function addRecipeIngredients(recipe) {
      const recipes = {
        'Pulao': [
          { name: 'Rice', quantity: 1, price: 50 },
          { name: 'Onion', quantity: 0.5, price: 25 },
          { name: 'Carrot', quantity: 0.25, price: 18 },
          { name: 'Oil', quantity: 0.1, price: 90 }
        ],
        'Dal': [
          { name: 'Dal', quantity: 0.5, price: 60 },
          { name: 'Rice', quantity: 0.5, price: 50 },
          { name: 'Onion', quantity: 0.25, price: 25 },
          { name: 'Oil', quantity: 0.05, price: 90 }
        ],
        'Salad': [
          { name: 'Tomato', quantity: 0.5, price: 20 },
          { name: 'Carrot', quantity: 0.25, price: 18 },
          { name: 'Cabbage', quantity: 0.25, price: 22 }
        ]
      };
      
      const ingredients = recipes[recipe];
      if (!ingredients) return;
      
      let totalAdded = 0;
      ingredients.forEach(ingredient => {
        const existing = cart.find(item => item.name === ingredient.name);
        if (existing) {
          existing.quantity += ingredient.quantity;
          existing.total = (existing.quantity * existing.price).toFixed(2);
          totalAdded++;
        } else {
          cart.push({
            name: ingredient.name,
            price: ingredient.price,
            quantity: ingredient.quantity,
            total: (ingredient.quantity * ingredient.price).toFixed(2)
          });
          totalAdded++;
        }
      });
      
      saveCart();
      renderCart();
      
      showNotification(`‚úÖ Added ${totalAdded} ingredients for ${recipe} recipe to cart!`, 'success');
    }

    function saveCart() {
      localStorage.setItem("cart", JSON.stringify(cart));
    }

    function loadCart() {
      const stored = localStorage.getItem("cart");
      cart = stored ? JSON.parse(stored) : [];
      renderCart();
    }

    function addToCart(item, quantity) {
      quantity = parseFloat(quantity);
      if (isNaN(quantity) || quantity <= 0) {
        alert("Please enter a valid quantity.");
        return;
      }
      
      // Check stock availability
      if (quantity > item.stock) {
        alert(`Sorry! Only ${item.stock} kg available in stock.`);
        return;
      }
      
      const existing = cart.find(i => i.name === item.name);
      if (existing) {
        const newTotalQty = existing.quantity + quantity;
        if (newTotalQty > item.stock) {
          alert(`Sorry! Only ${item.stock} kg available in stock.`);
          return;
        }
        existing.quantity = newTotalQty;
        existing.total = (existing.quantity * item.price).toFixed(2);
      } else {
        cart.push({
          name: item.name,
          price: item.price,
          quantity: quantity,
          total: (quantity * item.price).toFixed(2)
        });
      }
      
      // Reduce stock
      item.stock -= quantity;
      
      saveCart();
      renderCart();
      alert(`${item.name} added to cart! Stock remaining: ${item.stock} kg`);
    }

    function removeFromCart(itemName) {
      cart = cart.filter(item => item.name !== itemName);
      saveCart();
      renderCart();
    }

    function updateCartQuantity(itemName, newQuantity) {
      newQuantity = parseFloat(newQuantity);
      if (isNaN(newQuantity) || newQuantity <= 0) return;
      const item = cart.find(i => i.name === itemName);
      if (item) {
        item.quantity = newQuantity;
        item.total = (item.quantity * item.price).toFixed(2);
        saveCart();
        renderCart();
      }
    }

    // --- Katha System Data ---
    let customers = JSON.parse(localStorage.getItem('customers') || '[]');
    let kathaRecords = JSON.parse(localStorage.getItem('kathaRecords') || '[]');
    let currentCustomer = null;

    function addCustomer() {
      const name = prompt("Enter customer name:");
      if (!name) return;
      const phone = prompt("Enter phone number:");
      const creditLimit = parseFloat(prompt("Enter credit limit (‚Çπ):") || "1000");
      const customer = {
        id: Date.now(),
        name,
        phone,
        creditLimit,
        currentDebt: 0
      };
      customers.push(customer);
      localStorage.setItem('customers', JSON.stringify(customers));
      alert(`Customer ${name} added!`);
      showKathaSection();
    }

    function selectCustomer() {
      if (customers.length === 0) {
        alert("No customers registered. Please add a customer first.");
        return;
      }
      const options = customers.map(c => `${c.id} - ${c.name} (Debt: ‚Çπ${c.currentDebt})`).join('\n');
      const selected = prompt(`Select Customer:\n${options}`);
      if (!selected) return;
      const customerId = parseInt(selected.split(' - ')[0]);
      currentCustomer = customers.find(c => c.id === customerId);
      if (currentCustomer) {
        alert(`Selected: ${currentCustomer.name}`);
      }
    }

    function addToKatha(item, quantity) {
      if (!currentCustomer) {
        alert("Please select a customer first (from Katha menu)!");
        return;
      }
      quantity = parseFloat(quantity);
      if (isNaN(quantity) || quantity <= 0) {
        alert("Please enter a valid quantity.");
        return;
      }
      
      // Check stock availability
      if (quantity > item.stock) {
        alert(`Sorry! Only ${item.stock} kg available in stock.`);
        return;
      }
      
      const totalAmount = item.price * quantity;
      const newDebt = currentCustomer.currentDebt + totalAmount;
      if (newDebt > currentCustomer.creditLimit) {
        alert(`Credit limit exceeded! Current debt: ‚Çπ${currentCustomer.currentDebt}, Limit: ‚Çπ${currentCustomer.creditLimit}`);
        return;
      }
      
      // Add to katha records
      const kathaRecord = {
        id: Date.now(),
        customerId: currentCustomer.id,
        customerName: currentCustomer.name,
        itemName: item.name,
        quantity,
        price: item.price,
        totalAmount,
        date: new Date().toISOString(),
        dueDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
        status: 'pending'
      };
      kathaRecords.push(kathaRecord);
      
      // Update customer debt
      currentCustomer.currentDebt = newDebt;
      customers = customers.map(c => c.id === currentCustomer.id ? currentCustomer : c);
      
      // Reduce stock
      item.stock -= quantity;
      
      // Save to localStorage
      localStorage.setItem('kathaRecords', JSON.stringify(kathaRecords));
      localStorage.setItem('customers', JSON.stringify(customers));
      alert(`Added to Katha: ${item.name} x${quantity} = ‚Çπ${totalAmount}\nCustomer: ${currentCustomer.name}\nStock remaining: ${item.stock} kg`);
    }

    function markAsPaid(recordId) {
      const record = kathaRecords.find(r => r.id === recordId);
      if (!record) return;
      record.status = 'paid';
      // Update customer debt
      const customer = customers.find(c => c.id === record.customerId);
      if (customer) {
        customer.currentDebt = Math.max(0, customer.currentDebt - record.totalAmount);
      }
      localStorage.setItem('kathaRecords', JSON.stringify(kathaRecords));
      localStorage.setItem('customers', JSON.stringify(customers));
      alert(`Payment recorded!`);
      showKathaSection();
    }

    function showMainSection() {
      // Show the homepage content
      document.getElementById('homepage').style.display = 'block';
      document.getElementById('storeSection').style.display = 'none';
      document.getElementById('customerSection').style.display = 'none';
      document.getElementById('loginSection').style.display = 'none';
      
      // Reset other sections
      document.getElementById('categoryGrid').style.display = 'grid';
      document.getElementById('itemsSection').style.display = 'block';
      document.getElementById('cartSection').style.display = 'none';
      document.getElementById('kathaSection').style.display = 'none';
      document.getElementById('billHistorySection').style.display = 'none';
    }

    // --- Render Functions ---
    function renderCategories(selectedCategory = null) {
      const grid = document.getElementById("categoryGrid");
      grid.innerHTML = categories.map(cat => `
        <div class="category-card${selectedCategory && selectedCategory.name === cat.name ? " active" : ""}" data-cat="${cat.name}">
          <span class="category-icon">${cat.icon}</span>
          <div class="category-name">${cat.name}</div>
        </div>
      `).join("");

      document.querySelectorAll(".category-card").forEach(card => {
        card.onclick = function () {
          const catName = card.getAttribute("data-cat");
          const cat = categories.find(c => c.name === catName);
          renderItems(catName);
        };
      });
    }

    function renderItems(category) {
      const section = document.getElementById("itemsSection");
      if (!section) return;
      
      const categoryData = categories.find(cat => cat.name === category);
      if (!categoryData) return;
      
      // Age verification for smoke products
      if (category === "Smoke & Tobacco") {
        const age = prompt("üö¨ Age Verification Required\n\nYou must be 18+ to view smoke products.\n\nPlease enter your age:");
        if (!age || parseInt(age) < 18) {
          alert("‚ùå Access Denied: You must be 18 or older to view smoke products.");
          return;
        }
      }
      
      section.style.display = "block";
      section.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
          <h3 style="display: flex; align-items: center; gap: 0.5rem; color: #2d3748;">
            <span style="font-size: 1.5rem;">${categoryData.icon}</span>
            <span>${categoryData.name}</span>
          </h3>
          <button onclick="showMainSection()" class="btn-secondary">üõí Back to Categories</button>
        </div>
        
        ${category === "Smoke & Tobacco" ? `
          <div style="
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border: 2px solid #ef4444;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            text-align: center;
          ">
            <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 0.5rem;">
              <span style="font-size: 1.2rem;">‚ö†Ô∏è</span>
              <strong style="color: #dc2626;">Health Warning</strong>
            </div>
            <p style="margin: 0; color: #7f1d1d; font-size: 0.9rem;">
              Smoking is injurious to health. Contains nicotine which is addictive. 
              Only for adults 18+ years. Organic products may still contain harmful substances.
            </p>
          </div>
        ` : ''}
        <div class="items-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem;">
          ${categoryData.items.map(item => `
            <div class="item-card" style="
              background: ${category === "Smoke & Tobacco" ? 'linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%)' : 'white'}; 
              border-radius: 16px; 
              padding: 1.5rem; 
              box-shadow: 0 4px 20px rgba(0,0,0,0.1); 
              border: 1px solid ${category === "Smoke & Tobacco" ? '#ef4444' : '#e2e8f0'};
              transition: all 0.3s ease;
              position: relative;
              ${item.stock <= 0 ? 'opacity: 0.6;' : item.stock <= 5 ? 'border-color: #f59e0b;' : ''}
            " onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 30px rgba(0,0,0,0.15)'" 
               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 20px rgba(0,0,0,0.1)'">
              
              ${item.stock <= 0 ? '<div style="position: absolute; top: 1rem; right: 1rem; background: #ef4444; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">OUT OF STOCK</div>' : ''}
              ${item.stock <= 5 && item.stock > 0 ? '<div style="position: absolute; top: 1rem; right: 1rem; background: #f59e0b; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">LOW STOCK</div>' : ''}
              ${category === "Smoke & Tobacco" ? '<div style="position: absolute; top: 1rem; left: 1rem; background: #dc2626; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">18+ ONLY</div>' : ''}
              
              <div style="text-align: center; margin-bottom: 1rem;">
                <div style="font-size: 3rem; margin-bottom: 0.5rem;">${item.image}</div>
                <h4 style="margin: 0 0 0.5rem; color: #2d3748; font-size: 1.1rem; font-weight: 600;">${item.name}</h4>
                <p style="margin: 0; color: #718096; font-size: 0.9rem;">${item.description}</p>
              </div>
              
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <div style="text-align: center;">
                  <p style="margin: 0; color: #059669; font-size: 1.2rem; font-weight: 700;">‚Çπ${item.price}</p>
                  <small style="color: #718096;">per ${item.unit}</small>
                </div>
                <div style="text-align: center;">
                  <div style="display: flex; align-items: center; gap: 0.25rem; margin-bottom: 0.25rem;">
                    ${'‚≠ê'.repeat(Math.floor(item.rating))}${item.rating % 1 >= 0.5 ? '‚≠ê' : ''}
                    <span style="color: #f59e0b; font-weight: 600; font-size: 0.9rem;">${item.rating}</span>
                  </div>
                  <small style="color: #718096;">(${item.reviews} reviews)</small>
                </div>
              </div>
              
              <div style="margin-bottom: 1rem;">
                <p style="margin: 0; font-size: 0.9rem; color: #4a5568;">
                  <span style="font-weight: 600;">Stock:</span> 
                  <span style="color: ${item.stock <= 0 ? '#ef4444' : item.stock <= 5 ? '#f59e0b' : '#059669'}; font-weight: 600;">
                    ${item.stock} ${item.unit}
                  </span>
                </div>
              
              <div class="item-actions" style="display: flex; gap: 0.5rem; align-items: center;">
                <input type="number" min="1" step="1" value="1" class="quantity-input" data-item="${item.name}" 
                       style="flex: 1; padding: 0.75rem; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 0.9rem;"
                       placeholder="Qty in ${item.unit}">
                <button onclick="addToCartFromUI('${item.name}', ${item.price}, '${item.unit}')" 
                        ${item.stock <= 0 ? 'disabled' : ''} 
                        style="
                          flex: 1; 
                          padding: 0.75rem; 
                          background: ${item.stock <= 0 ? '#9ca3af' : 'linear-gradient(45deg, #059669, #10b981)'}; 
                          color: white; 
                          border: none; 
                          border-radius: 8px; 
                          cursor: ${item.stock <= 0 ? 'not-allowed' : 'pointer'}; 
                          font-weight: 600; 
                          font-size: 0.9rem;
                          transition: all 0.3s ease;
                        "
                        onmouseover="${item.stock > 0 ? 'this.style.transform=\'scale(1.02)\'' : ''}"
                        onmouseout="${item.stock > 0 ? 'this.style.transform=\'scale(1)\'' : ''}">
                  ${item.stock <= 0 ? 'Out of Stock' : 'üõí Add to Cart'}
                </button>
              </div>
            </div>
          `).join("")}
        </div>
      `;
    }
    
    // Search and Filter Functions
    function filterItems() {
      const searchTerm = document.getElementById('searchItems').value.toLowerCase();
      const categoryFilter = document.getElementById('categoryFilter').value;
      const stockFilter = document.getElementById('stockFilter').value;
      
      let allItems = [];
      categories.forEach(category => {
        category.items.forEach(item => {
          allItems.push({
            ...item,
            category: category.name,
            categoryIcon: category.icon
          });
        });
      });
      
      // Apply filters
      let filteredItems = allItems.filter(item => {
        const matchesSearch = item.name.toLowerCase().includes(searchTerm);
        const matchesCategory = !categoryFilter || item.category === categoryFilter;
        const matchesStock = !stockFilter || 
          (stockFilter === 'in-stock' && item.stock > 5) ||
          (stockFilter === 'low-stock' && item.stock > 0 && item.stock <= 5) ||
          (stockFilter === 'out-of-stock' && item.stock <= 0);
        
        return matchesSearch && matchesCategory && matchesStock;
      });
      
      // Display filtered results
      const section = document.getElementById("itemsSection");
      if (filteredItems.length === 0) {
        section.innerHTML = `
          <div style="text-align: center; padding: 3rem; color: #666;">
            <h3>üîç No items found</h3>
            <p>Try adjusting your search criteria or filters.</p>
            <button onclick="clearFilters()" class="btn-primary">Clear Filters</button>
          </div>
        `;
      } else {
        section.innerHTML = `
          <h3>üîç Search Results (${filteredItems.length} items)</h3>
          <div class="items-grid">
            ${filteredItems.map(item => `
              <div class="item-card ${item.stock <= 0 ? 'out-of-stock' : item.stock <= 5 ? 'low-stock' : ''}">
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                  <span>${item.categoryIcon}</span>
                  <small style="color: #666;">${item.category}</small>
                </div>
                <h4>${item.name}</h4>
                <p class="price">‚Çπ${item.price}/kg</p>
                <p class="stock ${item.stock <= 0 ? 'out-of-stock' : item.stock <= 5 ? 'low-stock' : 'in-stock'}">
                  ${item.stock <= 0 ? '‚ùå Out of Stock' : item.stock <= 5 ? '‚ö†Ô∏è Low Stock' : '‚úÖ In Stock'} (${item.stock} kg)
                </p>
                <div class="item-actions">
                  <input type="number" min="0.1" step="0.1" value="1" class="quantity-input" data-item="${item.name}">
                  <button onclick="addToCartFromUI('${item.name}', ${item.price})" ${item.stock <= 0 ? 'disabled' : ''} class="add-to-cart-btn">
                    ${item.stock <= 0 ? 'Out of Stock' : 'Add to Cart'}
                  </button>
                </div>
              </div>
            `).join("")}
          </div>
        `;
      }
    }
    
    function clearFilters() {
      document.getElementById('searchItems').value = '';
      document.getElementById('categoryFilter').value = '';
      document.getElementById('stockFilter').value = '';
      document.getElementById('itemsSection').style.display = 'none';
    }
    
    // Add event listeners for real-time search
    document.addEventListener('DOMContentLoaded', function() {
      const searchInput = document.getElementById('searchItems');
      if (searchInput) {
        searchInput.addEventListener('input', function() {
          if (this.value.length > 0) {
            filterItems();
          } else {
            document.getElementById('itemsSection').style.display = 'none';
          }
        });
      }
    });

    window.addToCartFromUI = function(itemName, price, unit = 'kg') {
      // Find the item in categories
      let foundItem = null;
      let foundCategory = null;
      
      for (let category of categories) {
        foundItem = category.items.find(item => item.name === itemName);
        if (foundItem) {
          foundCategory = category;
          break;
        }
      }
      
      if (!foundItem) {
        alert("Item not found!");
        return;
      }
      
      // Get quantity from input
      const quantityInput = document.querySelector(`input[data-item="${itemName}"]`);
      const quantity = parseFloat(quantityInput ? quantityInput.value : 1);
      
      if (isNaN(quantity) || quantity <= 0) {
        alert("Please enter a valid quantity.");
        return;
      }
      
      // Check stock availability
      if (quantity > foundItem.stock) {
        alert(`Sorry! Only ${foundItem.stock} ${foundItem.unit} available in stock.`);
        return;
      }
      
      const existing = cart.find(i => i.name === itemName);
      if (existing) {
        const newTotalQty = existing.quantity + quantity;
        if (newTotalQty > foundItem.stock) {
          alert(`Sorry! Only ${foundItem.stock} ${foundItem.unit} available in stock.`);
          return;
        }
        existing.quantity = newTotalQty;
        existing.total = (existing.quantity * price).toFixed(2);
      } else {
        cart.push({
          name: itemName,
          price: price,
          quantity: quantity,
          unit: foundItem.unit,
          total: (quantity * price).toFixed(2)
        });
      }
      
      // Reduce stock
      foundItem.stock -= quantity;
      
      saveCart();
      renderCart();
      showNotification(`${itemName} added to cart! Stock remaining: ${foundItem.stock} ${foundItem.unit}`, 'info');
    };

    window.addToKathaFromUI = function(categoryName, index) {
      const cat = categories.find(c => c.name === categoryName);
      const item = cat.items[index];
      const qtyInput = document.getElementById(`qty-${categoryName}-${index}`);
      addToKatha(item, qtyInput.value);
      qtyInput.value = "";
    };

    function renderCart() {
      const section = document.getElementById("cartSection");
      if (!section) return;
      if (cart.length === 0) {
        section.style.display = "none";
        return;
      }
      section.style.display = "block";
      let subtotal = cart.reduce((sum, item) => sum + parseFloat(item.total), 0);
      let tax = subtotal * 0.05; // 5% GST
      let totalAmount = subtotal + tax;

      section.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <h3>üõí Shopping Cart</h3>
          <div>
            <button onclick="showMainSection()" class="btn-secondary" style="margin-right: 0.5rem;">üõí Back to Shopping</button>
            <button id="generateBillBtn" class="btn-primary" style="margin-right: 0.5rem;">üìã Generate Bill</button>
            <button id="clearCartBtn" class="btn-secondary">üóëÔ∏è Clear Cart</button>
          </div>
        </div>
        
        ${cart.map(item => `
          <div class="bill-item">
            <div style="flex: 1;">
              <strong>${item.name}</strong>
              <div style="font-size: 0.9rem; color: #666;">
                ‚Çπ${item.price}/kg √ó 
                <input type="number" min="0.1" step="0.1" value="${item.quantity}" style="width:60px; margin: 0 0.5rem;" onchange="updateCartQuantityUI('${item.name}', this.value)"> kg
              </div>
            </div>
            <div style="text-align: right;">
              <div style="font-weight: 600;">‚Çπ${item.total}</div>
              <button onclick="removeFromCartUI('${item.name}')" style="color:red; background:none; border:none; cursor:pointer; font-size: 1.2rem;">‚úñ</button>
            </div>
          </div>
        `).join("")}
        
        <div style="background: #f8fafc; padding: 1rem; border-radius: 12px; margin-top: 1rem;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
            <span>Subtotal:</span>
            <span>‚Çπ${subtotal.toFixed(2)}</span>
          </div>
          <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
            <span>GST (5%):</span>
            <span>‚Çπ${tax.toFixed(2)}</span>
          </div>
          <hr style="margin: 0.5rem 0;">
          <div style="display: flex; justify-content: space-between; font-weight: 700; font-size: 1.1rem;">
            <span>Total:</span>
            <span>‚Çπ${totalAmount.toFixed(2)}</span>
          </div>
        </div>
      `;

      // Add event handlers
      document.getElementById("generateBillBtn").onclick = function() {
        generateBill();
      };
      document.getElementById("clearCartBtn").onclick = function() {
        if (confirm("Are you sure you want to clear the cart?")) {
          cart = [];
          saveCart();
          renderCart();
        }
      };
    }

    window.removeFromCartUI = function(itemName) {
      removeFromCart(itemName);
    };
    window.updateCartQuantityUI = function(itemName, newQty) {
      updateCartQuantity(itemName, newQty);
    };

    function generateBill() {
      if (cart.length === 0) {
        alert("Cart is empty! Add items first.");
        return;
      }
      
      if (!currentCustomer) {
        alert("Please select a customer first!");
        return;
      }
      
      // Validate cart items
      for (let item of cart) {
        if (!item.name || !item.price || !item.quantity || !item.total) {
          alert("Invalid cart item detected. Please refresh and try again.");
          return;
        }
      }
      
      // Show bill generation modal
      showBillGenerationModal();
    }
    
    function showBillGenerationModal() {
      const subtotal = cart.reduce((sum, item) => sum + parseFloat(item.total || 0), 0);
      const tax = subtotal * 0.05;
      let discount = 0;
      
      // Apply loyalty discount if available
      const loyaltyDiscount = JSON.parse(localStorage.getItem('loyaltyDiscount') || 'null');
      if (loyaltyDiscount && loyaltyDiscount.customerId === currentCustomer.id) {
        discount = loyaltyDiscount.amount;
      }
      
      const totalAmount = subtotal + tax - discount;
      const total = subtotal + tax;
      
      if (!currentCustomer || !currentCustomer.name) {
        alert("Customer information is missing. Please select a customer again.");
        return;
      }
      
      const modalHTML = `
        <div id="billModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
          <div style="background: white; padding: 2rem; border-radius: 16px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
              <h2>üìã Generate Bill</h2>
              <button onclick="closeBillModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">‚úñ</button>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
              <h4>Customer Details:</h4>
              <p><strong>Name:</strong> ${currentCustomer.name || 'N/A'}</p>
              <p><strong>ID:</strong> ${currentCustomer.id || 'N/A'}</p>
              <p><strong>Phone:</strong> ${currentCustomer.phone || 'N/A'}</p>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
              <h4>Payment Method:</h4>
              <select id="paymentMethod" style="width: 100%; margin-bottom: 1rem;">
                <option value="cash">üíµ Cash</option>
                <option value="card">üí≥ Card</option>
                <option value="upi">üì± UPI</option>
                <option value="katha">üìã Katha (Credit)</option>
              </select>
              
              <div id="paymentDetails" style="display: none;">
                <input type="text" id="paymentRef" placeholder="Payment Reference (Optional)" style="margin-bottom: 1rem;">
              </div>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
              <h4>Discount (Optional):</h4>
              <div style="display: flex; gap: 1rem; align-items: center;">
                <input type="number" id="discountAmount" placeholder="0" min="0" max="${total}" step="0.01" style="flex: 1;">
                <select id="discountType" style="width: 120px;">
                  <option value="fixed">‚Çπ Fixed</option>
                  <option value="percentage">% Percentage</option>
                </select>
              </div>
            </div>
            
            <div style="background: #f8fafc; padding: 1rem; border-radius: 12px; margin-bottom: 1.5rem;">
              <h4>Bill Summary:</h4>
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span>Subtotal:</span>
                <span>‚Çπ${subtotal.toFixed(2)}</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span>GST (5%):</span>
                <span>‚Çπ${tax.toFixed(2)}</span>
              </div>
              ${discount > 0 ? `
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                  <span>Loyalty Discount:</span>
                  <span style="color: #059669; font-weight: 600;">-‚Çπ${discount.toFixed(2)}</span>
                </div>
              ` : ''}
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span>Additional Discount:</span>
                <span id="discountDisplay">‚Çπ0.00</span>
              </div>
              <hr style="margin: 0.5rem 0;">
              <div style="display: flex; justify-content: space-between; font-weight: 700; font-size: 1.1rem;">
                <span>Final Total:</span>
                <span id="finalTotal">‚Çπ${total.toFixed(2)}</span>
              </div>
            </div>
            
            <div style="display: flex; gap: 1rem;">
              <button onclick="finalizeBill()" class="btn-primary" style="flex: 1;">‚úÖ Finalize Bill</button>
              <button onclick="closeBillModal()" class="btn-secondary" style="flex: 1;">‚ùå Cancel</button>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modalHTML);
      
      // Add event listeners for dynamic calculations
      const paymentMethod = document.getElementById('paymentMethod');
      const discountAmount = document.getElementById('discountAmount');
      const discountType = document.getElementById('discountType');
      
      if (paymentMethod) paymentMethod.addEventListener('change', updatePaymentDetails);
      if (discountAmount) discountAmount.addEventListener('input', updateDiscount);
      if (discountType) discountType.addEventListener('change', updateDiscount);
    }
    
    function closeBillModal() {
      const modal = document.getElementById('billModal');
      if (modal) modal.remove();
    }
    
    function updatePaymentDetails() {
      const method = document.getElementById('paymentMethod').value;
      const detailsDiv = document.getElementById('paymentDetails');
      
      if (method === 'katha') {
        detailsDiv.style.display = 'block';
        document.getElementById('paymentRef').placeholder = 'Due Date (Optional)';
      } else if (method === 'card' || method === 'upi') {
        detailsDiv.style.display = 'block';
        document.getElementById('paymentRef').placeholder = 'Transaction ID (Optional)';
      } else {
        detailsDiv.style.display = 'none';
      }
    }
    
    function updateDiscount() {
      const amount = parseFloat(document.getElementById('discountAmount').value) || 0;
      const type = document.getElementById('discountType').value;
      const subtotal = cart.reduce((sum, item) => sum + parseFloat(item.total), 0);
      const tax = subtotal * 0.05;
      
      let discount = 0;
      if (type === 'percentage') {
        discount = (subtotal + tax) * (amount / 100);
      } else {
        discount = amount;
      }
      
      const finalTotal = subtotal + tax - discount;
      
      document.getElementById('discountDisplay').textContent = `‚Çπ${discount.toFixed(2)}`;
      document.getElementById('finalTotal').textContent = `‚Çπ${Math.max(0, finalTotal).toFixed(2)}`;
    }
    
    function finalizeBill() {
      const paymentMethod = document.getElementById('paymentMethod').value;
      const paymentRef = document.getElementById('paymentRef').value;
      const discountAmount = parseFloat(document.getElementById('discountAmount').value) || 0;
      const discountType = document.getElementById('discountType').value;
      
      const subtotal = cart.reduce((sum, item) => sum + parseFloat(item.total), 0);
      const tax = subtotal * 0.05;
      
      let discount = 0;
      if (discountType === 'percentage') {
        discount = (subtotal + tax) * (discountAmount / 100);
      } else {
        discount = discountAmount;
      }
      
      const finalTotal = Math.max(0, subtotal + tax - discount);
      
      // Create bill object
      const bill = {
        id: Date.now(),
        customerId: currentCustomer.id,
        customerName: currentCustomer.name,
        customerPhone: currentCustomer.phone,
        items: [...cart],
        subtotal: subtotal,
        tax: tax,
        discount: discount,
        total: finalTotal,
        paymentMethod: paymentMethod,
        paymentRef: paymentRef,
        date: new Date().toISOString(),
        status: paymentMethod === 'katha' ? 'pending' : 'paid'
      };
      
      // Save bill to localStorage
      const bills = JSON.parse(localStorage.getItem('bills') || '[]');
      bills.push(bill);
      localStorage.setItem('bills', JSON.stringify(bills));
      
      // Handle payment method specific logic
      if (paymentMethod === 'katha') {
        // Add to katha records
        const kathaRecord = {
          id: Date.now(),
          customerId: currentCustomer.id,
          customerName: currentCustomer.name,
          billId: bill.id,
          totalAmount: finalTotal,
          date: new Date().toISOString(),
          dueDate: paymentRef || new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
          status: 'pending'
        };
        
        const kathaRecords = JSON.parse(localStorage.getItem('kathaRecords') || '[]');
        kathaRecords.push(kathaRecord);
        localStorage.setItem('kathaRecords', JSON.stringify(kathaRecords));
        
        // Update customer debt
        currentCustomer.currentDebt += finalTotal;
      }
      
      // Calculate and add loyalty points (1 point per ‚Çπ10 spent)
      const pointsEarned = Math.floor(finalTotal / 10);
      currentCustomer.loyaltyPoints += pointsEarned;
      currentCustomer.totalSpent += finalTotal;
      
      // Update customer data
      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      const updatedCustomers = customers.map(c => c.id === currentCustomer.id ? currentCustomer : c);
      localStorage.setItem('customers', JSON.stringify(updatedCustomers));
      
      // Clear cart
      cart = [];
      saveCart();
      
      // Update spin status after bill generation
      setTimeout(() => {
        showMonthlySpinStatus();
      }, 1000);
      
      // Close modal and show bill
      closeBillModal();
      showFinalBill(bill);
    }
    
    function showFinalBill(bill) {
      const billHTML = `
        <div id="finalBillModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
          <div style="background: white; padding: 2rem; border-radius: 16px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
            <div style="text-align: center; margin-bottom: 2rem;">
              <h2 style="color: #0f172a; margin-bottom: 0.5rem;">üõçÔ∏è Smart General Store</h2>
              <p style="color: #666; margin-bottom: 0.5rem;">Bill #${bill.id}</p>
              <p style="color: #666;">${new Date(bill.date).toLocaleString()}</p>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
              <h4>Customer Details:</h4>
              <p><strong>Name:</strong> ${bill.customerName}</p>
              <p><strong>ID:</strong> ${bill.customerId}</p>
              <p><strong>Phone:</strong> ${bill.customerPhone}</p>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
              <h4>Items:</h4>
              ${bill.items.map(item => `
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                  <span>${item.name} (${item.quantity} kg)</span>
                  <span>‚Çπ${item.total}</span>
                </div>
              `).join('')}
            </div>
            
            <div style="background: #f8fafc; padding: 1rem; border-radius: 12px; margin-bottom: 1.5rem;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span>Subtotal:</span>
                <span>‚Çπ${bill.subtotal.toFixed(2)}</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span>GST (5%):</span>
                <span>‚Çπ${bill.tax.toFixed(2)}</span>
              </div>
              ${bill.discount > 0 ? `
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                  <span>Discount:</span>
                  <span>-‚Çπ${bill.discount.toFixed(2)}</span>
                </div>
              ` : ''}
              <hr style="margin: 0.5rem 0;">
              <div style="display: flex; justify-content: space-between; font-weight: 700; font-size: 1.2rem;">
                <span>Total:</span>
                <span>‚Çπ${bill.total.toFixed(2)}</span>
              </div>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
              <p><strong>Payment Method:</strong> ${getPaymentMethodName(bill.paymentMethod)}</p>
              ${bill.paymentRef ? `<p><strong>Reference:</strong> ${bill.paymentRef}</p>` : ''}
              <p><strong>Status:</strong> <span style="color: ${bill.status === 'paid' ? 'green' : 'orange'};">${bill.status.toUpperCase()}</span></p>
            </div>
            
            <div style="display: flex; gap: 1rem;">
              <button onclick="printBill(${bill.id})" class="btn-primary" style="flex: 1;">üñ®Ô∏è Print Bill</button>
              <button onclick="closeFinalBill()" class="btn-secondary" style="flex: 1;">‚úÖ Done</button>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', billHTML);
    }
    
    function closeFinalBill() {
      const modal = document.getElementById('finalBillModal');
      if (modal) modal.remove();
      renderCart();
    }
    
    function getPaymentMethodName(method) {
      const methods = {
        'cash': 'üíµ Cash',
        'card': 'üí≥ Card',
        'upi': 'üì± UPI',
        'katha': 'üìã Katha (Credit)'
      };
      return methods[method] || method;
    }
    
    function printBill(billId) {
      const bills = JSON.parse(localStorage.getItem('bills') || '[]');
      const bill = bills.find(b => b.id === billId);
      if (!bill) return;
      
      const printWindow = window.open('', '_blank');
      printWindow.document.write(`
        <html>
          <head>
            <title>Bill #${bill.id}</title>
            <style>
              body { font-family: Arial, sans-serif; margin: 20px; }
              .header { text-align: center; margin-bottom: 20px; }
              .bill-details { margin-bottom: 20px; }
              .items { margin-bottom: 20px; }
              .total { font-weight: bold; font-size: 1.2em; }
              table { width: 100%; border-collapse: collapse; }
              th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
            </style>
          </head>
          <body>
            <div class="header">
              <h1>üõçÔ∏è Smart General Store</h1>
              <p>Bill #${bill.id}</p>
              <p>${new Date(bill.date).toLocaleString()}</p>
            </div>
            
            <div class="bill-details">
              <h3>Customer Details:</h3>
              <p><strong>Name:</strong> ${bill.customerName}</p>
              <p><strong>ID:</strong> ${bill.customerId}</p>
              <p><strong>Phone:</strong> ${bill.customerPhone}</p>
            </div>
            
            <div class="items">
              <h3>Items:</h3>
              <table>
                <tr>
                  <th>Item</th>
                  <th>Quantity</th>
                  <th>Price</th>
                  <th>Total</th>
                </tr>
                ${bill.items.map(item => `
                  <tr>
                    <td>${item.name}</td>
                    <td>${item.quantity} kg</td>
                    <td>‚Çπ${item.price}</td>
                    <td>‚Çπ${item.total}</td>
                  </tr>
                `).join('')}
              </table>
            </div>
            
            <div class="total">
              <p>Subtotal: ‚Çπ${bill.subtotal.toFixed(2)}</p>
              <p>GST (5%): ‚Çπ${bill.tax.toFixed(2)}</p>
              ${bill.discount > 0 ? `<p>Discount: -‚Çπ${bill.discount.toFixed(2)}</p>` : ''}
              <p>Total: ‚Çπ${bill.total.toFixed(2)}</p>
              <p>Payment Method: ${getPaymentMethodName(bill.paymentMethod)}</p>
              <p>Status: ${bill.status.toUpperCase()}</p>
            </div>
            
            <div style="text-align: center; margin-top: 40px;">
              <p>Thank you for shopping!</p>
              <p>Please visit again</p>
            </div>
          </body>
        </html>
      `);
      printWindow.document.close();
      printWindow.print();
    }

    function showKathaSection() {
      document.getElementById('categoryGrid').style.display = 'none';
      document.getElementById('itemsSection').style.display = 'none';
      document.getElementById('cartSection').style.display = 'none';
      document.getElementById('kathaSection').style.display = 'block';

      const overdueRecords = kathaRecords.filter(record =>
        new Date(record.dueDate) < new Date() && record.status === 'pending'
      );

      let kathaHTML = `
        <div>
          <h2>üìã Katha Management</h2>
          <button onclick="selectCustomer()" class="btn-primary">Select Customer</button>
          <button onclick="addCustomer()" class="btn-secondary">Add New Customer</button>
        </div>
      `;

      if (currentCustomer) {
        kathaHTML += `
          <div>
            <h3>Current Customer: ${currentCustomer.name}</h3>
            <p>Current Debt: ‚Çπ${currentCustomer.currentDebt} / ‚Çπ${currentCustomer.creditLimit}</p>
            <p>Phone: ${currentCustomer.phone}</p>
          </div>
        `;
      }

      if (overdueRecords.length > 0) {
        kathaHTML += `
          <div>
            <h3>‚ö†Ô∏è Overdue Payments (${overdueRecords.length})</h3>
            ${overdueRecords.map(record => `
              <div>
                <strong>${record.customerName}</strong> - ${record.itemName} (‚Çπ${record.totalAmount})
                <br>Due: ${new Date(record.dueDate).toLocaleDateString()}
                <button onclick="markAsPaid(${record.id})">Mark Paid</button>
              </div>
            `).join('')}
          </div>
        `;
      }

      kathaHTML += `
        <div>
          <h3>Recent Katha Records</h3>
          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>Customer</th>
                <th>Item</th>
                <th>Amount</th>
                <th>Due Date</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              ${kathaRecords.slice(-10).reverse().map(record => `
                <tr>
                  <td>${new Date(record.date).toLocaleDateString()}</td>
                  <td>${record.customerName}</td>
                  <td>${record.itemName}</td>
                  <td>‚Çπ${record.totalAmount}</td>
                  <td>${new Date(record.dueDate).toLocaleDateString()}</td>
                  <td>${record.status}</td>
                  <td>
                    ${record.status === 'pending' ? 
                      `<button onclick="markAsPaid(${record.id})">Pay</button>` : 
                      'Paid'
                    }
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
        <button onclick="showMainSection()">Back to Shopping</button>
      `;

      document.getElementById('kathaSection').innerHTML = kathaHTML;
    }

    function addStock(itemName, quantity) {
      let found = false;
      categories.forEach(category => {
        category.items.forEach(item => {
          if (item.name === itemName) {
            item.stock += parseFloat(quantity);
            found = true;
          }
        });
      });
      if (found) {
        alert(`Stock updated for ${itemName}. New stock: ${item.stock} kg`);
        renderItems(currentCategory); // Re-render if a category is currently displayed
      } else {
        alert("Item not found!");
      }
    }

    function showStockManagement() {
      let stockHTML = `
        <div class="bill-section">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h2>üì¶ Stock Management</h2>
            <button onclick="showMainSection()" class="btn-secondary">üõí Back to Shopping</button>
          </div>
          <div style="margin-bottom: 20px;">
            <input type="text" id="stockItemName" placeholder="Item Name" style="width: 200px;">
            <input type="number" id="stockQuantity" placeholder="Quantity to Add" style="width: 150px;">
            <button onclick="addStockFromUI()">Add Stock</button>
          </div>
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background: #f0f0f0;">
                <th style="padding: 10px; border: 1px solid #ddd;">Category</th>
                <th style="padding: 10px; border: 1px solid #ddd;">Item</th>
                <th style="padding: 10px; border: 1px solid #ddd;">Stock (kg)</th>
                <th style="padding: 10px; border: 1px solid #ddd;">Status</th>
              </tr>
            </thead>
            <tbody>
              ${categories.map(category => 
                category.items.map(item => {
                  const isOutOfStock = item.stock <= 0;
                  const isLowStock = item.stock <= 10 && item.stock > 0;
                  return `
                    <tr>
                      <td style="padding: 8px; border: 1px solid #ddd;">${category.name}</td>
                      <td style="padding: 8px; border: 1px solid #ddd;">${item.name}</td>
                      <td style="padding: 8px; border: 1px solid #ddd; ${isOutOfStock ? 'color: red;' : isLowStock ? 'color: orange;' : ''}">${item.stock}</td>
                      <td style="padding: 8px; border: 1px solid #ddd;">
                        ${isOutOfStock ? '‚ùå Out of Stock' : isLowStock ? '‚ö†Ô∏è Low Stock' : '‚úÖ In Stock'}
                      </td>
                    </tr>
                  `;
                }).join('')
              ).join('')}
            </tbody>
          </table>
        </div>
      `;
      
      document.getElementById("itemsSection").innerHTML = stockHTML;
    }

    window.addStockFromUI = function() {
      const itemName = document.getElementById("stockItemName").value.trim();
      const quantity = parseFloat(document.getElementById("stockQuantity").value);
      if (!itemName || isNaN(quantity) || quantity <= 0) {
        alert("Please enter valid item name and quantity!");
        return;
      }
      addStock(itemName, quantity);
      document.getElementById("stockItemName").value = "";
      document.getElementById("stockQuantity").value = "";
    };

    // Show cart when clicking "View Cart"
    document.addEventListener("DOMContentLoaded", function() {
      document.getElementById("viewCart").onclick = function(e) {
        e.preventDefault();
        renderCart();
        document.getElementById("cartSection").scrollIntoView({ behavior: "smooth" });
      };
      document.getElementById("viewKatha").onclick = function(e) {
        e.preventDefault();
        showKathaSection();
      };
      document.getElementById("addCustomer").onclick = function(e) {
        e.preventDefault();
        addCustomer();
      };
      document.getElementById("stockManagement").onclick = function(e) {
        e.preventDefault();
        showStockManagement();
      };
      document.getElementById("billHistory").onclick = function(e) {
        e.preventDefault();
        showBillHistory();
      };
      document.getElementById("contactLink").onclick = function(e) {
        e.preventDefault();
        showContact();
      };
      document.getElementById("backToHome").onclick = function(e) {
        e.preventDefault();
        goToHome();
      };
      document.getElementById("monthlySpin").onclick = function(e) {
        e.preventDefault();
        showSpinWheel();
      };
      loadCart();
      showKathaSection(); // Initial display of Katha section
      
      // Initialize the enhanced reminder system
      initializeReminderSystem();
      
      // Check for overdue payments every 5 minutes (for demo purposes)
      setInterval(checkOverduePayments, 5 * 60 * 1000);
      
      // Initial check for overdue payments
      checkOverduePayments();
    });
    
    // Notification System
    function checkOverduePayments() {
      const kathaRecords = JSON.parse(localStorage.getItem('kathaRecords') || '[]');
      const overdueRecords = kathaRecords.filter(record => 
        new Date(record.dueDate) < new Date() && record.status === 'pending'
      );
      
      if (overdueRecords.length > 0) {
        showNotification(`‚ö†Ô∏è You have ${overdueRecords.length} overdue payment(s)! Check Katha section for details.`, 'warning');
      }
    }
    
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'warning' ? '#f59e0b' : type === 'error' ? '#dc2626' : '#059669'};
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        z-index: 10000;
        max-width: 400px;
        animation: slideIn 0.3s ease;
      `;
      
      notification.innerHTML = `
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <span style="font-size: 1.2rem;">
            ${type === 'warning' ? '‚ö†Ô∏è' : type === 'error' ? '‚ùå' : '‚úÖ'}
          </span>
          <span>${message}</span>
          <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: white; cursor: pointer; margin-left: auto;">‚úñ</button>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      // Auto remove after 5 seconds
      setTimeout(() => {
        if (notification.parentElement) {
          notification.remove();
        }
      }, 5000);
    }
    
    // Add CSS animation for notifications
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
    `;
    document.head.appendChild(style);
    
    // Monthly Spin Reward System
    function checkMonthlySpinEligibility() {
      const currentMonth = new Date().getFullYear() + '-' + (new Date().getMonth() + 1);
      const monthlySpins = JSON.parse(localStorage.getItem('monthlySpins') || '{}');
      
      if (!currentCustomer) return false;
      
      // Check if customer already got spin this month
      if (monthlySpins[currentCustomer.id] && monthlySpins[currentCustomer.id].month === currentMonth) {
        return false;
      }
      
      // Calculate total purchases this month
      const bills = JSON.parse(localStorage.getItem('bills') || '[]');
      const monthlyBills = bills.filter(bill => {
        const billDate = new Date(bill.date);
        const billMonth = billDate.getFullYear() + '-' + (billDate.getMonth() + 1);
        return bill.customerId === currentCustomer.id && billMonth === currentMonth;
      });
      
      const monthlyTotal = monthlyBills.reduce((sum, bill) => sum + bill.total, 0);
      
      return monthlyTotal >= 10000; // ‚Çπ10,000 threshold
    }
    
    function showSpinWheel() {
      if (!checkMonthlySpinEligibility()) {
        alert('You need to spend ‚Çπ10,000+ this month to get a free spin!');
        return;
      }
      
      // Get all available items for the spin
      let allItems = [];
      categories.forEach(category => {
        category.items.forEach(item => {
          if (item.stock > 0) { // Only items in stock
            allItems.push({
              name: item.name,
              price: item.price,
              image: item.image,
              category: category.name,
              unit: item.unit
            });
          }
        });
      });
      
      if (allItems.length === 0) {
        alert('No items available for spin!');
        return;
      }
      
      // Create spin wheel modal
      const spinModal = document.createElement('div');
      spinModal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      `;
      
      // Select 8 random items for the wheel
      const spinItems = [];
      for (let i = 0; i < 8; i++) {
        const randomIndex = Math.floor(Math.random() * allItems.length);
        spinItems.push(allItems[randomIndex]);
        allItems.splice(randomIndex, 1);
        if (allItems.length === 0) break;
      }
      
      // Fill remaining slots if needed
      while (spinItems.length < 8) {
        spinItems.push(spinItems[0]); // Duplicate items if needed
      }
      
      spinModal.innerHTML = `
        <div style="
          background: white;
          border-radius: 20px;
          padding: 2rem;
          text-align: center;
          max-width: 500px;
          width: 90%;
          box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        ">
          <h2 style="color: #059669; margin-bottom: 1rem;">üé∞ Monthly Spin & Win!</h2>
          <p style="margin-bottom: 2rem; color: #666;">
            Congratulations! You've spent ‚Çπ10,000+ this month.<br>
            Spin the wheel to win a FREE item!
          </p>
          
          <div id="spinWheel" style="
            width: 300px;
            height: 300px;
            border-radius: 50%;
            border: 8px solid #059669;
            position: relative;
            margin: 0 auto 2rem;
            background: conic-gradient(
              from 0deg,
              #ff6b6b 0deg 45deg,
              #4ecdc4 45deg 90deg,
              #45b7d1 90deg 135deg,
              #96ceb4 135deg 180deg,
              #feca57 180deg 225deg,
              #ff9ff3 225deg 270deg,
              #54a0ff 270deg 315deg,
              #5f27cd 315deg 360deg
            );
            transition: transform 3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
          ">
            ${spinItems.map((item, index) => `
              <div style="
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) rotate(${index * 45}deg);
                width: 120px;
                text-align: center;
                font-size: 0.8rem;
                color: white;
                font-weight: bold;
                text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
              ">
                <div style="font-size: 1.5rem; margin-bottom: 0.25rem;">${item.image}</div>
                <div>${item.name}</div>
                <div style="font-size: 0.7rem;">‚Çπ${item.price}</div>
              </div>
            `).join('')}
            <div style="
              position: absolute;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              width: 20px;
              height: 20px;
              background: #059669;
              border-radius: 50%;
              border: 3px solid white;
              z-index: 10;
            "></div>
          </div>
          
          <button id="spinButton" onclick="spinTheWheel()" style="
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            margin-right: 1rem;
          ">üé∞ SPIN THE WHEEL!</button>
          
          <button onclick="closeSpinModal()" style="
            background: #6b7280;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-size: 1.1rem;
            cursor: pointer;
          ">Close</button>
        </div>
      `;
      
      document.body.appendChild(spinModal);
      
      // Store spin items for result calculation
      window.spinItems = spinItems;
    }
    
    function spinTheWheel() {
      const wheel = document.getElementById('spinWheel');
      const spinButton = document.getElementById('spinButton');
      
      if (!wheel || !spinButton) return;
      
      // Disable spin button
      spinButton.disabled = true;
      spinButton.textContent = 'üé∞ Spinning...';
      
      // Random spin result (0-7, corresponding to 8 items)
      const resultIndex = Math.floor(Math.random() * 8);
      const winningItem = window.spinItems[resultIndex];
      
      // Calculate rotation (each item takes 45 degrees, so result * 45 + some offset)
      const baseRotation = resultIndex * 45;
      const extraSpins = 5; // Number of full rotations
      const finalRotation = extraSpins * 360 + baseRotation + 22.5; // 22.5 is half of 45 for center alignment
      
      // Animate the spin
      wheel.style.transform = `rotate(${finalRotation}deg)`;
      
      // Show result after animation
      setTimeout(() => {
        showSpinResult(winningItem);
      }, 3000);
    }
    
    function showSpinResult(winningItem) {
      const spinModal = document.querySelector('div[style*="position: fixed"]');
      if (!spinModal) return;
      
      spinModal.innerHTML = `
        <div style="
          background: white;
          border-radius: 20px;
          padding: 2rem;
          text-align: center;
          max-width: 500px;
          width: 90%;
          box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        ">
          <div style="
            font-size: 4rem;
            margin-bottom: 1rem;
            animation: bounce 1s infinite;
          ">üéâ</div>
          
          <h2 style="color: #059669; margin-bottom: 1rem;">Congratulations!</h2>
          <p style="margin-bottom: 2rem; color: #666;">
            You won a FREE item!
          </p>
          
          <div style="
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
          ">
            <div style="font-size: 3rem; margin-bottom: 0.5rem;">${winningItem.image}</div>
            <h3 style="margin: 0 0 0.5rem; color: #92400e;">${winningItem.name}</h3>
            <p style="margin: 0; color: #92400e; font-weight: 600;">‚Çπ${winningItem.price} - FREE!</p>
            <p style="margin: 0.5rem 0 0; color: #92400e; font-size: 0.9rem;">${winningItem.category}</p>
          </div>
          
          <div style="display: flex; gap: 1rem; justify-content: center;">
            <button onclick="addSpinRewardToCart('${winningItem.name}', ${winningItem.price})" style="
              background: linear-gradient(135deg, #059669 0%, #10b981 100%);
              color: white;
              border: none;
              padding: 1rem 2rem;
              border-radius: 12px;
              font-size: 1.1rem;
              font-weight: 600;
              cursor: pointer;
            ">üõí Add to Cart</button>
            
            <button onclick="closeSpinModal()" style="
              background: #6b7280;
              color: white;
              border: none;
              padding: 1rem 2rem;
              border-radius: 12px;
              font-size: 1.1rem;
              cursor: pointer;
            ">Close</button>
          </div>
        </div>
      `;
      
      // Mark this month's spin as used
      const currentMonth = new Date().getFullYear() + '-' + (new Date().getMonth() + 1);
      const monthlySpins = JSON.parse(localStorage.getItem('monthlySpins') || '{}');
      monthlySpins[currentCustomer.id] = {
        month: currentMonth,
        date: new Date().toISOString(),
        item: winningItem.name,
        value: winningItem.price
      };
      localStorage.setItem('monthlySpins', JSON.stringify(monthlySpins));
    }
    
    function addSpinRewardToCart(itemName, price) {
      // Add the free item to cart
      const existing = cart.find(i => i.name === itemName);
      if (existing) {
        existing.quantity += 1;
        existing.total = (existing.quantity * price).toFixed(2);
      } else {
        cart.push({ 
          name: itemName, 
          price: price, 
          quantity: 1, 
          total: price.toFixed(2),
          isFreeReward: true // Mark as free reward
        });
      }
      
      saveCart();
      renderCart();
      closeSpinModal();
      
      showNotification(`üéâ ${itemName} added to cart as FREE reward!`, 'success');
    }
    
    function closeSpinModal() {
      const spinModal = document.querySelector('div[style*="position: fixed"]');
      if (spinModal) {
        spinModal.remove();
      }
    }
    
    function showLoyaltyPointsModal() {
      if (!currentCustomer) {
        alert('Please select a customer first!');
        return;
      }
      
      const loyaltyInfo = getLoyaltyLevel(currentCustomer.loyaltyPoints || 0);
      const pointsToRedeem = Math.floor((currentCustomer.loyaltyPoints || 0) / 10) * 10; // Redeem in multiples of 10
      const discountAmount = pointsToRedeem * 0.1; // 1 point = ‚Çπ0.10 discount
      
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      `;
      
      modal.innerHTML = `
        <div style="
          background: white;
          border-radius: 20px;
          padding: 2rem;
          text-align: center;
          max-width: 500px;
          width: 90%;
          box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        ">
          <div style="
            background: ${loyaltyInfo.color};
            border: 2px solid ${loyaltyInfo.level === 'Bronze' ? '#ef4444' : loyaltyInfo.level === 'Silver' ? '#6b7280' : loyaltyInfo.level === 'Gold' ? '#f59e0b' : loyaltyInfo.level === 'Platinum' ? '#374151' : '#0ea5e9'};
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
          ">
            <div style="font-size: 3rem; margin-bottom: 0.5rem;">${loyaltyInfo.icon}</div>
            <h2 style="margin: 0 0 0.5rem; color: #374151;">${loyaltyInfo.level} Member</h2>
            <p style="margin: 0; color: #6b7280; font-size: 1.2rem; font-weight: 600;">${currentCustomer.loyaltyPoints || 0} Points</p>
          </div>
          
          <div style="margin-bottom: 2rem;">
            <h3 style="color: #059669; margin-bottom: 1rem;">üíé Loyalty Benefits</h3>
            <div style="text-align: left; margin-bottom: 1rem;">
              <p><strong>ü•â Bronze (0-49 pts):</strong> Basic member benefits</p>
              <p><strong>ü•à Silver (50-199 pts):</strong> 5% extra discount on special items</p>
              <p><strong>ü•á Gold (200-499 pts):</strong> 10% extra discount + priority support</p>
              <p><strong>ü•á Platinum (500-999 pts):</strong> 15% extra discount + free delivery</p>
              <p><strong>üíé Diamond (1000+ pts):</strong> 20% extra discount + VIP treatment</p>
            </div>
          </div>
          
          ${pointsToRedeem > 0 ? `
            <div style="
              background: #fef3c7;
              border: 1px solid #f59e0b;
              border-radius: 12px;
              padding: 1rem;
              margin-bottom: 2rem;
            ">
              <h4 style="color: #92400e; margin-bottom: 0.5rem;">üéÅ Redeem Points</h4>
              <p style="margin: 0; color: #92400e;">
                Redeem ${pointsToRedeem} points for ‚Çπ${discountAmount.toFixed(2)} discount
              </p>
              <button onclick="redeemLoyaltyPoints(${pointsToRedeem})" style="
                background: #f59e0b;
                color: white;
                border: none;
                padding: 0.5rem 1rem;
                border-radius: 8px;
                margin-top: 0.5rem;
                cursor: pointer;
              ">Redeem Points</button>
            </div>
          ` : `
            <div style="
              background: #f3f4f6;
              border: 1px solid #d1d5db;
              border-radius: 12px;
              padding: 1rem;
              margin-bottom: 2rem;
            ">
              <p style="margin: 0; color: #6b7280;">
                Need at least 10 points to redeem. Keep shopping to earn more!
              </p>
            </div>
          `}
          
          <button onclick="closeLoyaltyModal()" style="
            background: #6b7280;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-size: 1.1rem;
            cursor: pointer;
          ">Close</button>
        </div>
      `;
      
      document.body.appendChild(modal);
    }
    
    function getLoyaltyLevel(points) {
      if (points >= 1000) return { level: 'Diamond', color: '#b8f2e6', icon: 'üíé' };
      if (points >= 500) return { level: 'Platinum', color: '#e5e7eb', icon: 'ü•á' };
      if (points >= 200) return { level: 'Gold', color: '#fef3c7', icon: 'ü•á' };
      if (points >= 50) return { level: 'Silver', color: '#f3f4f6', icon: 'ü•à' };
      return { level: 'Bronze', color: '#fef2f2', icon: 'ü•â' };
    }
    
    function redeemLoyaltyPoints(pointsToRedeem) {
      if (!currentCustomer) return;
      
      const discountAmount = pointsToRedeem * 0.1;
      currentCustomer.loyaltyPoints -= pointsToRedeem;
      
      // Update customer data
      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      const updatedCustomers = customers.map(c => c.id === currentCustomer.id ? currentCustomer : c);
      localStorage.setItem('customers', JSON.stringify(updatedCustomers));
      
      // Store redemption for use in billing
      localStorage.setItem('loyaltyDiscount', JSON.stringify({
        customerId: currentCustomer.id,
        amount: discountAmount,
        pointsUsed: pointsToRedeem,
        date: new Date().toISOString()
      }));
      
      closeLoyaltyModal();
      showNotification(`üéâ ${pointsToRedeem} points redeemed for ‚Çπ${discountAmount.toFixed(2)} discount!`, 'success');
    }
    
    function closeLoyaltyModal() {
      const modal = document.querySelector('div[style*="position: fixed"]');
      if (modal) {
        modal.remove();
      }
    }
    
    function showMonthlySpinStatus() {
      if (!currentCustomer) return;
      
      const currentMonth = new Date().getFullYear() + '-' + (new Date().getMonth() + 1);
      const monthlySpins = JSON.parse(localStorage.getItem('monthlySpins') || '{}');
      const hasSpunThisMonth = monthlySpins[currentCustomer.id] && monthlySpins[currentCustomer.id].month === currentMonth;
      
      // Calculate monthly spending
      const bills = JSON.parse(localStorage.getItem('bills') || '[]');
      const monthlyBills = bills.filter(bill => {
        const billDate = new Date(bill.date);
        const billMonth = billDate.getFullYear() + '-' + (billDate.getMonth() + 1);
        return bill.customerId === currentCustomer.id && billMonth === currentMonth;
      });
      
      const monthlyTotal = monthlyBills.reduce((sum, bill) => sum + bill.total, 0);
      const remainingForSpin = Math.max(0, 10000 - monthlyTotal);
      
      // Calculate loyalty level
      const getLoyaltyLevel = (points) => {
        if (points >= 1000) return { level: 'Diamond', color: '#b8f2e6', icon: 'üíé' };
        if (points >= 500) return { level: 'Platinum', color: '#e5e7eb', icon: 'ü•á' };
        if (points >= 200) return { level: 'Gold', color: '#fef3c7', icon: 'ü•á' };
        if (points >= 50) return { level: 'Silver', color: '#f3f4f6', icon: 'ü•à' };
        return { level: 'Bronze', color: '#fef2f2', icon: 'ü•â' };
      };
      
      const loyaltyInfo = getLoyaltyLevel(currentCustomer.loyaltyPoints || 0);
      
      // Show customer info in customer info bar
      const customerInfoBar = document.querySelector('#storeSection > div:first-child');
      if (customerInfoBar) {
        const customerInfoHTML = `
          <div style="display: flex; gap: 1rem; align-items: center; margin-left: 1rem;">
            <!-- Loyalty Points -->
            <div style="
              background: ${loyaltyInfo.color};
              border: 1px solid ${loyaltyInfo.level === 'Bronze' ? '#ef4444' : loyaltyInfo.level === 'Silver' ? '#6b7280' : loyaltyInfo.level === 'Gold' ? '#f59e0b' : loyaltyInfo.level === 'Platinum' ? '#374151' : '#0ea5e9'};
              border-radius: 8px;
              padding: 0.5rem;
              font-size: 0.9rem;
              text-align: center;
              min-width: 120px;
            ">
              <div style="font-size: 1.2rem; margin-bottom: 0.25rem;">${loyaltyInfo.icon}</div>
              <div style="font-weight: 600; color: #374151;">${loyaltyInfo.level}</div>
              <div style="font-size: 0.8rem; color: #6b7280;">${currentCustomer.loyaltyPoints || 0} pts</div>
            </div>
            
            <!-- Spin Status -->
            <div style="
              background: ${hasSpunThisMonth ? '#fef3c7' : remainingForSpin === 0 ? '#dcfce7' : '#fef2f2'};
              border: 1px solid ${hasSpunThisMonth ? '#f59e0b' : remainingForSpin === 0 ? '#10b981' : '#ef4444'};
              border-radius: 8px;
              padding: 0.5rem;
              font-size: 0.9rem;
              text-align: center;
              min-width: 120px;
            ">
              ${hasSpunThisMonth ? 
                `üé∞ Spin Used` :
                remainingForSpin === 0 ?
                `<button onclick="showSpinWheel()" style="background: #10b981; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">üé∞ SPIN NOW!</button>` :
                `üé∞ ‚Çπ${remainingForSpin.toFixed(0)} more`
              }
            </div>
            
                         <!-- Total Spent -->
             <div style="
               background: #f0f9ff;
               border: 1px solid #0ea5e9;
               border-radius: 8px;
               padding: 0.5rem;
               font-size: 0.9rem;
               text-align: center;
               min-width: 120px;
             ">
               <div style="font-weight: 600; color: #0ea5e9;">Total Spent</div>
               <div style="font-size: 0.8rem; color: #6b7280;">‚Çπ${(currentCustomer.totalSpent || 0).toFixed(0)}</div>
             </div>
             
             <!-- Loyalty Points Button -->
             <button onclick="showLoyaltyPointsModal()" style="
               background: linear-gradient(135deg, #059669 0%, #10b981 100%);
               color: white;
               border: none;
               padding: 0.5rem 1rem;
               border-radius: 8px;
               font-size: 0.9rem;
               cursor: pointer;
               min-width: 120px;
             ">üíé Loyalty</button>
          </div>
        `;
        
        // Update customer info bar
        const existingCustomerInfo = customerInfoBar.querySelector('.customer-info');
        if (existingCustomerInfo) {
          existingCustomerInfo.innerHTML = customerInfoHTML;
        } else {
          const customerInfoDiv = document.createElement('div');
          customerInfoDiv.className = 'customer-info';
          customerInfoDiv.innerHTML = customerInfoHTML;
          customerInfoBar.appendChild(customerInfoDiv);
        }
      }
    }

    // Bill History Functions
    function showBillHistory() {
      document.getElementById('categoryGrid').style.display = 'none';
      document.getElementById('itemsSection').style.display = 'none';
      document.getElementById('cartSection').style.display = 'none';
      document.getElementById('kathaSection').style.display = 'none';
      document.getElementById('billHistorySection').style.display = 'block';
      
      const bills = JSON.parse(localStorage.getItem('bills') || '[]');
      
      if (bills.length === 0) {
        document.getElementById('billHistorySection').innerHTML = `
          <h2>üìÑ Bill History</h2>
          <p style="text-align: center; color: #666; margin: 2rem 0;">No bills generated yet.</p>
          <button onclick="showMainSection()" class="btn-primary">Back to Shopping</button>
        `;
        return;
      }
      
      const totalSales = bills.reduce((sum, bill) => sum + bill.total, 0);
      const totalBills = bills.length;
      const pendingBills = bills.filter(bill => bill.status === 'pending').length;
      
      let historyHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
          <h2>üìÑ Bill History</h2>
          <button onclick="showMainSection()" class="btn-secondary">Back to Shopping</button>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
          <div style="background: linear-gradient(135deg, #059669 0%, #047857 100%); color: white; padding: 1.5rem; border-radius: 12px; text-align: center;">
            <h3>${totalBills}</h3>
            <p>Total Bills</p>
          </div>
          <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); color: white; padding: 1.5rem; border-radius: 12px; text-align: center;">
            <h3>‚Çπ${totalSales.toFixed(2)}</h3>
            <p>Total Sales</p>
          </div>
          <div style="background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); color: white; padding: 1.5rem; border-radius: 12px; text-align: center;">
            <h3>${pendingBills}</h3>
            <p>Pending Bills</p>
          </div>
        </div>
        
        <div style="margin-bottom: 1rem;">
          <input type="text" id="searchBills" placeholder="Search by customer name or bill ID..." style="width: 100%; margin-bottom: 1rem;">
          <select id="filterStatus" style="width: 200px; margin-right: 1rem;">
            <option value="">All Status</option>
            <option value="paid">Paid</option>
            <option value="pending">Pending</option>
          </select>
          <button onclick="filterBills()" class="btn-primary">Filter</button>
        </div>
        
        <table class="bill-table">
          <thead>
            <tr>
              <th>Bill ID</th>
              <th>Customer</th>
              <th>Items</th>
              <th>Total</th>
              <th>Payment</th>
              <th>Status</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="billsTableBody">
            ${bills.reverse().map(bill => `
              <tr>
                <td>#${bill.id}</td>
                <td>${bill.customerName}<br><small>${bill.customerPhone}</small></td>
                <td>${bill.items.length} items</td>
                <td>‚Çπ${bill.total.toFixed(2)}</td>
                <td>${getPaymentMethodName(bill.paymentMethod)}</td>
                <td><span style="color: ${bill.status === 'paid' ? 'green' : 'orange'}; font-weight: 600;">${bill.status.toUpperCase()}</span></td>
                <td>${new Date(bill.date).toLocaleDateString()}</td>
                <td>
                  <button onclick="viewBillDetails(${bill.id})" class="btn-primary" style="padding: 0.5rem; margin-right: 0.5rem;">üëÅÔ∏è</button>
                  <button onclick="printBill(${bill.id})" class="btn-secondary" style="padding: 0.5rem;">üñ®Ô∏è</button>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
      
      document.getElementById('billHistorySection').innerHTML = historyHTML;
    }
    
    function filterBills() {
      const searchTerm = document.getElementById('searchBills').value.toLowerCase();
      const statusFilter = document.getElementById('filterStatus').value;
      const bills = JSON.parse(localStorage.getItem('bills') || '[]');
      
      const filteredBills = bills.filter(bill => {
        const matchesSearch = bill.customerName.toLowerCase().includes(searchTerm) || 
                             bill.id.toString().includes(searchTerm);
        const matchesStatus = !statusFilter || bill.status === statusFilter;
        return matchesSearch && matchesStatus;
      });
      
      const tbody = document.getElementById('billsTableBody');
      tbody.innerHTML = filteredBills.reverse().map(bill => `
        <tr>
          <td>#${bill.id}</td>
          <td>${bill.customerName}<br><small>${bill.customerPhone}</small></td>
          <td>${bill.items.length} items</td>
          <td>‚Çπ${bill.total.toFixed(2)}</td>
          <td>${getPaymentMethodName(bill.paymentMethod)}</td>
          <td><span style="color: ${bill.status === 'paid' ? 'green' : 'orange'}; font-weight: 600;">${bill.status.toUpperCase()}</span></td>
          <td>${new Date(bill.date).toLocaleDateString()}</td>
          <td>
            <button onclick="viewBillDetails(${bill.id})" class="btn-primary" style="padding: 0.5rem; margin-right: 0.5rem;">üëÅÔ∏è</button>
            <button onclick="printBill(${bill.id})" class="btn-secondary" style="padding: 0.5rem;">üñ®Ô∏è</button>
          </td>
        </tr>
      `).join('');
    }
    
    function viewBillDetails(billId) {
      const bills = JSON.parse(localStorage.getItem('bills') || '[]');
      const bill = bills.find(b => b.id === billId);
      if (!bill) return;
      
      showFinalBill(bill);
    }
    
    // Homepage Functions
    function showStoreInfo() {
      document.getElementById('storeInfoSection').style.display = 'flex';
    }
    
    function hideStoreInfo() {
      document.getElementById('storeInfoSection').style.display = 'none';
    }
    
    function startShopping() {
      // Hide homepage and show login
      document.getElementById('homepage').style.display = 'none';
      document.getElementById('loginSection').style.display = 'block';
    }
    
    // Store Configuration
    const storeConfig = {
      storeName: "Smart General Store",
      storeLogo: "üõçÔ∏è",
      primaryColor: "#0d6efd",
      secondaryColor: "#38b2ac",
      contactInfo: {
        phone: "+91 98765 43210",
        address: "Main Street, City Center",
        hours: "8:00 AM - 9:00 PM (Daily)",
        email: "info@smartgeneralstore.com"
      },
      services: [
        "Groceries",
        "Vegetables", 
        "Pooja Items",
        "Stationery"
      ],
      paymentMethods: [
        "Cash",
        "Card", 
        "UPI",
        "Credit (Katha)"
      ]
    };
    
    // Update store info dynamically
    function updateStoreInfo() {
      const storeInfoSection = document.getElementById('storeInfoSection');
      if (storeInfoSection) {
        const infoGrid = storeInfoSection.querySelector('.info-grid');
        if (infoGrid) {
          infoGrid.innerHTML = `
            <div class="info-item">
              <strong>Store Name:</strong> ${storeConfig.storeName}
            </div>
            <div class="info-item">
              <strong>Address:</strong> ${storeConfig.contactInfo.address}
            </div>
            <div class="info-item">
              <strong>Phone:</strong> ${storeConfig.contactInfo.phone}
            </div>
            <div class="info-item">
              <strong>Email:</strong> ${storeConfig.contactInfo.email}
            </div>
            <div class="info-item">
              <strong>Hours:</strong> ${storeConfig.contactInfo.hours}
            </div>
            <div class="info-item">
              <strong>Services:</strong> ${storeConfig.services.join(', ')}
            </div>
            <div class="info-item">
              <strong>Payment:</strong> ${storeConfig.paymentMethods.join(', ')}
            </div>
          `;
        }
      }
    }
    
    // Initialize homepage
    document.addEventListener('DOMContentLoaded', function() {
      updateStoreInfo();
      
      // Initialize demo data if no customers exist
      initializeDemoData();
      
      // Initialize logo with saved settings
      updateMainLogo();
      
      // Show homepage by default
      document.getElementById('homepage').style.display = 'block';
      document.getElementById('loginSection').style.display = 'none';
      document.getElementById('customerSection').style.display = 'none';
      document.getElementById('storeSection').style.display = 'none';
    });

    // Navigation Functions
    function goToHome() {
      // Hide all sections and show homepage
      document.getElementById('homepage').style.display = 'block';
      document.getElementById('loginSection').style.display = 'none';
      document.getElementById('customerSection').style.display = 'none';
      document.getElementById('storeSection').style.display = 'none';
      document.getElementById('cartSection').style.display = 'none';
      document.getElementById('kathaSection').style.display = 'none';
      document.getElementById('billHistorySection').style.display = 'none';
      document.getElementById('contactSection').style.display = 'none';
      
      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    // Contact Functions
    function showContact() {
      document.getElementById('contactSection').style.display = 'flex';
    }
    
    function hideContact() {
      document.getElementById('contactSection').style.display = 'none';
    }
    
    function sendMessage() {
      const name = document.getElementById('contactName').value;
      const email = document.getElementById('contactEmail').value;
      const subject = document.getElementById('contactSubject').value;
      const message = document.getElementById('contactMessage').value;
      
      if (!name || !email || !subject || !message) {
        alert('Please fill all fields!');
        return;
      }
      
      // In a real application, you would send this to a server
      // For now, we'll just show a success message
      alert(`Thank you for your message, ${name}! We'll get back to you soon at ${email}.`);
      
      // Clear the form
      document.getElementById('contactName').value = '';
      document.getElementById('contactEmail').value = '';
      document.getElementById('contactSubject').value = '';
      document.getElementById('contactMessage').value = '';
      
      // Hide contact section
      hideContact();
    }
    
    // üëë Store Owner Administrative Powers
    
    // View All Customers with Admin Controls
    function showCustomerList() {
      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      
      if (customers.length === 0) {
        alert('No customers registered yet.');
        return;
      }
      
      let customerListHTML = `
        <div class="admin-section">
          <h3>üìã All Customers (${customers.length})</h3>
          <div class="customer-list">
      `;
      
      customers.forEach(customer => {
        const debtPercentage = (customer.currentDebt / customer.limit) * 100;
        const status = debtPercentage > 80 ? 'danger' : debtPercentage > 50 ? 'warning' : 'good';
        const statusText = debtPercentage > 80 ? 'High Risk' : debtPercentage > 50 ? 'Warning' : 'Good';
        
        customerListHTML += `
          <div class="customer-card">
            <div class="customer-header">
              <div class="customer-name">${customer.name}</div>
              <div class="customer-status status-${status}">${statusText}</div>
            </div>
            
            <div class="customer-details">
              <div class="detail-item">
                <div class="detail-label">Customer ID</div>
                <div class="detail-value">${customer.id}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Phone</div>
                <div class="detail-value">${customer.phone}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Current Debt</div>
                <div class="detail-value">‚Çπ${customer.currentDebt}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Credit Limit</div>
                <div class="detail-value">‚Çπ${customer.limit}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Available Credit</div>
                <div class="detail-value">‚Çπ${customer.limit - customer.currentDebt}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Debt Percentage</div>
                <div class="detail-value">${debtPercentage.toFixed(1)}%</div>
              </div>
            </div>
            
            <div class="customer-actions">
              <button onclick="editCustomer('${customer.id}')" class="action-btn edit">‚úèÔ∏è Edit</button>
              <button onclick="adjustCreditLimit('${customer.id}')" class="action-btn edit">üí∞ Adjust Limit</button>
              <button onclick="suspendCustomer('${customer.id}')" class="action-btn suspend">‚è∏Ô∏è Suspend</button>
              <button onclick="deleteCustomer('${customer.id}')" class="action-btn delete">üóëÔ∏è Delete</button>
              <button onclick="viewCustomerHistory('${customer.id}')" class="action-btn edit">üìä History</button>
            </div>
          </div>
        `;
      });
      
      customerListHTML += `
          </div>
        </div>
      `;
      
      document.getElementById('customerList').innerHTML = customerListHTML;
    }
    
    // Customer Analytics
    function showCustomerAnalytics() {
      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      const kathaRecords = JSON.parse(localStorage.getItem('kathaRecords') || '[]');
      
      const totalCustomers = customers.length;
      const totalDebt = customers.reduce((sum, c) => sum + c.currentDebt, 0);
      const highRiskCustomers = customers.filter(c => (c.currentDebt / c.limit) > 0.8).length;
      const activeCustomers = customers.filter(c => c.currentDebt > 0).length;
      
      const analyticsHTML = `
        <div class="admin-section">
          <h3>üìä Customer Analytics</h3>
          
          <div class="analytics-grid">
            <div class="analytics-card">
              <div class="analytics-icon">üë•</div>
              <div class="analytics-value">${totalCustomers}</div>
              <div class="analytics-label">Total Customers</div>
            </div>
            
            <div class="analytics-card">
              <div class="analytics-icon">üí∞</div>
              <div class="analytics-value">‚Çπ${totalDebt.toFixed(2)}</div>
              <div class="analytics-label">Total Outstanding Debt</div>
            </div>
            
            <div class="analytics-card">
              <div class="analytics-icon">‚ö†Ô∏è</div>
              <div class="analytics-value">${highRiskCustomers}</div>
              <div class="analytics-label">High Risk Customers</div>
            </div>
            
            <div class="analytics-card">
              <div class="analytics-icon">üìà</div>
              <div class="analytics-value">${activeCustomers}</div>
              <div class="analytics-label">Active Customers</div>
            </div>
          </div>
          
          <div class="analytics-chart">
            <h4>Debt Distribution</h4>
            <div class="chart-bars">
              ${customers.map(customer => {
                const percentage = (customer.currentDebt / customer.limit) * 100;
                const barColor = percentage > 80 ? '#dc2626' : percentage > 50 ? '#f59e0b' : '#10b981';
                return `
                  <div class="chart-bar">
                    <div class="bar-label">${customer.name}</div>
                    <div class="bar-container">
                      <div class="bar-fill" style="width: ${percentage}%; background: ${barColor}"></div>
                    </div>
                    <div class="bar-value">${percentage.toFixed(1)}%</div>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('customerList').innerHTML = analyticsHTML;
    }
    
    // Debt Management
    function showDebtManagement() {
      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      const overdueCustomers = customers.filter(c => c.currentDebt > 0);
      
      const debtHTML = `
        <div class="admin-section">
          <h3>üìä Debt Management</h3>
          
          <div class="debt-summary">
            <div class="summary-card">
              <h4>Total Outstanding: ‚Çπ${customers.reduce((sum, c) => sum + c.currentDebt, 0).toFixed(2)}</h4>
              <p>From ${overdueCustomers.length} customers</p>
            </div>
          </div>
          
          <div class="debt-list">
            ${overdueCustomers.map(customer => `
              <div class="debt-card">
                <div class="debt-header">
                  <h4>${customer.name}</h4>
                  <span class="debt-amount">‚Çπ${customer.currentDebt}</span>
                </div>
                <div class="debt-actions">
                  <button onclick="collectPayment('${customer.id}')" class="action-btn edit">üí≥ Collect Payment</button>
                  <button onclick="extendCredit('${customer.id}')" class="action-btn edit">‚è∞ Extend Credit</button>
                  <button onclick="sendReminder('${customer.id}')" class="action-btn edit">üì± Send Reminder</button>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
      
      document.getElementById('customerList').innerHTML = debtHTML;
    }
    
    // Quick Actions
    function showCustomerActions() {
      const actionsHTML = `
        <div class="admin-section">
          <h3>‚ö° Quick Actions</h3>
          
          <div class="quick-actions-grid">
            <button onclick="bulkSendReminders()" class="tool-btn">üì± Send Bulk Reminders</button>
            <button onclick="generateDebtReport()" class="tool-btn">üìÑ Generate Debt Report</button>
            <button onclick="exportCustomerData()" class="tool-btn">üìä Export Data</button>
            <button onclick="backupCustomerData()" class="tool-btn">üíæ Backup Data</button>
            <button onclick="resetAllDebts()" class="tool-btn">üîÑ Reset All Debts</button>
            <button onclick="showSystemSettings()" class="tool-btn">‚öôÔ∏è System Settings</button>
            <button onclick="showDataBackup()" class="tool-btn">üíæ Data Backup</button>
          </div>
        </div>
      `;
      
      document.getElementById('customerList').innerHTML = actionsHTML;
    }
    
    function showDataBackup() {
      const backupHTML = `
        <div class="admin-section">
          <h3>üíæ Data Backup & Recovery</h3>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
            <div style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 12px; padding: 1.5rem;">
              <h4 style="color: #0ea5e9; margin-bottom: 1rem;">üì§ Export Data</h4>
              <p style="color: #64748b; margin-bottom: 1rem;">Download all your data as a JSON file for backup or migration.</p>
              <button onclick="DataManager.exportData()" class="tool-btn" style="width: 100%;">üì• Export All Data</button>
            </div>
            
            <div style="background: #f0fdf4; border: 1px solid #10b981; border-radius: 12px; padding: 1.5rem;">
              <h4 style="color: #10b981; margin-bottom: 1rem;">üì• Import Data</h4>
              <p style="color: #64748b; margin-bottom: 1rem;">Restore data from a previously exported backup file.</p>
              <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImportFile(this)">
              <button onclick="document.getElementById('importFile').click()" class="tool-btn" style="width: 100%;">üìÅ Choose File</button>
            </div>
            
            <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 12px; padding: 1.5rem;">
              <h4 style="color: #f59e0b; margin-bottom: 1rem;">üíæ Create Backup</h4>
              <p style="color: #64748b; margin-bottom: 1rem;">Create a local backup in your browser's storage.</p>
              <button onclick="DataManager.createBackup()" class="tool-btn" style="width: 100%;">üíæ Create Backup</button>
            </div>
            
            <div style="background: #fef2f2; border: 1px solid #ef4444; border-radius: 12px; padding: 1.5rem;">
              <h4 style="color: #ef4444; margin-bottom: 1rem;">‚ö†Ô∏è Clear All Data</h4>
              <p style="color: #64748b; margin-bottom: 1rem;">Permanently delete all data. This action cannot be undone!</p>
              <button onclick="clearAllData()" class="tool-btn" style="width: 100%; background: #ef4444;">üóëÔ∏è Clear All Data</button>
            </div>
          </div>
          
          <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 1.5rem;">
            <h4 style="margin-bottom: 1rem;">üìã Data Statistics</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
              <div style="text-align: center;">
                <div style="font-size: 1.5rem; font-weight: 600; color: #0f172a;">${JSON.parse(localStorage.getItem('customers') || '[]').length}</div>
                <div style="color: #64748b; font-size: 0.9rem;">Customers</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 1.5rem; font-weight: 600; color: #0f172a;">${JSON.parse(localStorage.getItem('bills') || '[]').length}</div>
                <div style="color: #64748b; font-size: 0.9rem;">Bills</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 1.5rem; font-weight: 600; color: #0f172a;">${JSON.parse(localStorage.getItem('kathaRecords') || '[]').length}</div>
                <div style="color: #64748b; font-size: 0.9rem;">Katha Records</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 1.5rem; font-weight: 600; color: #0f172a;">${JSON.parse(localStorage.getItem('preOrders') || '[]').length}</div>
                <div style="color: #64748b; font-size: 0.9rem;">Pre-Orders</div>
              </div>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('customerList').innerHTML = backupHTML;
    }
    
    function handleImportFile(input) {
      const file = input.files[0];
      if (file) {
        DataManager.importData(file);
      }
    }
    
    function clearAllData() {
      const confirmed = confirm('‚ö†Ô∏è WARNING: This will permanently delete ALL data!\n\nThis includes:\n‚Ä¢ All customers\n‚Ä¢ All bills\n‚Ä¢ All katha records\n‚Ä¢ All pre-orders\n\nThis action cannot be undone!\n\nAre you absolutely sure?');
      
      if (confirmed) {
        localStorage.clear();
        showNotification('All data has been cleared!', 'success');
        setTimeout(() => {
          location.reload();
        }, 2000);
      }
    }
    
    // Individual Customer Actions
    function editCustomer(customerId) {
      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      const customer = customers.find(c => c.id === customerId);
      
      if (!customer) {
        ErrorHandler.showError('Customer not found!', 'error');
        return;
      }
      
      const newName = prompt('Enter new name:', customer.name);
      const newPhone = prompt('Enter new phone:', customer.phone);
      const newLimit = prompt('Enter new credit limit:', customer.limit);
      
      if (newName && newPhone && newLimit) {
        customer.name = newName;
        customer.phone = newPhone;
        customer.limit = parseFloat(newLimit);
        
        localStorage.setItem('customers', JSON.stringify(customers));
        ErrorHandler.showError('Customer updated successfully!', 'success');
        showCustomerList();
      }
    }
    
    function adjustCreditLimit(customerId) {
      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      const customer = customers.find(c => c.id === customerId);
      
      if (!customer) {
        ErrorHandler.showError('Customer not found!', 'error');
        return;
      }
      
      const newLimit = prompt(`Current limit: ‚Çπ${customer.limit}\nEnter new credit limit:`, customer.limit);
      
      if (newLimit && !isNaN(newLimit)) {
        customer.limit = parseFloat(newLimit);
        localStorage.setItem('customers', JSON.stringify(customers));
        ErrorHandler.showError(`Credit limit updated to ‚Çπ${newLimit}`, 'success');
        showCustomerList();
      }
    }
    
    function suspendCustomer(customerId) {
      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      const customer = customers.find(c => c.id === customerId);
      
      if (!customer) {
        ErrorHandler.showError('Customer not found!', 'error');
        return;
      }
      
      const action = confirm(`Suspend customer: ${customer.name}?\nThis will prevent them from making new purchases.`);
      
      if (action) {
        customer.suspended = true;
        customer.suspendedDate = new Date().toISOString();
        localStorage.setItem('customers', JSON.stringify(customers));
        ErrorHandler.showError(`Customer ${customer.name} has been suspended.`, 'success');
        showCustomerList();
      }
    }
    
    function deleteCustomer(customerId) {
      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      const customer = customers.find(c => c.id === customerId);
      
      if (!customer) {
        ErrorHandler.showError('Customer not found!', 'error');
        return;
      }
      
      const action = confirm(`‚ö†Ô∏è WARNING: This will permanently delete customer: ${customer.name}\n\nThis action cannot be undone!\n\nAre you sure you want to continue?`);
      
      if (action) {
        const updatedCustomers = customers.filter(c => c.id !== customerId);
        localStorage.setItem('customers', JSON.stringify(updatedCustomers));
        ErrorHandler.showError(`Customer ${customer.name} has been deleted.`, 'success');
        showCustomerList();
      }
    }
    
    function viewCustomerHistory(customerId) {
      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      const kathaRecords = JSON.parse(localStorage.getItem('kathaRecords') || '[]');
      const customer = customers.find(c => c.id === customerId);
      
      if (!customer) {
        ErrorHandler.showError('Customer not found!', 'error');
        return;
      }
      
      const customerRecords = kathaRecords.filter(r => r.customerId === customerId);
      
      let historyHTML = `
        <div class="admin-section">
          <h3>üìä Customer History: ${customer.name}</h3>
          
          <div class="customer-summary">
            <p><strong>Total Purchases:</strong> ${customerRecords.length}</p>
            <p><strong>Total Amount:</strong> ‚Çπ${customerRecords.reduce((sum, r) => sum + r.totalAmount, 0).toFixed(2)}</p>
            <p><strong>Current Debt:</strong> ‚Çπ${customer.currentDebt}</p>
          </div>
          
          <div class="history-list">
            ${customerRecords.map(record => `
              <div class="history-item">
                <div class="history-date">${new Date(record.date).toLocaleDateString()}</div>
                <div class="history-item-name">${record.itemName}</div>
                <div class="history-amount">‚Çπ${record.totalAmount}</div>
                <div class="history-status ${record.status}">${record.status}</div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
      
      document.getElementById('customerList').innerHTML = historyHTML;
    }
    
    // Debt Management Actions
    function collectPayment(customerId) {
      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      const customer = customers.find(c => c.id === customerId);
      
      if (!customer) {
        ErrorHandler.showError('Customer not found!', 'error');
        return;
      }
      
      const paymentAmount = prompt(`Collect payment from ${customer.name}\nCurrent debt: ‚Çπ${customer.currentDebt}\nEnter payment amount:`, customer.currentDebt);
      
      if (paymentAmount && !isNaN(paymentAmount)) {
        const amount = parseFloat(paymentAmount);
        customer.currentDebt = Math.max(0, customer.currentDebt - amount);
        
        localStorage.setItem('customers', JSON.stringify(customers));
        ErrorHandler.showError(`Payment of ‚Çπ${amount} collected. Remaining debt: ‚Çπ${customer.currentDebt}`, 'success');
        showDebtManagement();
      }
    }
    
    function extendCredit(customerId) {
      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      const customer = customers.find(c => c.id === customerId);
      
      if (!customer) {
        ErrorHandler.showError('Customer not found!', 'error');
        return;
      }
      
      const extension = prompt(`Extend credit for ${customer.name}\nCurrent limit: ‚Çπ${customer.limit}\nEnter new limit:`, customer.limit * 1.2);
      
      if (extension && !isNaN(extension)) {
        customer.limit = parseFloat(extension);
        localStorage.setItem('customers', JSON.stringify(customers));
        ErrorHandler.showError(`Credit limit extended to ‚Çπ${extension}`, 'success');
        showDebtManagement();
      }
    }
    
    function sendReminder(customerId) {
      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      const customer = customers.find(c => c.id === customerId);
      
      if (!customer) {
        ErrorHandler.showError('Customer not found!', 'error');
        return;
      }
      
      ErrorHandler.showError(`üì± Reminder sent to ${customer.name} (${customer.phone})\n\nMessage: "Dear ${customer.name}, you have an outstanding debt of ‚Çπ${customer.currentDebt}. Please visit our store to settle your account."`, 'success');
    }
    
    // Bulk Actions
    function bulkSendReminders() {
      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      const overdueCustomers = customers.filter(c => c.currentDebt > 0);
      
      if (overdueCustomers.length === 0) {
        ErrorHandler.showError('No customers with outstanding debt.', 'warning');
        return;
      }
      
      const action = confirm(`Send reminders to ${overdueCustomers.length} customers with outstanding debt?`);
      
      if (action) {
        ErrorHandler.showError(`üì± Bulk reminders sent to ${overdueCustomers.length} customers!`, 'success');
      }
    }
    
    function generateDebtReport() {
      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      const totalDebt = customers.reduce((sum, c) => sum + c.currentDebt, 0);
      
      const report = `
DEBT REPORT - ${new Date().toLocaleDateString()}

Total Customers: ${customers.length}
Total Outstanding Debt: ‚Çπ${totalDebt.toFixed(2)}
Customers with Debt: ${customers.filter(c => c.currentDebt > 0).length}

DETAILED BREAKDOWN:
${customers.map(c => `${c.name}: ‚Çπ${c.currentDebt}`).join('\n')}
      `;
      
      alert('Debt Report Generated!\n\n' + report);
    }
    
    function exportCustomerData() {
      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      const dataStr = JSON.stringify(customers, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      
      const link = document.createElement('a');
      link.href = URL.createObjectURL(dataBlob);
      link.download = 'customer_data.json';
      link.click();
      
      alert('Customer data exported successfully!');
    }
    
    function backupCustomerData() {
      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      const kathaRecords = JSON.parse(localStorage.getItem('kathaRecords') || '[]');
      
      const backup = {
        customers: customers,
        kathaRecords: kathaRecords,
        backupDate: new Date().toISOString()
      };
      
      localStorage.setItem('backup_' + Date.now(), JSON.stringify(backup));
      alert('Customer data backed up successfully!');
    }
    
    function resetAllDebts() {
      const action = confirm('‚ö†Ô∏è WARNING: This will reset ALL customer debts to zero!\n\nThis action cannot be undone!\n\nAre you sure you want to continue?');
      
      if (action) {
        const customers = JSON.parse(localStorage.getItem('customers') || '[]');
        customers.forEach(customer => {
          customer.currentDebt = 0;
        });
        
        localStorage.setItem('customers', JSON.stringify(customers));
        alert('All customer debts have been reset to zero!');
        showCustomerList();
      }
    }
    
    function showSystemSettings() {
      const settingsHTML = `
        <div class="admin-section">
          <h3>‚öôÔ∏è System Settings</h3>
          
          <!-- Store Branding Section -->
          <div style="background: #f8fafc; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem;">
            <h4 style="margin-bottom: 1rem; color: #0f172a;">üè™ Store Branding</h4>
            
            <div class="settings-grid">
              <div class="setting-item">
                <label>Store Name:</label>
                <input type="text" id="storeName" value="Smart General Store" placeholder="Enter store name">
              </div>
              
              <div class="setting-item">
                <label>Store Tagline:</label>
                <input type="text" id="storeTagline" value="Modern Solutions for Traditional Business" placeholder="Enter tagline">
              </div>
              
              <div class="setting-item">
                <label>Current Logo:</label>
                <div style="display: flex; align-items: center; gap: 1rem; margin-top: 0.5rem;">
                  <img src="download.jpeg" alt="Current Logo" style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid #e2e8f0;">
                  <span style="color: #059669; font-weight: 600;">‚úì Custom Logo Active</span>
                </div>
              </div>
              
              <div class="setting-item">
                <label>Change Logo:</label>
                <input type="file" id="customLogo" accept="image/*" onchange="previewCustomLogo()">
                <small style="color: #666;">Recommended: 200x200px PNG/JPG</small>
              </div>
            </div>
            
            <div id="logoPreview" style="text-align: center; margin-top: 1rem; padding: 1rem; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
              <h5>Logo Preview:</h5>
              <div class="logo" style="justify-content: center;">
                <div class="logo-icon">
                  <div class="logo-symbol" id="previewSymbol">
                    <img src="download.jpeg" alt="Store Logo" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                  </div>
                  <div class="logo-circle"></div>
                </div>
                <div class="logo-text">
                  <h1 id="previewStoreName">Smart General Store</h1>
                  <p id="previewTagline">Modern Solutions for Traditional Business</p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- System Settings Section -->
          <div style="background: #f8fafc; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem;">
            <h4 style="margin-bottom: 1rem; color: #0f172a;">‚öôÔ∏è System Configuration</h4>
            
            <div class="settings-grid">
              <div class="setting-item">
                <label>Default Credit Limit:</label>
                <input type="number" id="defaultCreditLimit" value="1000" min="100">
              </div>
              
              <div class="setting-item">
                <label>Interest Rate (%):</label>
                <input type="number" id="interestRate" value="0" min="0" max="50" step="0.1">
              </div>
              
              <div class="setting-item">
                <label>Payment Reminder Days:</label>
                <input type="number" id="reminderDays" value="7" min="1" max="30">
              </div>
              
              <div class="setting-item">
                <label>Auto Suspend Threshold (%):</label>
                <input type="number" id="suspendThreshold" value="90" min="50" max="100">
              </div>
            </div>
          </div>
          
          <div style="display: flex; gap: 1rem;">
            <button onclick="saveSystemSettings()" class="tool-btn" style="flex: 1;">üíæ Save Settings</button>
            <button onclick="resetToDefaultLogo()" class="btn-secondary" style="flex: 1;">üîÑ Reset Logo</button>
          </div>
        </div>
      `;
      
      document.getElementById('customerList').innerHTML = settingsHTML;
      
      // Load current settings
      loadCurrentSettings();
      
      // Add real-time preview updates
      document.getElementById('storeName').addEventListener('input', updateLogoPreview);
      document.getElementById('storeTagline').addEventListener('input', updateLogoPreview);
    }
    
    function saveSystemSettings() {
      const settings = {
        storeName: document.getElementById('storeName').value,
        storeTagline: document.getElementById('storeTagline').value,
        customLogo: 'download.jpeg',
        defaultCreditLimit: parseFloat(document.getElementById('defaultCreditLimit').value),
        interestRate: parseFloat(document.getElementById('interestRate').value),
        reminderDays: parseInt(document.getElementById('reminderDays').value),
        suspendThreshold: parseInt(document.getElementById('suspendThreshold').value)
      };
      
      localStorage.setItem('systemSettings', JSON.stringify(settings));
      
      // Update the main header logo
      updateMainLogo();
      
      alert('System settings saved successfully!');
    }
    
    function loadCurrentSettings() {
      const settings = JSON.parse(localStorage.getItem('systemSettings') || '{}');
      
      if (settings.storeName) document.getElementById('storeName').value = settings.storeName;
      if (settings.storeTagline) document.getElementById('storeTagline').value = settings.storeTagline;
      if (settings.defaultCreditLimit) document.getElementById('defaultCreditLimit').value = settings.defaultCreditLimit;
      if (settings.interestRate) document.getElementById('interestRate').value = settings.interestRate;
      if (settings.reminderDays) document.getElementById('reminderDays').value = settings.reminderDays;
      if (settings.suspendThreshold) document.getElementById('suspendThreshold').value = settings.suspendThreshold;
      
      // Update preview
      updateLogoPreview();
    }
    
    function updateLogoPreview() {
      const storeName = document.getElementById('storeName').value;
      const tagline = document.getElementById('storeTagline').value;
      
      if (document.getElementById('previewStoreName')) {
        document.getElementById('previewStoreName').textContent = storeName;
        document.getElementById('previewTagline').textContent = tagline;
      }
    }
    
    function updateMainLogo() {
      const settings = JSON.parse(localStorage.getItem('systemSettings') || '{}');
      
      const mainLogoText = document.querySelector('header .logo-text h1');
      const mainLogoTagline = document.querySelector('header .logo-text p');
      const mainLogoSymbol = document.querySelector('header .logo-symbol');
      
      if (mainLogoText && settings.storeName) {
        mainLogoText.textContent = settings.storeName;
      }
      if (mainLogoTagline && settings.storeTagline) {
        mainLogoTagline.textContent = settings.storeTagline;
      }
      if (mainLogoSymbol && settings.logoSymbol) {
        mainLogoSymbol.textContent = settings.logoSymbol;
      }
    }
    
    function previewCustomLogo() {
      const fileInput = document.getElementById('customLogo');
      const file = fileInput.files[0];
      
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const logoPreview = document.getElementById('logoPreview');
          logoPreview.innerHTML = `
            <h5>Custom Logo Preview:</h5>
            <img src="${e.target.result}" style="max-width: 200px; max-height: 200px; border-radius: 8px; margin: 1rem 0;">
            <p style="color: #666; font-size: 0.9rem;">Custom logo uploaded successfully!</p>
          `;
          
          // Save custom logo to localStorage
          localStorage.setItem('customLogo', e.target.result);
        };
        reader.readAsDataURL(file);
      }
    }
    
    function resetToDefaultLogo() {
      // Reset to default values
      document.getElementById('storeName').value = 'Smart General Store';
      document.getElementById('storeTagline').value = 'Modern Solutions for Traditional Business';
      document.getElementById('logoSymbol').value = 'üõçÔ∏è';
      document.getElementById('customLogo').value = '';
      
      // Clear custom logo
      localStorage.removeItem('customLogo');
      
      // Update preview
      updateLogoPreview();
      
      // Update main logo
      updateMainLogo();
      
      alert('Logo reset to default successfully!');
    }

    // Data Backup & Recovery System
    class DataManager {
      static exportData() {
        const data = {
          customers: JSON.parse(localStorage.getItem('customers') || '[]'),
          kathaRecords: JSON.parse(localStorage.getItem('kathaRecords') || '[]'),
          bills: JSON.parse(localStorage.getItem('bills') || '[]'),
          preOrders: JSON.parse(localStorage.getItem('preOrders') || '[]'),
          exportDate: new Date().toISOString(),
          version: '1.0.0'
        };
        
        const dataStr = JSON.stringify(data, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = `smart-store-backup-${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        
        showNotification('Data exported successfully!', 'success');
      }
      
      static importData(file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const data = JSON.parse(e.target.result);
            
            if (data.customers) localStorage.setItem('customers', JSON.stringify(data.customers));
            if (data.kathaRecords) localStorage.setItem('kathaRecords', JSON.stringify(data.kathaRecords));
            if (data.bills) localStorage.setItem('bills', JSON.stringify(data.bills));
            if (data.preOrders) localStorage.setItem('preOrders', JSON.stringify(data.preOrders));
            
            showNotification('Data imported successfully!', 'success');
            location.reload(); // Refresh to show imported data
          } catch (error) {
            showNotification('Invalid backup file format!', 'error');
          }
        };
        reader.readAsText(file);
      }
      
      static createBackup() {
        const backup = {
          customers: JSON.parse(localStorage.getItem('customers') || '[]'),
          kathaRecords: JSON.parse(localStorage.getItem('kathaRecords') || '[]'),
          bills: JSON.parse(localStorage.getItem('bills') || '[]'),
          preOrders: JSON.parse(localStorage.getItem('preOrders') || '[]'),
          backupDate: new Date().toISOString()
        };
        
        localStorage.setItem('backup_' + Date.now(), JSON.stringify(backup));
        showNotification('Backup created successfully!', 'success');
      }
      
      static restoreBackup(backupKey) {
        const backup = localStorage.getItem(backupKey);
        if (backup) {
          try {
            const data = JSON.parse(backup);
            
            if (data.customers) localStorage.setItem('customers', JSON.stringify(data.customers));
            if (data.kathaRecords) localStorage.setItem('kathaRecords', JSON.stringify(data.kathaRecords));
            if (data.bills) localStorage.setItem('bills', JSON.stringify(data.bills));
            if (data.preOrders) localStorage.setItem('preOrders', JSON.stringify(data.preOrders));
            
            showNotification('Backup restored successfully!', 'success');
            location.reload();
          } catch (error) {
            showNotification('Failed to restore backup!', 'error');
          }
        }
      }
    }
    
    // Enhanced Credit Management System with Automatic Reminders
    
    // Daily Reminder System
    function initializeReminderSystem() {
      // Check for overdue payments every day
      const lastCheck = localStorage.getItem('lastReminderCheck');
      const today = new Date().toDateString();
      
      if (lastCheck !== today) {
        checkOverduePayments();
        localStorage.setItem('lastReminderCheck', today);
      }
      
      // Set up daily reminder check
      setInterval(checkOverduePayments, 24 * 60 * 60 * 1000); // Check every 24 hours
    }
    
    // Enhanced Overdue Payment Check
    function checkOverduePayments() {
      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      const kathaRecords = JSON.parse(localStorage.getItem('kathaRecords') || '[]');
      const bills = JSON.parse(localStorage.getItem('bills') || '[]');
      
      const overdueCustomers = [];
      const dueTodayCustomers = [];
      const highRiskCustomers = [];
      
      customers.forEach(customer => {
        // Check for overdue katha records
        const customerKathaRecords = kathaRecords.filter(record => 
          record.customerId === customer.id && 
          record.status === 'pending'
        );
        
        const overdueRecords = customerKathaRecords.filter(record => 
          new Date(record.dueDate) < new Date()
        );
        
        const dueTodayRecords = customerKathaRecords.filter(record => {
          const dueDate = new Date(record.dueDate);
          const today = new Date();
          return dueDate.toDateString() === today.toDateString();
        });
        
        // Check for overdue bills
        const customerBills = bills.filter(bill => 
          bill.customerId === customer.id && 
          bill.status === 'pending'
        );
        
        const overdueBills = customerBills.filter(bill => {
          const billDate = new Date(bill.date);
          const dueDate = new Date(billDate.getTime() + 30 * 24 * 60 * 60 * 1000); // 30 days from bill date
          return dueDate < new Date();
        });
        
        if (overdueRecords.length > 0 || overdueBills.length > 0) {
          overdueCustomers.push({
            customer: customer,
            overdueRecords: overdueRecords,
            overdueBills: overdueBills,
            totalOverdue: overdueRecords.reduce((sum, r) => sum + r.totalAmount, 0) + 
                         overdueBills.reduce((sum, b) => sum + b.total, 0)
          });
        }
        
        if (dueTodayRecords.length > 0) {
          dueTodayCustomers.push({
            customer: customer,
            dueRecords: dueTodayRecords,
            totalDue: dueTodayRecords.reduce((sum, r) => sum + r.totalAmount, 0)
          });
        }
        
        // Check for high risk customers (debt > 80% of limit)
        const debtPercentage = (customer.currentDebt / customer.limit) * 100;
        if (debtPercentage > 80) {
          highRiskCustomers.push({
            customer: customer,
            debtPercentage: debtPercentage
          });
        }
      });
      
      // Show notifications
      if (overdueCustomers.length > 0) {
        showNotification(`‚ö†Ô∏è ${overdueCustomers.length} customer(s) have overdue payments totaling ‚Çπ${overdueCustomers.reduce((sum, c) => sum + c.totalOverdue, 0).toFixed(2)}`, 'warning');
        
        // Show detailed overdue modal
        setTimeout(() => {
          showOverduePaymentsModal(overdueCustomers);
        }, 2000);
      }
      
      if (dueTodayCustomers.length > 0) {
        showNotification(`üìÖ ${dueTodayCustomers.length} customer(s) have payments due today`, 'info');
      }
      
      if (highRiskCustomers.length > 0) {
        showNotification(`üö® ${highRiskCustomers.length} customer(s) are at high risk of exceeding credit limit`, 'error');
      }
      
      return { overdueCustomers, dueTodayCustomers, highRiskCustomers };
    }
    
    // Overdue Payments Modal
    function showOverduePaymentsModal(overdueCustomers) {
      const modalHTML = `
        <div id="overdueModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
          <div style="background: white; padding: 2rem; border-radius: 16px; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
              <h2 style="color: #dc2626;">‚ö†Ô∏è Overdue Payments Alert</h2>
              <button onclick="closeOverdueModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">‚úñ</button>
            </div>
            
            <div style="margin-bottom: 1rem;">
              <p><strong>Total Overdue Amount:</strong> ‚Çπ${overdueCustomers.reduce((sum, c) => sum + c.totalOverdue, 0).toFixed(2)}</p>
              <p><strong>Customers Affected:</strong> ${overdueCustomers.length}</p>
            </div>
            
            <div style="max-height: 400px; overflow-y: auto;">
              ${overdueCustomers.map(customerData => `
                <div style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; background: #fef2f2;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <h4 style="margin: 0; color: #dc2626;">${customerData.customer.name}</h4>
                    <span style="font-weight: 600; color: #dc2626;">‚Çπ${customerData.totalOverdue.toFixed(2)}</span>
                  </div>
                  
                  <p style="margin: 0.5rem 0; color: #666;">
                    Phone: ${customerData.customer.phone} | 
                    Current Debt: ‚Çπ${customerData.customer.currentDebt} / ‚Çπ${customerData.customer.limit}
                  </p>
                  
                  ${customerData.overdueRecords.length > 0 ? `
                    <div style="margin-top: 0.5rem;">
                      <strong>Overdue Katha Records:</strong>
                      ${customerData.overdueRecords.map(record => `
                        <div style="font-size: 0.9rem; color: #666; margin-left: 1rem;">
                          ‚Ä¢ ${record.itemName || 'Bill'} - ‚Çπ${record.totalAmount} 
                          (Due: ${new Date(record.dueDate).toLocaleDateString()})
                        </div>
                      `).join('')}
                    </div>
                  ` : ''}
                  
                  ${customerData.overdueBills.length > 0 ? `
                    <div style="margin-top: 0.5rem;">
                      <strong>Overdue Bills:</strong>
                      ${customerData.overdueBills.map(bill => `
                        <div style="font-size: 0.9rem; color: #666; margin-left: 1rem;">
                          ‚Ä¢ Bill #${bill.id} - ‚Çπ${bill.total} 
                          (Due: ${new Date(new Date(bill.date).getTime() + 30 * 24 * 60 * 60 * 1000).toLocaleDateString()})
                        </div>
                      `).join('')}
                    </div>
                  ` : ''}
                  
                  <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                    <button onclick="sendReminder('${customerData.customer.id}')" class="btn-primary" style="padding: 0.5rem 1rem; font-size: 0.9rem;">üì± Send Reminder</button>
                    <button onclick="collectPayment('${customerData.customer.id}')" class="btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.9rem;">üí≥ Collect Payment</button>
                    <button onclick="extendCredit('${customerData.customer.id}')" class="btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.9rem;">‚è∞ Extend Credit</button>
                  </div>
                </div>
              `).join('')}
            </div>
            
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
              <button onclick="bulkSendReminders()" class="btn-primary" style="flex: 1;">üì± Send All Reminders</button>
              <button onclick="generateDebtReport()" class="btn-secondary" style="flex: 1;">üìÑ Generate Report</button>
              <button onclick="closeOverdueModal()" class="btn-secondary" style="flex: 1;">‚úÖ Dismiss</button>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modalHTML);
    }
    
    function closeOverdueModal() {
      const modal = document.getElementById('overdueModal');
      if (modal) modal.remove();
    }
    
    // Enhanced Katha Management
    function showKathaSection() {
      document.getElementById('categoryGrid').style.display = 'none';
      document.getElementById('itemsSection').style.display = 'none';
      document.getElementById('cartSection').style.display = 'none';
      document.getElementById('kathaSection').style.display = 'block';
      document.getElementById('billHistorySection').style.display = 'none';

      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      const kathaRecords = JSON.parse(localStorage.getItem('kathaRecords') || '[]');
      const bills = JSON.parse(localStorage.getItem('bills') || '[]');

      // Get overdue records
      const overdueRecords = kathaRecords.filter(record =>
        new Date(record.dueDate) < new Date() && record.status === 'pending'
      );

      // Get due today records
      const dueTodayRecords = kathaRecords.filter(record => {
        const dueDate = new Date(record.dueDate);
        const today = new Date();
        return dueDate.toDateString() === today.toDateString() && record.status === 'pending';
      });

      // Calculate total outstanding debt
      const totalOutstanding = customers.reduce((sum, c) => sum + c.currentDebt, 0);
      const totalOverdue = overdueRecords.reduce((sum, r) => sum + r.totalAmount, 0);

      let kathaHTML = `
        <div style="margin-bottom: 2rem;">
          <h2>üìã Katha Management System</h2>
          
          <!-- Summary Cards -->
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
            <div style="background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); color: white; padding: 1.5rem; border-radius: 12px; text-align: center;">
              <h3>‚Çπ${totalOutstanding.toFixed(2)}</h3>
              <p>Total Outstanding</p>
            </div>
            <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 1.5rem; border-radius: 12px; text-align: center;">
              <h3>‚Çπ${totalOverdue.toFixed(2)}</h3>
              <p>Overdue Amount</p>
            </div>
            <div style="background: linear-gradient(135deg, #059669 0%, #047857 100%); color: white; padding: 1.5rem; border-radius: 12px; text-align: center;">
              <h3>${customers.length}</h3>
              <p>Total Customers</p>
            </div>
            <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); color: white; padding: 1.5rem; border-radius: 12px; text-align: center;">
              <h3>${overdueRecords.length}</h3>
              <p>Overdue Records</p>
            </div>
          </div>
          
          <!-- Action Buttons -->
          <div style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
            <button onclick="selectCustomer()" class="btn-primary">üë§ Select Customer</button>
            <button onclick="addCustomer()" class="btn-secondary">‚ûï Add New Customer</button>
            <button onclick="bulkSendReminders()" class="btn-secondary">üì± Send All Reminders</button>
            <button onclick="generateDebtReport()" class="btn-secondary">üìÑ Generate Report</button>
          </div>
        </div>
      `;

      // Current Customer Info
      if (currentCustomer) {
        const debtPercentage = (currentCustomer.currentDebt / currentCustomer.limit) * 100;
        const statusColor = debtPercentage > 80 ? '#dc2626' : debtPercentage > 50 ? '#f59e0b' : '#059669';
        
        kathaHTML += `
          <div style="background: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; border-left: 4px solid ${statusColor};">
            <h3>üë§ Current Customer: ${currentCustomer.name}</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
              <div>
                <strong>Customer ID:</strong> ${currentCustomer.id}
              </div>
              <div>
                <strong>Phone:</strong> ${currentCustomer.phone}
              </div>
              <div>
                <strong>Current Debt:</strong> ‚Çπ${currentCustomer.currentDebt}
              </div>
              <div>
                <strong>Credit Limit:</strong> ‚Çπ${currentCustomer.limit}
              </div>
              <div>
                <strong>Available Credit:</strong> ‚Çπ${currentCustomer.limit - currentCustomer.currentDebt}
              </div>
              <div>
                <strong>Debt Percentage:</strong> <span style="color: ${statusColor}; font-weight: 600;">${debtPercentage.toFixed(1)}%</span>
              </div>
            </div>
          </div>
        `;
      }

      // Overdue Payments Section
      if (overdueRecords.length > 0) {
        kathaHTML += `
          <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem;">
            <h3 style="color: #dc2626; margin-bottom: 1rem;">‚ö†Ô∏è Overdue Payments (${overdueRecords.length})</h3>
            <div style="max-height: 300px; overflow-y: auto;">
              ${overdueRecords.map(record => `
                <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem; border-left: 4px solid #dc2626;">
                  <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                      <strong>${record.customerName}</strong><br>
                      <small>${record.itemName || 'Bill'} - Due: ${new Date(record.dueDate).toLocaleDateString()}</small>
                    </div>
                    <div style="text-align: right;">
                      <div style="font-weight: 600; color: #dc2626;">‚Çπ${record.totalAmount}</div>
                      <button onclick="markAsPaid(${record.id})" class="btn-primary" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">Mark Paid</button>
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      // Due Today Section
      if (dueTodayRecords.length > 0) {
        kathaHTML += `
          <div style="background: #fef3c7; border: 1px solid #fde68a; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem;">
            <h3 style="color: #92400e; margin-bottom: 1rem;">üìÖ Due Today (${dueTodayRecords.length})</h3>
            <div style="max-height: 200px; overflow-y: auto;">
              ${dueTodayRecords.map(record => `
                <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem; border-left: 4px solid #f59e0b;">
                  <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                      <strong>${record.customerName}</strong><br>
                      <small>${record.itemName || 'Bill'}</small>
                    </div>
                    <div style="text-align: right;">
                      <div style="font-weight: 600; color: #92400e;">‚Çπ${record.totalAmount}</div>
                      <button onclick="markAsPaid(${record.id})" class="btn-primary" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">Mark Paid</button>
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      // Recent Katha Records
      kathaHTML += `
        <div style="background: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem;">
          <h3>üìã Recent Katha Records</h3>
          <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
              <thead>
                <tr style="background: #f8fafc;">
                  <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid #e2e8f0;">Date</th>
                  <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid #e2e8f0;">Customer</th>
                  <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid #e2e8f0;">Item/Bill</th>
                  <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid #e2e8f0;">Amount</th>
                  <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid #e2e8f0;">Due Date</th>
                  <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid #e2e8f0;">Status</th>
                  <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid #e2e8f0;">Actions</th>
                </tr>
              </thead>
              <tbody>
                ${kathaRecords.slice(-15).reverse().map(record => {
                  const isOverdue = new Date(record.dueDate) < new Date() && record.status === 'pending';
                  const isDueToday = new Date(record.dueDate).toDateString() === new Date().toDateString() && record.status === 'pending';
                  const statusColor = isOverdue ? '#dc2626' : isDueToday ? '#f59e0b' : record.status === 'paid' ? '#059669' : '#64748b';
                  
                  return `
                    <tr style="border-bottom: 1px solid #e2e8f0;">
                      <td style="padding: 0.75rem;">${new Date(record.date).toLocaleDateString()}</td>
                      <td style="padding: 0.75rem;">${record.customerName}</td>
                      <td style="padding: 0.75rem;">${record.itemName || 'Bill'}</td>
                      <td style="padding: 0.75rem; font-weight: 600;">‚Çπ${record.totalAmount}</td>
                      <td style="padding: 0.75rem; color: ${statusColor};">${new Date(record.dueDate).toLocaleDateString()}</td>
                      <td style="padding: 0.75rem;">
                        <span style="color: ${statusColor}; font-weight: 600;">
                          ${isOverdue ? 'OVERDUE' : isDueToday ? 'DUE TODAY' : record.status.toUpperCase()}
                        </span>
                      </td>
                      <td style="padding: 0.75rem;">
                        ${record.status === 'pending' ? 
                          `<button onclick="markAsPaid(${record.id})" class="btn-primary" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">Pay</button>` : 
                          '<span style="color: #059669;">‚úì Paid</span>'
                        }
                      </td>
                    </tr>
                  `;
                }).join('')}
              </tbody>
            </table>
          </div>
        </div>
        
        <button onclick="showMainSection()" class="btn-primary">üõí Back to Shopping</button>
      `;

      document.getElementById('kathaSection').innerHTML = kathaHTML;
    }

    // Enhanced Payment Collection
    function collectPayment(customerId) {
      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      const customer = customers.find(c => c.id === customerId);
      
      if (!customer) {
        alert('Customer not found!');
        return;
      }
      
      const kathaRecords = JSON.parse(localStorage.getItem('kathaRecords') || '[]');
      const customerRecords = kathaRecords.filter(r => r.customerId === customerId && r.status === 'pending');
      
      let paymentModalHTML = `
        <div id="paymentModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
          <div style="background: white; padding: 2rem; border-radius: 16px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
              <h2>üí≥ Collect Payment</h2>
              <button onclick="closePaymentModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">‚úñ</button>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
              <h4>Customer: ${customer.name}</h4>
              <p><strong>Total Outstanding:</strong> ‚Çπ${customer.currentDebt}</p>
              <p><strong>Credit Limit:</strong> ‚Çπ${customer.limit}</p>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
              <label><strong>Payment Amount:</strong></label>
              <input type="number" id="paymentAmount" value="${customer.currentDebt}" min="0" max="${customer.currentDebt}" step="0.01" style="width: 100%; padding: 0.75rem; margin-top: 0.5rem; border: 2px solid #e2e8f0; border-radius: 8px;">
            </div>
            
            <div style="margin-bottom: 1.5rem;">
              <label><strong>Payment Method:</strong></label>
              <select id="paymentMethod" style="width: 100%; padding: 0.75rem; margin-top: 0.5rem; border: 2px solid #e2e8f0; border-radius: 8px;">
                <option value="cash">üíµ Cash</option>
                <option value="card">üí≥ Card</option>
                <option value="upi">üì± UPI</option>
                <option value="bank">üè¶ Bank Transfer</option>
              </select>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
              <label><strong>Notes (Optional):</strong></label>
              <textarea id="paymentNotes" placeholder="Payment notes..." style="width: 100%; padding: 0.75rem; margin-top: 0.5rem; border: 2px solid #e2e8f0; border-radius: 8px; min-height: 80px;"></textarea>
            </div>
            
            <div style="display: flex; gap: 1rem;">
              <button onclick="processPayment('${customerId}')" class="btn-primary" style="flex: 1;">‚úÖ Process Payment</button>
              <button onclick="closePaymentModal()" class="btn-secondary" style="flex: 1;">‚ùå Cancel</button>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', paymentModalHTML);
    }
    
    function closePaymentModal() {
      const modal = document.getElementById('paymentModal');
      if (modal) modal.remove();
    }
    
    function processPayment(customerId) {
      const paymentAmount = parseFloat(document.getElementById('paymentAmount').value);
      const paymentMethod = document.getElementById('paymentMethod').value;
      const paymentNotes = document.getElementById('paymentNotes').value;
      
      if (isNaN(paymentAmount) || paymentAmount <= 0) {
        alert('Please enter a valid payment amount!');
        return;
      }
      
      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      const customer = customers.find(c => c.id === customerId);
      
      if (!customer) {
        alert('Customer not found!');
        return;
      }
      
      if (paymentAmount > customer.currentDebt) {
        alert('Payment amount cannot exceed current debt!');
        return;
      }
      
      // Update customer debt
      customer.currentDebt = Math.max(0, customer.currentDebt - paymentAmount);
      
      // Mark katha records as paid (oldest first)
      const kathaRecords = JSON.parse(localStorage.getItem('kathaRecords') || '[]');
      const customerRecords = kathaRecords.filter(r => r.customerId === customerId && r.status === 'pending');
      
      let remainingPayment = paymentAmount;
      customerRecords.forEach(record => {
        if (remainingPayment > 0) {
          const amountToPay = Math.min(remainingPayment, record.totalAmount);
          record.totalAmount -= amountToPay;
          remainingPayment -= amountToPay;
          
          if (record.totalAmount <= 0) {
            record.status = 'paid';
            record.paidDate = new Date().toISOString();
            record.paymentMethod = paymentMethod;
            record.paymentNotes = paymentNotes;
          }
        }
      });
      
      // Save updated data
      localStorage.setItem('customers', JSON.stringify(customers));
      localStorage.setItem('kathaRecords', JSON.stringify(kathaRecords));
      
      // Show success message
      showNotification(`‚úÖ Payment of ‚Çπ${paymentAmount.toFixed(2)} collected from ${customer.name}`, 'success');
      
      closePaymentModal();
      
      // Refresh katha section
      if (document.getElementById('kathaSection').style.display !== 'none') {
        showKathaSection();
      }
    }

    // Enhanced Reminder System
    function sendReminder(customerId) {
      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      const customer = customers.find(c => c.id === customerId);
      
      if (!customer) {
        ErrorHandler.showError('Customer not found!', 'error');
        return;
      }
      
      const kathaRecords = JSON.parse(localStorage.getItem('kathaRecords') || '[]');
      const customerRecords = kathaRecords.filter(r => r.customerId === customerId && r.status === 'pending');
      
      const overdueRecords = customerRecords.filter(r => new Date(r.dueDate) < new Date());
      const dueTodayRecords = customerRecords.filter(r => {
        const dueDate = new Date(r.dueDate);
        const today = new Date();
        return dueDate.toDateString() === today.toDateString();
      });
      
      let message = `Dear ${customer.name},\n\n`;
      
      if (overdueRecords.length > 0) {
        const totalOverdue = overdueRecords.reduce((sum, r) => sum + r.totalAmount, 0);
        message += `You have ${overdueRecords.length} overdue payment(s) totaling ‚Çπ${totalOverdue.toFixed(2)}.\n`;
        message += `Please visit our store to settle your account.\n\n`;
      }
      
      if (dueTodayRecords.length > 0) {
        const totalDue = dueTodayRecords.reduce((sum, r) => sum + r.totalAmount, 0);
        message += `You have ${dueTodayRecords.length} payment(s) due today totaling ‚Çπ${totalDue.toFixed(2)}.\n\n`;
      }
      
      message += `Current outstanding balance: ‚Çπ${customer.currentDebt}\n`;
      message += `Credit limit: ‚Çπ${customer.limit}\n\n`;
      message += `Thank you for your business!\n`;
      message += `Smart General Store\n`;
      message += `Phone: +91 98765 43210`;
      
      // In a real application, this would send an SMS or email
      // For now, we'll show it in an alert
      ErrorHandler.showError(`üì± Reminder sent to ${customer.name} (${customer.phone})\n\n${message}`, 'success');
      
      // Log the reminder
      const reminders = JSON.parse(localStorage.getItem('reminders') || '[]');
      reminders.push({
        id: Date.now(),
        customerId: customerId,
        customerName: customer.name,
        customerPhone: customer.phone,
        message: message,
        sentDate: new Date().toISOString(),
        type: overdueRecords.length > 0 ? 'overdue' : 'reminder'
      });
      localStorage.setItem('reminders', JSON.stringify(reminders));
    }

    // Pre-Order System with Token Management
    
    // Pre-order data structure
    let preOrders = JSON.parse(localStorage.getItem('preOrders') || '[]');
    let currentToken = parseInt(localStorage.getItem('currentToken') || '1000');
    
    // Customer Pre-Order Login System
    function showCustomerLogin() {
      const loginHTML = `
        <div id="customerLoginModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, rgba(102, 126, 234, 0.9) 0%, rgba(118, 75, 162, 0.9) 100%); z-index: 1000; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px);">
          <div style="background: rgba(255, 255, 255, 0.95); padding: 2.5rem; border-radius: 20px; max-width: 450px; width: 90%; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2);">
            <div style="text-align: center; margin-bottom: 2.5rem;">
              <div style="width: 80px; height: 80px; background: linear-gradient(45deg, #667eea, #764ba2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);">
                <span style="font-size: 2.5rem; color: white;">üõí</span>
              </div>
              <h2 style="margin: 0 0 0.5rem; color: #2d3748; font-size: 1.8rem; font-weight: 700;">Welcome Back!</h2>
              <p style="margin: 0; color: #718096; font-size: 1rem;">Order online and get a token for quick pickup</p>
            </div>
            
            <form id="loginForm" onsubmit="loginCustomer(event)">
              <div style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem; color: #2d3748; font-weight: 600; font-size: 0.95rem;">
                  <span style="margin-right: 0.5rem;">üÜî</span>Customer ID
                </label>
                <input type="text" id="preOrderCustomerId" placeholder="Enter your Customer ID" 
                       style="width: 100%; padding: 1rem; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; transition: all 0.3s ease; background: white;"
                       onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)'" 
                       onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                <div id="idError" style="color: #e53e3e; font-size: 0.85rem; margin-top: 0.5rem; display: none;"></div>
              </div>
              
              <div style="margin-bottom: 2rem;">
                <label style="display: block; margin-bottom: 0.5rem; color: #2d3748; font-weight: 600; font-size: 0.95rem;">
                  <span style="margin-right: 0.5rem;">üì±</span>Phone Number
                </label>
                <input type="tel" id="preOrderPhone" placeholder="Enter your phone number" 
                       style="width: 100%; padding: 1rem; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; transition: all 0.3s ease; background: white;"
                       onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)'" 
                       onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                <div id="phoneError" style="color: #e53e3e; font-size: 0.85rem; margin-top: 0.5rem; display: none;"></div>
              </div>
              
              <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                <button type="submit" style="flex: 1; padding: 1rem; background: linear-gradient(45deg, #059669, #10b981); color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 1rem; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(5, 150, 105, 0.3);" 
                        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(5, 150, 105, 0.4)'" 
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(5, 150, 105, 0.3)'">
                  <span style="margin-right: 0.5rem;">üîê</span>Login
                </button>
                <button type="button" onclick="showRegistrationForm()" 
                        style="flex: 1; padding: 1rem; background: linear-gradient(45deg, #3b82f6, #60a5fa); color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 1rem; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);"
                        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(59, 130, 246, 0.4)'" 
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(59, 130, 246, 0.3)'">
                  <span style="margin-right: 0.5rem;">üìù</span>Register
                </button>
              </div>
            </form>
            
            <div style="text-align: center; padding-top: 1.5rem; border-top: 1px solid #e2e8f0;">
              <button onclick="closeCustomerLogin()" style="background: none; border: none; color: #718096; cursor: pointer; font-size: 0.9rem; padding: 0.5rem 1rem; border-radius: 8px; transition: all 0.3s ease;" 
                      onmouseover="this.style.background='#f7fafc'; this.style.color='#4a5568'">
                <span style="margin-right: 0.5rem;">‚ùå</span>Cancel
              </button>
            </div>
            
            <div style="text-align: center; margin-top: 1rem;">
              <p style="margin: 0; color: #a0aec0; font-size: 0.85rem;">
                <span style="margin-right: 0.5rem;">üí°</span>New customer? Register to get started!
              </p>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', loginHTML);
      
      // Add form validation
      const form = document.getElementById('loginForm');
      const idInput = document.getElementById('preOrderCustomerId');
      const phoneInput = document.getElementById('preOrderPhone');
      
      // Real-time validation
      idInput.addEventListener('input', function() {
        validateField(this, 'idError', 'Customer ID is required');
      });
      
      phoneInput.addEventListener('input', function() {
        validateField(this, 'phoneError', 'Phone number is required');
      });
    }
    
    function closeCustomerLogin() {
      const modal = document.getElementById('customerLoginModal');
      if (modal) modal.remove();
    }
    
    // Form validation helper
    function validateField(input, errorId, message) {
      const errorElement = document.getElementById(errorId);
      if (!input.value.trim()) {
        errorElement.textContent = message;
        errorElement.style.display = 'block';
        input.style.borderColor = '#e53e3e';
        return false;
      } else {
        errorElement.style.display = 'none';
        input.style.borderColor = '#e2e8f0';
        return true;
      }
    }
    
    function loginCustomer(event) {
      if (event) event.preventDefault();
      
      const customerId = document.getElementById('preOrderCustomerId').value.trim();
      const phone = document.getElementById('preOrderPhone').value.trim();
      
      // Validate fields
      const idValid = validateField(document.getElementById('preOrderCustomerId'), 'idError', 'Customer ID is required');
      const phoneValid = validateField(document.getElementById('preOrderPhone'), 'phoneError', 'Phone number is required');
      
      if (!idValid || !phoneValid) {
        return;
      }
      
      // Show loading state
      const loginBtn = document.querySelector('#loginForm button[type="submit"]');
      const originalText = loginBtn.innerHTML;
      loginBtn.innerHTML = '<span style="margin-right: 0.5rem;">‚è≥</span>Logging in...';
      loginBtn.disabled = true;
      
      // Simulate loading delay for better UX
      setTimeout(() => {
        const customers = JSON.parse(localStorage.getItem('customers') || '[]');
        const customer = customers.find(c => c.id === customerId && c.phone === phone);
        
        if (customer) {
          closeCustomerLogin();
          showPreOrderCatalog(customer);
          showNotification('success', `Welcome back, ${customer.name}! üéâ`);
        } else {
          // Show error with better styling
          const errorDiv = document.createElement('div');
          errorDiv.style.cssText = `
            background: linear-gradient(45deg, #fed7d7, #feb2b2);
            color: #c53030;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            text-align: center;
            border: 1px solid #fc8181;
            font-weight: 600;
          `;
          errorDiv.innerHTML = `
            <span style="margin-right: 0.5rem;">‚ö†Ô∏è</span>
            Customer not found! Please check your ID and phone number, or register as a new customer.
          `;
          
          const form = document.getElementById('loginForm');
          form.appendChild(errorDiv);
          
          // Remove error after 5 seconds
          setTimeout(() => {
            if (errorDiv.parentNode) {
              errorDiv.remove();
            }
          }, 5000);
          
          // Reset button
          loginBtn.innerHTML = originalText;
          loginBtn.disabled = false;
        }
      }, 1000);
    }
    
    function showRegistrationForm() {
      const modal = document.getElementById('customerLoginModal');
      modal.innerHTML = `
        <div style="background: rgba(255, 255, 255, 0.95); padding: 2.5rem; border-radius: 20px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2);">
          <div style="text-align: center; margin-bottom: 2.5rem;">
            <div style="width: 80px; height: 80px; background: linear-gradient(45deg, #3b82f6, #60a5fa); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);">
              <span style="font-size: 2.5rem; color: white;">üìù</span>
            </div>
            <h2 style="margin: 0 0 0.5rem; color: #2d3748; font-size: 1.8rem; font-weight: 700;">Create Account</h2>
            <p style="margin: 0; color: #718096; font-size: 1rem;">Join us and start ordering online!</p>
          </div>
          
          <form id="registerForm" onsubmit="registerNewCustomer(event)">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
              <div>
                <label style="display: block; margin-bottom: 0.5rem; color: #2d3748; font-weight: 600; font-size: 0.95rem;">
                  <span style="margin-right: 0.5rem;">üÜî</span>Customer ID
                </label>
                <input type="text" id="regCustomerId" placeholder="Enter unique ID" 
                       style="width: 100%; padding: 1rem; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; transition: all 0.3s ease; background: white;"
                       onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" 
                       onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                <div id="regIdError" style="color: #e53e3e; font-size: 0.85rem; margin-top: 0.5rem; display: none;"></div>
              </div>
              
              <div>
                <label style="display: block; margin-bottom: 0.5rem; color: #2d3748; font-weight: 600; font-size: 0.95rem;">
                  <span style="margin-right: 0.5rem;">üì±</span>Phone Number
                </label>
                <input type="tel" id="regPhone" placeholder="Enter phone number" 
                       style="width: 100%; padding: 1rem; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; transition: all 0.3s ease; background: white;"
                       onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" 
                       onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                <div id="regPhoneError" style="color: #e53e3e; font-size: 0.85rem; margin-top: 0.5rem; display: none;"></div>
              </div>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
              <label style="display: block; margin-bottom: 0.5rem; color: #2d3748; font-weight: 600; font-size: 0.95rem;">
                <span style="margin-right: 0.5rem;">üë§</span>Full Name
              </label>
              <input type="text" id="regName" placeholder="Enter your full name" 
                     style="width: 100%; padding: 1rem; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; transition: all 0.3s ease; background: white;"
                     onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" 
                     onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
              <div id="regNameError" style="color: #e53e3e; font-size: 0.85rem; margin-top: 0.5rem; display: none;"></div>
            </div>
            
            <div style="margin-bottom: 2rem;">
              <label style="display: block; margin-bottom: 0.5rem; color: #2d3748; font-weight: 600; font-size: 0.95rem;">
                <span style="margin-right: 0.5rem;">üí≥</span>Credit Limit (‚Çπ)
              </label>
              <input type="number" id="regCreditLimit" placeholder="1000" value="1000" min="100" step="100"
                     style="width: 100%; padding: 1rem; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; transition: all 0.3s ease; background: white;"
                     onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" 
                     onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
              <small style="color: #718096; font-size: 0.85rem;">Default credit limit for purchases</small>
            </div>
            
            <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
              <button type="submit" style="flex: 1; padding: 1rem; background: linear-gradient(45deg, #059669, #10b981); color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 1rem; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(5, 150, 105, 0.3);" 
                      onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(5, 150, 105, 0.4)'" 
                      onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(5, 150, 105, 0.3)'">
                <span style="margin-right: 0.5rem;">‚úÖ</span>Create Account
              </button>
              <button type="button" onclick="showLoginForm()" 
                      style="flex: 1; padding: 1rem; background: linear-gradient(45deg, #6b7280, #9ca3af); color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 1rem; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(107, 114, 128, 0.3);"
                      onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(107, 114, 128, 0.4)'" 
                      onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(107, 114, 128, 0.3)'">
                <span style="margin-right: 0.5rem;">‚¨ÖÔ∏è</span>Back to Login
              </button>
            </div>
          </form>
          
          <div style="text-align: center; padding-top: 1.5rem; border-top: 1px solid #e2e8f0;">
            <button onclick="closeCustomerLogin()" style="background: none; border: none; color: #718096; cursor: pointer; font-size: 0.9rem; padding: 0.5rem 1rem; border-radius: 8px; transition: all 0.3s ease;" 
                    onmouseover="this.style.background='#f7fafc'; this.style.color='#4a5568'">
              <span style="margin-right: 0.5rem;">‚ùå</span>Cancel
            </button>
          </div>
        </div>
      `;
      
      // Add validation for registration form
      const regIdInput = document.getElementById('regCustomerId');
      const regPhoneInput = document.getElementById('regPhone');
      const regNameInput = document.getElementById('regName');
      
      regIdInput.addEventListener('input', function() {
        validateField(this, 'regIdError', 'Customer ID is required');
      });
      
      regPhoneInput.addEventListener('input', function() {
        validateField(this, 'regPhoneError', 'Phone number is required');
      });
      
      regNameInput.addEventListener('input', function() {
        validateField(this, 'regNameError', 'Full name is required');
      });
    }
    
    function showLoginForm() {
      showCustomerLogin();
    }
    
    function registerNewCustomer(event) {
      if (event) event.preventDefault();
      
      const customerId = document.getElementById('regCustomerId').value.trim();
      const phone = document.getElementById('regPhone').value.trim();
      const name = document.getElementById('regName').value.trim();
      const creditLimit = parseFloat(document.getElementById('regCreditLimit').value) || 1000;
      
      // Validate all fields
      const idValid = validateField(document.getElementById('regCustomerId'), 'regIdError', 'Customer ID is required');
      const phoneValid = validateField(document.getElementById('regPhone'), 'regPhoneError', 'Phone number is required');
      const nameValid = validateField(document.getElementById('regName'), 'regNameError', 'Full name is required');
      
      if (!idValid || !phoneValid || !nameValid) {
        return;
      }
      
      // Show loading state
      const registerBtn = document.querySelector('#registerForm button[type="submit"]');
      const originalText = registerBtn.innerHTML;
      registerBtn.innerHTML = '<span style="margin-right: 0.5rem;">‚è≥</span>Creating Account...';
      registerBtn.disabled = true;
      
      setTimeout(() => {
        const customers = JSON.parse(localStorage.getItem('customers') || '[]');
        
        if (customers.find(c => c.id === customerId)) {
          // Show error
          const errorDiv = document.createElement('div');
          errorDiv.style.cssText = `
            background: linear-gradient(45deg, #fed7d7, #feb2b2);
            color: #c53030;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            text-align: center;
            border: 1px solid #fc8181;
            font-weight: 600;
          `;
          errorDiv.innerHTML = `
            <span style="margin-right: 0.5rem;">‚ö†Ô∏è</span>
            Customer ID already exists! Please use a different ID.
          `;
          
          const form = document.getElementById('registerForm');
          form.appendChild(errorDiv);
          
          setTimeout(() => {
            if (errorDiv.parentNode) {
              errorDiv.remove();
            }
          }, 5000);
          
          registerBtn.innerHTML = originalText;
          registerBtn.disabled = false;
          return;
        }
        
        const newCustomer = {
          id: customerId,
          name: name,
          phone: phone,
          limit: creditLimit,
          currentDebt: 0,
          dueDate: new Date(Date.now() + 30*24*60*60*1000).toISOString()
        };
        
        customers.push(newCustomer);
        localStorage.setItem('customers', JSON.stringify(customers));
        
        closeCustomerLogin();
        showPreOrderCatalog(newCustomer);
        showNotification('success', `Welcome to our store, ${name}! Your account has been created successfully! üéâ`);
      }, 1000);
    }
    
    // Pre-Order Catalog
    function showPreOrderCatalog(customer) {
      const catalogHTML = `
        <div id="preOrderCatalog" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
          <div style="background: white; padding: 2rem; border-radius: 16px; max-width: 1000px; width: 95%; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
              <div>
                <h2>üõí Pre-Order Catalog</h2>
                <p>Welcome, ${customer.name} (ID: ${customer.id})</p>
                <p>Available Credit: ‚Çπ${customer.limit - customer.currentDebt}</p>
              </div>
              <button onclick="closePreOrderCatalog()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">‚úñ</button>
            </div>
            
            <div style="display: flex; gap: 2rem;">
              <!-- Categories -->
              <div style="flex: 1; max-width: 200px;">
                <h3>Categories</h3>
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                  ${categories.map(cat => `
                    <button onclick="showCategoryItems('${cat.name}')" class="btn-secondary" style="text-align: left; padding: 0.75rem;">
                      ${cat.icon} ${cat.name}
                    </button>
                  `).join('')}
                </div>
              </div>
              
              <!-- Items -->
              <div style="flex: 2;">
                <div id="preOrderItems" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem;">
                  ${categories[0].items.map(item => `
                    <div style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem;">
                      <h4>${item.name}</h4>
                      <p>‚Çπ${item.price}/kg</p>
                      <p style="color: ${item.stock > 0 ? 'green' : 'red'};">${item.stock > 0 ? 'In Stock' : 'Out of Stock'}</p>
                      <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                        <input type="number" min="0" step="0.1" value="0" style="width: 60px; padding: 0.25rem;" data-item="${item.name}" data-price="${item.price}">
                        <button onclick="addToPreOrder('${item.name}', ${item.price})" class="btn-primary" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">Add</button>
                      </div>
                    </div>
                  `).join('')}
                </div>
              </div>
              
              <!-- Cart -->
              <div style="flex: 1; max-width: 300px;">
                <h3>üõí Pre-Order Cart</h3>
                <div id="preOrderCart" style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem; min-height: 200px;">
                  <p style="color: #666; text-align: center;">Cart is empty</p>
                </div>
                
                <div style="margin-top: 1rem;">
                  <button onclick="placePreOrder('${customer.id}')" class="btn-primary" style="width: 100%;">üìã Place Pre-Order</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', catalogHTML);
    }
    
    function closePreOrderCatalog() {
      const modal = document.getElementById('preOrderCatalog');
      if (modal) modal.remove();
    }
    
    function showCategoryItems(categoryName) {
      const category = categories.find(cat => cat.name === categoryName);
      const itemsContainer = document.getElementById('preOrderItems');
      
      if (category && itemsContainer) {
        itemsContainer.innerHTML = category.items.map(item => `
          <div style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem;">
            <h4>${item.name}</h4>
            <p>‚Çπ${item.price}/kg</p>
            <p style="color: ${item.stock > 0 ? 'green' : 'red'};">${item.stock > 0 ? 'In Stock' : 'Out of Stock'}</p>
            <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
              <input type="number" min="0" step="0.1" value="0" style="width: 60px; padding: 0.25rem;" data-item="${item.name}" data-price="${item.price}">
              <button onclick="addToPreOrder('${item.name}', ${item.price})" class="btn-primary" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">Add</button>
            </div>
          </div>
        `).join('');
      }
    }
    
    // Pre-Order Cart Management
    let preOrderCart = [];
    
    function addToPreOrder(itemName, price) {
      const quantityInput = document.querySelector(`input[data-item="${itemName}"]`);
      const quantity = parseFloat(quantityInput.value);
      
      if (quantity <= 0) {
        alert('Please enter a valid quantity!');
        return;
      }
      
      const existingItem = preOrderCart.find(item => item.name === itemName);
      if (existingItem) {
        existingItem.quantity += quantity;
        existingItem.total = (existingItem.quantity * price).toFixed(2);
      } else {
        preOrderCart.push({
          name: itemName,
          price: price,
          quantity: quantity,
          total: (quantity * price).toFixed(2)
        });
      }
      
      quantityInput.value = 0;
      updatePreOrderCart();
    }
    
    function updatePreOrderCart() {
      const cartContainer = document.getElementById('preOrderCart');
      if (!cartContainer) return;
      
      if (preOrderCart.length === 0) {
        cartContainer.innerHTML = '<p style="color: #666; text-align: center;">Cart is empty</p>';
        return;
      }
      
      const total = preOrderCart.reduce((sum, item) => sum + parseFloat(item.total), 0);
      
      cartContainer.innerHTML = `
        ${preOrderCart.map(item => `
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; padding: 0.5rem; background: #f8fafc; border-radius: 4px;">
            <div>
              <strong>${item.name}</strong><br>
              <small>${item.quantity} kg √ó ‚Çπ${item.price}</small>
            </div>
            <div style="text-align: right;">
              <div>‚Çπ${item.total}</div>
              <button onclick="removeFromPreOrder('${item.name}')" style="background: none; border: none; color: red; cursor: pointer; font-size: 0.8rem;">‚úñ</button>
            </div>
          </div>
        `).join('')}
        <hr style="margin: 1rem 0;">
        <div style="display: flex; justify-content: space-between; font-weight: 600;">
          <span>Total:</span>
          <span>‚Çπ${total.toFixed(2)}</span>
        </div>
      `;
    }
    
    function removeFromPreOrder(itemName) {
      preOrderCart = preOrderCart.filter(item => item.name !== itemName);
      updatePreOrderCart();
    }
    
    // Place Pre-Order
    function placePreOrder(customerId) {
      if (preOrderCart.length === 0) {
        ErrorHandler.showError('Your cart is empty! Please add some items.', 'error');
        return;
      }
      
      const customers = JSON.parse(localStorage.getItem('customers') || '[]');
      const customer = customers.find(c => c.id === customerId);
      
      if (!customer) {
        ErrorHandler.showError('Customer not found!', 'error');
        return;
      }
      
      const total = preOrderCart.reduce((sum, item) => sum + parseFloat(item.total), 0);
      const newDebt = customer.currentDebt + total;
      
      if (newDebt > customer.limit) {
        ErrorHandler.showError(`Credit limit exceeded! Current debt: ‚Çπ${customer.currentDebt}, Limit: ‚Çπ${customer.limit}`, 'error');
        return;
      }
      
      // Generate token
      const token = currentToken++;
      localStorage.setItem('currentToken', currentToken.toString());
      
      // Create pre-order
      const preOrder = {
        id: Date.now(),
        token: token,
        customerId: customerId,
        customerName: customer.name,
        customerPhone: customer.phone,
        items: [...preOrderCart],
        total: total,
        status: 'pending',
        orderDate: new Date().toISOString(),
        pickupDate: null,
        paymentMethod: 'katha'
      };
      
      preOrders.push(preOrder);
      localStorage.setItem('preOrders', JSON.stringify(preOrders));
      
      // Update customer debt
      customer.currentDebt = newDebt;
      const updatedCustomers = customers.map(c => c.id === customerId ? customer : c);
      localStorage.setItem('customers', JSON.stringify(updatedCustomers));
      
      // Show success message
      showPreOrderSuccess(preOrder);
    }
    
    function showPreOrderSuccess(preOrder) {
      const successHTML = `
        <div id="preOrderSuccess" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
          <div style="background: white; padding: 2rem; border-radius: 16px; max-width: 600px; width: 95%; max-height: 90vh; overflow-y: auto;">
            <div style="text-align: center; margin-bottom: 2rem;">
              <div style="font-size: 4rem; margin-bottom: 1rem;">‚úÖ</div>
              <h2 style="color: #059669;">Pre-Order Successful!</h2>
            </div>
            
            <!-- Professional Receipt -->
            <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; font-family: monospace;">
              <div style="text-align: center; margin-bottom: 1rem;">
                <h3 style="margin: 0; color: #0f172a;">üõçÔ∏è SMART GENERAL STORE</h3>
                <p style="margin: 0.5rem 0; color: #64748b; font-size: 0.9rem;">Pre-Order Receipt</p>
                <p style="margin: 0; color: #64748b; font-size: 0.8rem;">${new Date(preOrder.orderDate).toLocaleString()}</p>
              </div>
              
              <hr style="border: none; border-top: 1px dashed #cbd5e0; margin: 1rem 0;">
              
              <div style="margin-bottom: 1rem;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                  <span><strong>Order ID:</strong></span>
                  <span>#${preOrder.id}</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                  <span><strong>Customer:</strong></span>
                  <span>${preOrder.customerName}</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                  <span><strong>Phone:</strong></span>
                  <span>${preOrder.customerPhone}</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                  <span><strong>Token:</strong></span>
                  <span style="font-weight: 700; color: #0d6efd;">#${preOrder.token}</span>
                </div>
              </div>
              
              <hr style="border: none; border-top: 1px dashed #cbd5e0; margin: 1rem 0;">
              
              <div style="margin-bottom: 1rem;">
                <div style="text-align: center; margin-bottom: 0.5rem; font-weight: 600;">ITEMS ORDERED</div>
                ${preOrder.items.map(item => `
                  <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem; font-size: 0.9rem;">
                    <span>${item.name}</span>
                    <span>${item.quantity} kg</span>
                  </div>
                  <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.8rem; color: #64748b;">
                    <span>@ ‚Çπ${item.price}/kg</span>
                    <span>‚Çπ${item.total}</span>
                  </div>
                `).join('')}
              </div>
              
              <hr style="border: none; border-top: 1px dashed #cbd5e0; margin: 1rem 0;">
              
              <div style="display: flex; justify-content: space-between; font-weight: 600; font-size: 1.1rem; margin-bottom: 1rem;">
                <span>TOTAL:</span>
                <span>‚Çπ${preOrder.total.toFixed(2)}</span>
              </div>
              
              <div style="text-align: center; margin-bottom: 1rem;">
                <div style="background: #f0f9ff; border: 1px solid #0d6efd; border-radius: 8px; padding: 0.75rem;">
                  <div style="font-weight: 600; color: #0d6efd; margin-bottom: 0.5rem;">ü™ô PICKUP TOKEN</div>
                  <div style="font-size: 1.5rem; font-weight: 700; color: #0d6efd;">#${preOrder.token}</div>
                </div>
              </div>
              
              <div style="text-align: center; font-size: 0.8rem; color: #64748b;">
                <p style="margin: 0.25rem 0;"><strong>Status:</strong> <span style="color: #f59e0b;">PENDING PICKUP</span></p>
                <p style="margin: 0.25rem 0;"><strong>Payment:</strong> <span style="color: #059669;">PAY AT COUNTER</span></p>
              </div>
              
              <hr style="border: none; border-top: 1px dashed #cbd5e0; margin: 1rem 0;">
              
              <div style="text-align: center; font-size: 0.8rem; color: #64748b;">
                <p style="margin: 0.25rem 0;">üìû +91 98765 43210</p>
                <p style="margin: 0.25rem 0;">üìç Main Street, City Center</p>
                <p style="margin: 0.25rem 0;">üïí 8:00 AM - 9:00 PM (Daily)</p>
              </div>
            </div>
            
            <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem;">
              <h4 style="color: #92400e; margin-bottom: 0.5rem;">üìã Pickup Instructions:</h4>
              <ul style="text-align: left; color: #92400e; margin: 0; padding-left: 1.5rem;">
                <li>Visit the store with your token number</li>
                <li>Show the token to the staff</li>
                <li>Your order will be prepared and ready</li>
                <li>Pay at the counter (Cash/Card/UPI)</li>
              </ul>
            </div>
            
            <div style="display: flex; gap: 1rem;">
              <button onclick="printPreOrderReceipt(${preOrder.id})" class="btn-primary" style="flex: 1;">üñ®Ô∏è Print Receipt</button>
              <button onclick="downloadPreOrderReceipt(${preOrder.id})" class="btn-secondary" style="flex: 1;">üì• Download PDF</button>
              <button onclick="closePreOrderSuccess()" class="btn-secondary" style="flex: 1;">‚úÖ Done</button>
            </div>
            
            <div style="margin-top: 1rem; text-align: center;">
              <button onclick="goBackToMain()" class="btn-secondary" style="padding: 0.75rem 1.5rem;">üè† Back to Main Menu</button>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', successHTML);
      
      // Clear cart
      preOrderCart = [];
    }
    
    function closePreOrderSuccess() {
      const modal = document.getElementById('preOrderSuccess');
      if (modal) modal.remove();
      closePreOrderCatalog();
    }
    
    function goBackToMain() {
      // Close all pre-order modals
      const preOrderSuccess = document.getElementById('preOrderSuccess');
      if (preOrderSuccess) preOrderSuccess.remove();
      
      const preOrderCatalog = document.getElementById('preOrderCatalog');
      if (preOrderCatalog) preOrderCatalog.remove();
      
      const customerLoginModal = document.getElementById('customerLoginModal');
      if (customerLoginModal) customerLoginModal.remove();
      
      // Clear pre-order cart
      preOrderCart = [];
      
      // Show homepage
      goToHome();
      
      showNotification('üè† Welcome back to Smart General Store!', 'success');
    }
    
    // Print Pre-Order Receipt
    function printPreOrderReceipt(orderId) {
      const order = preOrders.find(o => o.id === orderId);
      if (!order) return;
      
      const printWindow = window.open('', '_blank');
      printWindow.document.write(`
        <html>
          <head>
            <title>Pre-Order Receipt #${order.token}</title>
            <style>
              body { 
                font-family: 'Courier New', monospace; 
                margin: 20px; 
                font-size: 12px;
                line-height: 1.4;
              }
              .receipt { 
                max-width: 300px; 
                margin: 0 auto; 
                border: 1px solid #ccc; 
                padding: 15px; 
              }
              .header { 
                text-align: center; 
                margin-bottom: 15px; 
                border-bottom: 1px dashed #ccc; 
                padding-bottom: 10px; 
              }
              .header h1 { 
                margin: 0; 
                font-size: 16px; 
                font-weight: bold; 
              }
              .header p { 
                margin: 5px 0; 
                font-size: 10px; 
                color: #666; 
              }
              .token { 
                text-align: center; 
                background: #f0f9ff; 
                border: 2px solid #0d6efd; 
                padding: 10px; 
                margin: 15px 0; 
                border-radius: 5px; 
              }
              .token-number { 
                font-size: 24px; 
                font-weight: bold; 
                color: #0d6efd; 
              }
              .details { 
                margin: 15px 0; 
              }
              .details div { 
                display: flex; 
                justify-content: space-between; 
                margin: 5px 0; 
              }
              .items { 
                margin: 15px 0; 
              }
              .item { 
                margin: 8px 0; 
              }
              .item-name { 
                font-weight: bold; 
              }
              .item-details { 
                display: flex; 
                justify-content: space-between; 
                font-size: 10px; 
                color: #666; 
                margin-left: 10px; 
              }
              .total { 
                border-top: 1px dashed #ccc; 
                padding-top: 10px; 
                margin: 15px 0; 
                font-weight: bold; 
                font-size: 14px; 
              }
              .footer { 
                text-align: center; 
                margin-top: 15px; 
                border-top: 1px dashed #ccc; 
                padding-top: 10px; 
                font-size: 10px; 
                color: #666; 
              }
              .status { 
                text-align: center; 
                margin: 10px 0; 
                font-weight: bold; 
              }
              .status.pending { 
                color: #f59e0b; 
              }
              .status.payment { 
                color: #059669; 
              }
              @media print {
                body { margin: 0; }
                .receipt { border: none; }
              }
            </style>
          </head>
          <body>
            <div class="receipt">
              <div class="header">
                <h1>üõçÔ∏è SMART GENERAL STORE</h1>
                <p>Pre-Order Receipt</p>
                <p>${new Date(order.orderDate).toLocaleString()}</p>
              </div>
              
              <div class="details">
                <div><strong>Order ID:</strong> #${order.id}</div>
                <div><strong>Customer:</strong> ${order.customerName}</div>
                <div><strong>Phone:</strong> ${order.customerPhone}</div>
              </div>
              
              <div class="token">
                <div style="font-weight: bold; margin-bottom: 5px;">ü™ô PICKUP TOKEN</div>
                <div class="token-number">#${order.token}</div>
              </div>
              
              <div class="items">
                <div style="text-align: center; font-weight: bold; margin-bottom: 10px;">ITEMS ORDERED</div>
                ${order.items.map(item => `
                  <div class="item">
                    <div class="item-name">${item.name}</div>
                    <div class="item-details">
                      <span>${item.quantity} kg @ ‚Çπ${item.price}/kg</span>
                      <span>‚Çπ${item.total}</span>
                    </div>
                  </div>
                `).join('')}
              </div>
              
              <div class="total">
                <div style="display: flex; justify-content: space-between;">
                  <span>TOTAL:</span>
                  <span>‚Çπ${order.total.toFixed(2)}</span>
                </div>
              </div>
              
              <div class="status">
                <div class="pending">Status: PENDING PICKUP</div>
                <div class="payment">Payment: PAY AT COUNTER</div>
              </div>
              
              <div class="footer">
                <p>üìû +91 98765 43210</p>
                <p>üìç Main Street, City Center</p>
                <p>üïí 8:00 AM - 9:00 PM (Daily)</p>
                <p style="margin-top: 10px; font-weight: bold;">Thank you for your pre-order!</p>
                <p>Show this receipt with token when visiting the store</p>
              </div>
            </div>
          </body>
        </html>
      `);
      printWindow.document.close();
      printWindow.print();
    }
    
    // Download Pre-Order Receipt as PDF
    function downloadPreOrderReceipt(orderId) {
      const order = preOrders.find(o => o.id === orderId);
      if (!order) return;
      
      // Create a simple text-based receipt for download
      const receiptText = `
SMART GENERAL STORE - PRE-ORDER RECEIPT
========================================

Order Details:
--------------
Order ID: #${order.id}
Customer: ${order.customerName}
Phone: ${order.customerPhone}
Date: ${new Date(order.orderDate).toLocaleString()}

PICKUP TOKEN: #${order.token}
============================

Items Ordered:
--------------
${order.items.map(item => `${item.name} - ${item.quantity} kg @ ‚Çπ${item.price}/kg = ‚Çπ${item.total}`).join('\n')}

TOTAL: ‚Çπ${order.total.toFixed(2)}
============================

Status: PENDING PICKUP
Payment: PAY AT COUNTER

Pickup Instructions:
-------------------
1. Visit the store with your token number
2. Show the token to the staff
3. Your order will be prepared and ready
4. Pay at the counter (Cash/Card/UPI)

Store Information:
------------------
Phone: +91 98765 43210
Address: Main Street, City Center
Hours: 8:00 AM - 9:00 PM (Daily)

Thank you for your pre-order!
Show this receipt with token when visiting the store.
      `;
      
      const blob = new Blob([receiptText], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `pre-order-receipt-${order.token}.txt`;
      link.click();
      URL.revokeObjectURL(url);
      
      showNotification('üì• Receipt downloaded successfully!', 'success');
    }
    
    // Store Owner Pre-Order Management
    function showPreOrderManagement() {
      const pendingOrders = preOrders.filter(order => order.status === 'pending');
      const completedOrders = preOrders.filter(order => order.status === 'completed');
      
      const managementHTML = `
        <div id="preOrderManagement" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
          <div style="background: white; padding: 2rem; border-radius: 16px; max-width: 1000px; width: 95%; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
              <h2>üìã Pre-Order Management</h2>
              <button onclick="closePreOrderManagement()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">‚úñ</button>
            </div>
            
            <!-- Summary Cards -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
              <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 1.5rem; border-radius: 12px; text-align: center;">
                <h3>${pendingOrders.length}</h3>
                <p>Pending Orders</p>
              </div>
              <div style="background: linear-gradient(135deg, #059669 0%, #047857 100%); color: white; padding: 1.5rem; border-radius: 12px; text-align: center;">
                <h3>${completedOrders.length}</h3>
                <p>Completed Orders</p>
              </div>
              <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); color: white; padding: 1.5rem; border-radius: 12px; text-align: center;">
                <h3>‚Çπ${preOrders.reduce((sum, order) => sum + order.total, 0).toFixed(2)}</h3>
                <p>Total Orders Value</p>
              </div>
            </div>
            
            <!-- Pending Orders -->
            <div style="margin-bottom: 2rem;">
              <h3>‚è≥ Pending Orders (${pendingOrders.length})</h3>
              ${pendingOrders.length === 0 ? 
                '<p style="text-align: center; color: #666; padding: 2rem;">No pending orders</p>' :
                pendingOrders.map(order => `
                  <div style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; background: #fef3c7;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                      <div>
                        <h4 style="margin: 0;">ü™ô Token: ${order.token}</h4>
                        <p style="margin: 0.5rem 0; color: #666;">${order.customerName} (${order.customerPhone})</p>
                        <p style="margin: 0; color: #666;">Ordered: ${new Date(order.orderDate).toLocaleString()}</p>
                      </div>
                      <div style="text-align: right;">
                        <div style="font-size: 1.2rem; font-weight: 600; color: #92400e;">‚Çπ${order.total.toFixed(2)}</div>
                        <button onclick="completePreOrder(${order.id})" class="btn-primary" style="padding: 0.5rem 1rem; margin-top: 0.5rem;">‚úÖ Complete Order</button>
                      </div>
                    </div>
                    <div style="background: white; padding: 0.5rem; border-radius: 4px;">
                      <strong>Items:</strong> ${order.items.map(item => `${item.name} (${item.quantity} kg)`).join(', ')}
                    </div>
                  </div>
                `).join('')
              }
            </div>
            
            <!-- Completed Orders -->
            <div>
              <h3>‚úÖ Completed Orders (${completedOrders.length})</h3>
              ${completedOrders.length === 0 ? 
                '<p style="text-align: center; color: #666; padding: 2rem;">No completed orders</p>' :
                completedOrders.slice(-5).reverse().map(order => `
                  <div style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; background: #f0fdf4;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                      <div>
                        <h4 style="margin: 0;">ü™ô Token: ${order.token}</h4>
                        <p style="margin: 0.5rem 0; color: #666;">${order.customerName}</p>
                        <p style="margin: 0; color: #666;">Completed: ${new Date(order.pickupDate).toLocaleString()}</p>
                      </div>
                      <div style="text-align: right;">
                        <div style="font-size: 1.2rem; font-weight: 600; color: #059669;">‚Çπ${order.total.toFixed(2)}</div>
                        <span style="color: #059669; font-weight: 600;">‚úì Completed</span>
                      </div>
                    </div>
                  </div>
                `).join('')
              }
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', managementHTML);
    }
    
    function closePreOrderManagement() {
      const modal = document.getElementById('preOrderManagement');
      if (modal) modal.remove();
    }
    
    function completePreOrder(orderId) {
      const order = preOrders.find(o => o.id === orderId);
      if (!order) return;
      
      order.status = 'completed';
      order.pickupDate = new Date().toISOString();
      
      localStorage.setItem('preOrders', JSON.stringify(preOrders));
      
      showNotification(`‚úÖ Pre-order ${order.token} completed successfully!`, 'success');
      closePreOrderManagement();
      showPreOrderManagement();
    }
    
    // Add Pre-Order button to navigation
    function addPreOrderButton() {
      const nav = document.querySelector('nav ul');
      if (nav) {
        const preOrderLi = document.createElement('li');
        preOrderLi.innerHTML = '<a href="#" id="preOrderBtn">üì± Pre-Order</a>';
        nav.appendChild(preOrderLi);
        
        document.getElementById('preOrderBtn').onclick = function(e) {
          e.preventDefault();
          showCustomerLogin();
        };
      }
    }
    
    // Add Pre-Order Management button for admin
    function addPreOrderManagementButton() {
      const nav = document.querySelector('nav ul');
      if (nav) {
        const managementLi = document.createElement('li');
        managementLi.innerHTML = '<a href="#" id="preOrderManagementBtn">üìã Pre-Orders</a>';
        nav.appendChild(managementLi);
        
        document.getElementById('preOrderManagementBtn').onclick = function(e) {
          e.preventDefault();
          showPreOrderManagement();
        };
      }
    }
    
    // Initialize reminder system when page loads
    document.addEventListener('DOMContentLoaded', function() {
      // ... existing code ...
      
      // Initialize the reminder system
      initializeReminderSystem();
      
      // Check for overdue payments every 5 minutes (for demo purposes)
      setInterval(checkOverduePayments, 5 * 60 * 1000);
      
      // Add pre-order buttons
      addPreOrderButton();
      addPreOrderManagementButton();
      
      // Initialize loyalty display
      updateLoyaltyDisplay();
      updateLoyaltyTier();
    });
  </script>
  <script src="app.js"></script>
</body>
</html>